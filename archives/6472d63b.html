<!DOCTYPE html>
<html>
    <head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
  <meta name="robots" content="index, follow">
  <!-- title -->
  
    
  <title>D3.js 入门教程系列 - 白云雅阁</title>
    
  
  
  <!-- open graph -->
  <meta name="description" content="初识D3D3是指数据驱动文档（Data-Driven Documents），根据D3的官方定义：  D3.js是一个JavaScript库，它可以通过数据来操作文档。D3可以通过使用HTML、SVG和CSS把数据鲜活形象地展现出来。D3严格遵循Web标准，因而可以让你的程序轻松兼容现代主流浏览器并避免对特定框架的依赖。同时，它提供了强大的可视化组件，可以让使用者以数据驱动的方式去操作DOM。—-D">
<meta property="og:type" content="article">
<meta property="og:title" content="D3.js 入门教程系列">
<meta property="og:url" content="http://ronghuaxueleng.github.io/archives/6472d63b.html">
<meta property="og:site_name" content="白云雅阁">
<meta property="og:description" content="初识D3D3是指数据驱动文档（Data-Driven Documents），根据D3的官方定义：  D3.js是一个JavaScript库，它可以通过数据来操作文档。D3可以通过使用HTML、SVG和CSS把数据鲜活形象地展现出来。D3严格遵循Web标准，因而可以让你的程序轻松兼容现代主流浏览器并避免对特定框架的依赖。同时，它提供了强大的可视化组件，可以让使用者以数据驱动的方式去操作DOM。—-D">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115161474722916.68.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115161474722916.82.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115161474722916.95.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115171474722917.08.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115171474722917.24.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115171474722917.38.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115171474722917.52.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115171474722917.69.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115171474722917.86.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115181474722918.02.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115181474722918.15.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115181474722918.36.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115181474722918.51.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115181474722918.66.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115181474722918.83.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115181474722918.99.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115191474722919.19.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115191474722919.34.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115191474722919.49.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115191474722919.64.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115191474722919.78.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115191474722919.91.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115201474722920.26.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115201474722920.41.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115201474722920.56.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115201474722920.73.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115201474722920.95.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115231474722923.15.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115231474722923.28.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115231474722923.49.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115231474722923.72.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115241474722924.02.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115241474722924.23.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115241474722924.4.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115241474722924.56.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115241474722924.71.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115241474722924.88.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115251474722925.21.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115251474722925.51.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115251474722925.9.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115261474722926.06.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115261474722926.28.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115261474722926.46.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115261474722926.6.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115261474722926.8.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115261474722926.96.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115271474722927.15.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115271474722927.39.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115271474722927.54.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115271474722927.75.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115271474722927.97.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115281474722928.12.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115281474722928.29.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115281474722928.46.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115281474722928.6.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115281474722928.77.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115281474722928.93.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115291474722929.1.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115291474722929.27.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115291474722929.44.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115291474722929.63.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115291474722929.86.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115301474722930.02.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115301474722930.24.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115301474722930.43.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115301474722930.59.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115301474722930.78.jpg">
<meta property="og:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115301474722930.96.jpg">
<meta property="article:published_time" content="2016-09-24T00:00:00.000Z">
<meta property="article:modified_time" content="2025-03-09T08:43:48.244Z">
<meta property="article:author" content="ronghuaxueleng">
<meta property="article:tag" content="d3">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://ronghuaxueleng.github.io/img/d3/201609242115161474722916.68.jpg">
  <!-- canonical -->
  
  <link rel="canonical" href="http://ronghuaxueleng.github.io/archives/6472d63b.html">
  
  <!-- Favicon -->
  <link rel="shortcut icon" href="/img/favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
  <!-- CSS -->
  
<link rel="stylesheet" href="/css/reset.css">

  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/markdown.css">

  
<link rel="stylesheet" href="/css/fonts.css">

<meta name="generator" content="Hexo 7.3.0"></head>

    <body>
        <div class="paper">
            <div class="paper-main">
                
                    <div class="post-header">
    <a class="logo" href="/">白云雅阁</a>
    <!-- <div class="logo"><a href="/" title="Len"><img src="/img/logo.svg" alt="Len" aria-label="logo" height="20"></a></div> -->
        <ul class="nav">
            
            <li><a href="/">Home</a></li>
            
            <li><a href="/archives">Archives</a></li>
            
        </ul>


    </a>
</div>

                
                <div class="post-main">
    
        <div class="post-main-title">
            D3.js 入门教程系列
        </div>
        <div class="post-meta">
            2016-09-24 ｜ 
            
                <a href="/categories/d3/"># d3</a>
            
        </div>
        <!-- 圆角分类 -->
        <!-- <div class="tags"> -->
            <!--  -->
                <!-- <a href="/categories/d3/">d3</a> -->
            <!--  -->
        <!-- </div> -->
        <div class="post-md">
            <h2 id="初识D3"><a href="#初识D3" class="headerlink" title="初识D3"></a>初识D3</h2><p>D3是指数据驱动文档（Data-Driven Documents），根据D3的官方定义：</p>
<blockquote>
<p>D3.js是一个JavaScript库，它可以通过数据来操作文档。D3可以通过使用HTML、SVG和CSS把数据鲜活形象地展现出来。D3严格遵循Web标准，因而可以让你的程序轻松兼容现代主流浏览器并避免对特定框架的依赖。同时，它提供了强大的可视化组件，可以让使用者以数据驱动的方式去操作DOM。—-D3维基（2013年8月）</p>
</blockquote>
<span id="more"></span>


<p>从一个Hello Wordld示例来看看d3如何运行 <a href="http://gafish.github.io/demo/d3/helloworld.html">点击查看在线DEMO</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params">data</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> demo = d3.<span class="title function_">select</span>(<span class="string">&#x27;body&#x27;</span>)</span><br><span class="line">        .<span class="title function_">selectAll</span>(<span class="string">&#x27;p&#x27;</span>)</span><br><span class="line">        .<span class="title function_">data</span>(data, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> d;</span><br><span class="line">        &#125;);</span><br><span class="line">    </span><br><span class="line">    demo.<span class="title function_">enter</span>()</span><br><span class="line">        .<span class="title function_">append</span>(<span class="string">&#x27;p&#x27;</span>)</span><br><span class="line">        .<span class="title function_">style</span>(<span class="string">&#x27;width&#x27;</span>, <span class="number">0</span>+<span class="string">&#x27;px&#x27;</span>)</span><br><span class="line">        .<span class="title function_">style</span>(<span class="string">&#x27;background&#x27;</span>, <span class="string">&#x27;#eee&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    demo.<span class="title function_">text</span>(<span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> d;</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">transition</span>()</span><br><span class="line">        .<span class="title function_">duration</span>(<span class="number">1000</span>)</span><br><span class="line">        .<span class="title function_">style</span>(<span class="string">&#x27;width&#x27;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> d+<span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    demo.<span class="title function_">exit</span>()</span><br><span class="line">        .<span class="title function_">transition</span>()</span><br><span class="line">        .<span class="title function_">duration</span>(<span class="number">1000</span>)</span><br><span class="line">        .<span class="title function_">style</span>(<span class="string">&#x27;width&#x27;</span>, <span class="number">0</span>+<span class="string">&#x27;px&#x27;</span>)</span><br><span class="line">        .<span class="title function_">remove</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">render</span>([<span class="number">100</span>,<span class="number">300</span>,<span class="number">500</span>]);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title function_">render</span>([<span class="number">300</span>,<span class="number">500</span>,<span class="number">1000</span>]);</span><br><span class="line">&#125;,<span class="number">1000</span>)</span><br></pre></td></tr></table></figure>
<p>通过链式风格的方式让整个运行步骤非常清晰，D3的API设计跟我们平时用的Jquery很像，所以理解起来比较容易。<br>Hello World示例展示了数据如何驱动页面展示，在render方法里通过数据的变化，它做到了<code>初始化新数据</code>，<code>更新已有数据</code>，<code>删除无效数据</code>这样一个完整的环节；</p>
<h2 id="D3数据绑定"><a href="#D3数据绑定" class="headerlink" title="D3数据绑定"></a>D3数据绑定</h2><p>我们从Hello World示例代码来看D3如何做数据绑定</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> demo = d3.<span class="title function_">select</span>(<span class="string">&#x27;body&#x27;</span>)</span><br><span class="line">    .<span class="title function_">selectAll</span>(<span class="string">&#x27;p&#x27;</span>)</span><br><span class="line">    .<span class="title function_">data</span>(data, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> d;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<p>这段代码执行了以下步骤：</p>
<p>1、通过 d3.select(‘body’) 将页面上的body标签选中；<br>2、selectAll(‘p’) 返回了一个p标签的空选集(selection)；<br>3、空选集通过 data()方法将数据和p标签绑定，并产生三个虚拟的子集: enter, update,exit;</p>
<p><strong>其中enter()包含了待绑定数据及相应的标签的占位符;<br>update()包含了已绑定数据的p标签;<br>exit()包含了待移除数据p标签;<br>我们通过一张图来形象的理解enter, update , exit</strong></p>
<p><a href="/img/d3/201609242115161474722916.68.jpg"><img src="/img/d3/201609242115161474722916.68.jpg"></a></p>
<h3 id="enter数据"><a href="#enter数据" class="headerlink" title="enter数据"></a>enter数据</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">demo.<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&#x27;p&#x27;</span>)</span><br><span class="line">    .<span class="title function_">style</span>(<span class="string">&#x27;width&#x27;</span>, <span class="number">0</span>+<span class="string">&#x27;px&#x27;</span>)</span><br><span class="line">    .<span class="title function_">style</span>(<span class="string">&#x27;background&#x27;</span>, <span class="string">&#x27;#eee&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>这段代码为 enter() 中的占位符创建p标签，绑定相应的数据，并初始化样式；</p>
<h3 id="update数据"><a href="#update数据" class="headerlink" title="update数据"></a>update数据</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">demo</span><br><span class="line">    .<span class="title function_">text</span>(<span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> d;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">transition</span>()</span><br><span class="line">    .<span class="title function_">duration</span>(<span class="number">1000</span>)</span><br><span class="line">    .<span class="title function_">style</span>(<span class="string">&#x27;width&#x27;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> d+<span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>
<p>这段代码为 update() 中的p标签写入数字文本，并绑定transition动画，使它以动画形式展现；<br>是不是没看到 update() 的影子，没关系，update()会被隐式调用，之所以前面要提到 update 是为了更好的理解这三种状态；</p>
<h3 id="exit数据"><a href="#exit数据" class="headerlink" title="exit数据"></a>exit数据</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">demo.<span class="title function_">exit</span>()</span><br><span class="line">    .<span class="title function_">transition</span>()</span><br><span class="line">    .<span class="title function_">duration</span>(<span class="number">1000</span>)</span><br><span class="line">    .<span class="title function_">style</span>(<span class="string">&#x27;width&#x27;</span>, <span class="number">0</span>+<span class="string">&#x27;px&#x27;</span>)</span><br><span class="line">    .<span class="title function_">remove</span>();</span><br></pre></td></tr></table></figure>
<p>这段代码为 exit() 中的p标签绑定transition动画，使它以动画形式移除；</p>
<p><strong>D3的这种数据绑定方式的设计，使enter()里只是专心处理新增的元素，而update 和exit分别专注于处理更新和待删除部分，这意味着你不用把所有DOM元素删了重绘，因此得以轻松应对实时变化的数据，甚至支持一些交互(如拖动)与渐变的效果！</strong></p>
<h2 id="D3选择器"><a href="#D3选择器" class="headerlink" title="D3选择器"></a>D3选择器</h2><p>用过kissy的都知道它的选择器有 <code>Node.one</code> 和 <code>Node.all</code> 两个，前一个是选择第一个结果，后一个是选择所有结果；<br>D3的选择器跟kissy类似，只是名字换成了 <code>d3.select</code> 和 <code>d3.selectAll</code> ，应该比较好理解；</p>
<p>例如：</p>
<p>选中body标签</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> body = d3.<span class="title function_">select</span>(<span class="string">&#x27;body&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>选中所有p标签</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p = d3.<span class="title function_">selectAll</span>(<span class="string">&#x27;p&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>不一样的地方在于转换为原生dom时，Kissy是<code>Node.all(&#39;body&#39;)[0]</code> 而D3是<code>d3.selectAll(&#39;body&#39;)[0][0]</code></p>
<p>D3选择器还有以下这些方法帮助我们对节点或数据做一些操作</p>
<table>
<thead>
<tr>
<th>方法名</th>
<th>含义</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>selection.append</td>
<td>创建并追加一个新元素</td>
<td>p.append(‘span’)</td>
</tr>
<tr>
<td>selection.attr</td>
<td>取得或设置属性的值</td>
<td>p.attr(‘class’,’demo’)</td>
</tr>
<tr>
<td>selection.call</td>
<td>为当前选择调用一个函数</td>
<td>p.call(function(d){d.text(‘demo’)})</td>
</tr>
<tr>
<td>selection.classed</td>
<td>添加或移除CSS类</td>
<td>p.classed(‘demo’,true)</td>
</tr>
<tr>
<td>selection.data</td>
<td>为一组元素分别取得或设置数据</td>
<td>p.data([1,2,3],function(d){return d;})</td>
</tr>
<tr>
<td>selection.datum</td>
<td>为单个元素取得或设置数据</td>
<td>p.datum(1)</td>
</tr>
<tr>
<td>selection.each</td>
<td>为每个选中的元素调用一个函数</td>
<td>p.data([1,2,3]).each(function(d,i){console.log(d)})</td>
</tr>
<tr>
<td>selection.empty</td>
<td>如果选择是空则返回true</td>
<td>console.log(p.empty())</td>
</tr>
<tr>
<td>selection.enter</td>
<td>为缺失的元素返回占位符</td>
<td>p.enter()</td>
</tr>
<tr>
<td>selection.exit</td>
<td>返回不再需要的元素</td>
<td>p.exit()</td>
</tr>
<tr>
<td>selection.filter</td>
<td>基于数据过滤选择</td>
<td>p.data([1,2,3]).filter(function(d,i){return d%2&#x3D;&#x3D; 0})</td>
</tr>
<tr>
<td>selection.html</td>
<td>取得或设置innerHTML内容</td>
<td>p.html(‘1  2’)</td>
</tr>
<tr>
<td>selection.insert</td>
<td>在已存在元素之前创建并插入一个元素</td>
<td>p.insert(‘span’)</td>
</tr>
<tr>
<td>selection.interrupt</td>
<td>如果有过渡的话，立即中断当前的过渡</td>
<td>p.interrupt()</td>
</tr>
<tr>
<td>selection.node</td>
<td>返回选择中的第一个节点</td>
<td>p.node().innerHTML &#x3D; ‘demo’</td>
</tr>
<tr>
<td>selection.on</td>
<td>为交互添加或移除事件监听器</td>
<td>p.on(‘click’,function(d){console.log(d)})</td>
</tr>
<tr>
<td>selection.order</td>
<td>重排列文档中的元素，以匹配选择</td>
<td>var div &#x3D; d3.select(“body”).selectAll(“div”) .data([“a”, “b”, “f”]);div.enter().append(“div”) .text(String); var div &#x3D;d3.select(“body”).selectAll(“div”) .data([“a”, “b”, “c”, “d”, “e”, “f”],String); div.enter().append(“div”) .text(String); div.order();</td>
</tr>
<tr>
<td>selection.property</td>
<td>取得或设置行内属性</td>
<td>d3.select(‘input’).property(‘checked’)</td>
</tr>
<tr>
<td>selection.remove</td>
<td>从当前文档中移除当前元素</td>
<td>p.remove()</td>
</tr>
<tr>
<td>selection.select</td>
<td>为每个选中元素的在选择一个后代元素</td>
<td>p.select(‘span’)</td>
</tr>
<tr>
<td>selection.selectAll</td>
<td>为每个选中元素的在选择多个后代元素</td>
<td>p.selectAll(‘span)</td>
</tr>
<tr>
<td>selection.size</td>
<td>返回选择中的元素数</td>
<td>p.size()</td>
</tr>
<tr>
<td>selection.sort</td>
<td>基于数据排列文档中的元素</td>
<td>p.data([1,3,2]).sort(function (a,b) {return a&gt;b;})</td>
</tr>
<tr>
<td>selection.style</td>
<td>取得或设置样式属性</td>
<td>p.style(‘width’,’100px’)</td>
</tr>
<tr>
<td>selection.text</td>
<td>取得或设置文本内容</td>
<td>p.text(‘demo’)</td>
</tr>
<tr>
<td>selection.transition</td>
<td>在选中元素上开启过渡</td>
<td>p.transition()</td>
</tr>
</tbody></table>
<h2 id="D3-创建SVG"><a href="#D3-创建SVG" class="headerlink" title="D3 创建SVG"></a>D3 创建SVG</h2><p>D3图表大都是由SVG来实现的，所以在继续学习前需要了解一些SVG的知识，可以通过看<a href="http://www.w3school.com.cn/svg/">svg教程</a>来学习一下。</p>
<p>D3可以生成一般的SVG形状，它也内置了很多SVG图表，方便我们直接生成实用的图表。</p>
<p>我们先来创建一个SVG容器，其它SVG图形都需要在容器里来创建：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> body = d3.<span class="title function_">select</span>(<span class="string">&#x27;body&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> svg = body.<span class="title function_">append</span>(<span class="string">&#x27;svg&#x27;</span>).<span class="title function_">attr</span>(<span class="string">&#x27;width&#x27;</span>,<span class="number">200</span>).<span class="title function_">attr</span>(<span class="string">&#x27;height&#x27;</span>,<span class="number">200</span>);</span><br></pre></td></tr></table></figure>
<h3 id="普通SVG"><a href="#普通SVG" class="headerlink" title="普通SVG"></a>普通SVG</h3><p>用D3来生成一般的SVG图形，可以直接用 append + attr 就可以实现，例如：</p>
<h4 id="线条-line-："><a href="#线条-line-：" class="headerlink" title="线条(line)："></a>线条(line)：</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> line = svg.<span class="title function_">append</span>(<span class="string">&#x27;line&#x27;</span>)</span><br><span class="line">.<span class="title function_">attr</span>(<span class="string">&#x27;x1&#x27;</span>,<span class="number">100</span>)</span><br><span class="line">.<span class="title function_">attr</span>(<span class="string">&#x27;y1&#x27;</span>,<span class="number">100</span>)</span><br><span class="line">.<span class="title function_">style</span>(&#123;<span class="attr">fill</span>:<span class="string">&#x27;none&#x27;</span>,<span class="attr">stroke</span>:<span class="string">&#x27;#000&#x27;</span>&#125;);</span><br></pre></td></tr></table></figure>
<p><a href="/img/d3/201609242115161474722916.82.jpg"><img src="/img/d3/201609242115161474722916.82.jpg"></a></p>
<h4 id="圆-circle-："><a href="#圆-circle-：" class="headerlink" title="圆(circle)："></a>圆(circle)：</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> circle = svg.<span class="title function_">append</span>(<span class="string">&#x27;circle&#x27;</span>)</span><br><span class="line">.<span class="title function_">attr</span>(<span class="string">&#x27;cx&#x27;</span>,<span class="number">50</span>)</span><br><span class="line">.<span class="title function_">attr</span>(<span class="string">&#x27;cy&#x27;</span>,<span class="number">50</span>)</span><br><span class="line">.<span class="title function_">attr</span>(<span class="string">&#x27;r&#x27;</span>,<span class="number">50</span>)</span><br><span class="line">.<span class="title function_">style</span>(&#123;<span class="attr">fill</span>:<span class="string">&#x27;#000&#x27;</span>&#125;);</span><br></pre></td></tr></table></figure>
<p><a href="/img/d3/201609242115161474722916.95.jpg"><img src="/img/d3/201609242115161474722916.95.jpg"></a></p>
<h3 id="SVG生成器"><a href="#SVG生成器" class="headerlink" title="SVG生成器"></a>SVG生成器</h3><p>D3为我们提供了更复杂的svg图形生成器，结合数据我们可以轻松绘制出复杂的SVG，例如：</p>
<h4 id="折线图-d3-svg-line-："><a href="#折线图-d3-svg-line-：" class="headerlink" title="折线图(d3.svg.line)："></a>折线图(d3.svg.line)：</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> data = [[</span><br><span class="line">    &#123;<span class="attr">x</span>:<span class="number">0</span>,<span class="attr">y</span>:<span class="number">100</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">x</span>:<span class="number">50</span>,<span class="attr">y</span>:<span class="number">80</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">x</span>:<span class="number">100</span>,<span class="attr">y</span>:<span class="number">150</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">x</span>:<span class="number">150</span>,<span class="attr">y</span>:<span class="number">50</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">x</span>:<span class="number">200</span>,<span class="attr">y</span>:<span class="number">120</span>&#125;</span><br><span class="line">]];</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> line = d3.<span class="property">svg</span>.<span class="title function_">line</span>()</span><br><span class="line">.<span class="title function_">x</span>(<span class="keyword">function</span>(<span class="params">d</span>)&#123;<span class="keyword">return</span> d.<span class="property">x</span>&#125;)</span><br><span class="line">.<span class="title function_">y</span>(<span class="keyword">function</span>(<span class="params">d</span>)&#123;<span class="keyword">return</span> <span class="number">200</span>-d.<span class="property">y</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> lineChart = svg.<span class="title function_">selectAll</span>(<span class="string">&#x27;path&#x27;</span>).<span class="title function_">data</span>(data);</span><br><span class="line">lineChart.<span class="title function_">enter</span>()</span><br><span class="line">.<span class="title function_">append</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line">.<span class="title function_">attr</span>(<span class="string">&#x27;d&#x27;</span>,<span class="keyword">function</span>(<span class="params">d</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">line</span>(d)</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">style</span>(&#123;<span class="attr">fill</span>:<span class="string">&#x27;none&#x27;</span>,<span class="attr">stroke</span>:<span class="string">&#x27;#000&#x27;</span>&#125;);</span><br></pre></td></tr></table></figure>
<p><a href="/img/d3/201609242115171474722917.08.jpg"><img src="/img/d3/201609242115171474722917.08.jpg"></a></p>
<h4 id="面积图-d3-svg-area-："><a href="#面积图-d3-svg-area-：" class="headerlink" title="面积图(d3.svg.area)："></a>面积图(d3.svg.area)：</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> data = [[</span><br><span class="line">    &#123;<span class="attr">x</span>:<span class="number">0</span>,<span class="attr">y</span>:<span class="number">100</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">x</span>:<span class="number">50</span>,<span class="attr">y</span>:<span class="number">80</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">x</span>:<span class="number">100</span>,<span class="attr">y</span>:<span class="number">150</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">x</span>:<span class="number">150</span>,<span class="attr">y</span>:<span class="number">50</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">x</span>:<span class="number">200</span>,<span class="attr">y</span>:<span class="number">120</span>&#125;</span><br><span class="line">]];</span><br><span class="line"><span class="keyword">var</span> area = d3.<span class="property">svg</span>.<span class="title function_">area</span>()</span><br><span class="line">.<span class="title function_">x</span>(<span class="keyword">function</span>(<span class="params">d</span>)&#123;<span class="keyword">return</span> d.<span class="property">x</span>&#125;)</span><br><span class="line">.<span class="title function_">y0</span>(<span class="keyword">function</span>(<span class="params">d</span>)&#123;<span class="keyword">return</span> <span class="number">200</span>&#125;)</span><br><span class="line">.<span class="title function_">y1</span>(<span class="keyword">function</span>(<span class="params">d</span>)&#123;<span class="keyword">return</span> <span class="number">200</span>-d.<span class="property">y</span>&#125;);</span><br><span class="line"><span class="keyword">var</span> areaChart = svg.<span class="title function_">selectAll</span>(<span class="string">&#x27;path&#x27;</span>).<span class="title function_">data</span>(data);</span><br><span class="line">areaChart.<span class="title function_">enter</span>()</span><br><span class="line">.<span class="title function_">append</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line">.<span class="title function_">attr</span>(<span class="string">&#x27;d&#x27;</span>,<span class="keyword">function</span>(<span class="params">d</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">area</span>(d)</span><br><span class="line">&#125;).<span class="title function_">style</span>(&#123;<span class="attr">fill</span>:<span class="string">&#x27;#000&#x27;</span>&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a href="/img/d3/201609242115171474722917.24.jpg"><img src="/img/d3/201609242115171474722917.24.jpg"></a></p>
<h4 id="圆弧图-d3-svg-arc-："><a href="#圆弧图-d3-svg-arc-：" class="headerlink" title="圆弧图(d3.svg.arc)："></a>圆弧图(d3.svg.arc)：</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> angle = <span class="number">2</span>*<span class="title class_">Math</span>.<span class="property">PI</span>;</span><br><span class="line"><span class="keyword">var</span> data = [&#123;<span class="attr">startAngle</span>:<span class="number">0</span>,<span class="attr">endAngle</span>:<span class="number">0.2</span>*angle&#125;,&#123;<span class="attr">startAngle</span>:<span class="number">0.5</span>*angle,<span class="attr">endAngle</span>:<span class="number">0.8</span>*angle&#125;];</span><br><span class="line"><span class="keyword">var</span> arc = d3.<span class="property">svg</span>.<span class="title function_">arc</span>().<span class="title function_">innerRadius</span>(<span class="number">50</span>).<span class="title function_">outerRadius</span>(<span class="number">100</span>);</span><br><span class="line"><span class="keyword">var</span> arcChart = svg.<span class="title function_">selectAll</span>(<span class="string">&#x27;path&#x27;</span>).<span class="title function_">data</span>(data);</span><br><span class="line">arcChart.<span class="title function_">enter</span>()</span><br><span class="line">.<span class="title function_">append</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line">.<span class="title function_">attr</span>(<span class="string">&#x27;transform&#x27;</span>,<span class="string">&#x27;translate(100,100)&#x27;</span>)</span><br><span class="line">.<span class="title function_">attr</span>(<span class="string">&#x27;d&#x27;</span>,<span class="keyword">function</span>(<span class="params">d</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">arc</span>(d)</span><br><span class="line">&#125;).<span class="title function_">style</span>(&#123;<span class="attr">fill</span>:<span class="string">&#x27;#000&#x27;</span>&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a href="/img/d3/201609242115171474722917.38.jpg"><img src="/img/d3/201609242115171474722917.38.jpg"></a></p>
<h4 id="径向折线图-d3-svg-line-radial-："><a href="#径向折线图-d3-svg-line-radial-：" class="headerlink" title="径向折线图(d3.svg.line.radial)："></a>径向折线图(d3.svg.line.radial)：</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> angle = <span class="number">2</span>*<span class="title class_">Math</span>.<span class="property">PI</span>;</span><br><span class="line"><span class="keyword">var</span> data = [[<span class="number">100</span>,<span class="number">80</span>,<span class="number">60</span>,<span class="number">90</span>,<span class="number">90</span>,<span class="number">100</span>]];</span><br><span class="line"><span class="keyword">var</span> lineRadial = d3.<span class="property">svg</span>.<span class="property">line</span>.<span class="title function_">radial</span>()</span><br><span class="line">.<span class="title function_">radius</span>(<span class="keyword">function</span>(<span class="params">d</span>)&#123;<span class="keyword">return</span> d&#125;)</span><br><span class="line">.<span class="title function_">angle</span>(<span class="keyword">function</span>(<span class="params">d,i</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(i == <span class="number">5</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> (i/<span class="number">5</span>)*angle</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">var</span> lineRadialChart = svg.<span class="title function_">selectAll</span>(<span class="string">&#x27;path&#x27;</span>).<span class="title function_">data</span>(data);</span><br><span class="line">lineRadialChart.<span class="title function_">enter</span>()</span><br><span class="line">.<span class="title function_">append</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line">.<span class="title function_">attr</span>(<span class="string">&#x27;transform&#x27;</span>,<span class="string">&#x27;translate(100,100)&#x27;</span>)</span><br><span class="line">.<span class="title function_">attr</span>(<span class="string">&#x27;d&#x27;</span>,<span class="keyword">function</span>(<span class="params">d</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">lineRadial</span>(d)</span><br><span class="line">&#125;).<span class="title function_">style</span>(&#123;<span class="attr">fill</span>:<span class="string">&#x27;none&#x27;</span>,<span class="attr">stroke</span>:<span class="string">&#x27;#000&#x27;</span>&#125;);</span><br></pre></td></tr></table></figure>
<p><a href="/img/d3/201609242115171474722917.52.jpg"><img src="/img/d3/201609242115171474722917.52.jpg"></a></p>
<h4 id="径向面积图-d3-svg-area-radial-："><a href="#径向面积图-d3-svg-area-radial-：" class="headerlink" title="径向面积图(d3.svg.area.radial)："></a>径向面积图(d3.svg.area.radial)：</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> angle = <span class="number">2</span>*<span class="title class_">Math</span>.<span class="property">PI</span>;</span><br><span class="line"><span class="keyword">var</span> data = [[<span class="number">100</span>,<span class="number">80</span>,<span class="number">60</span>,<span class="number">90</span>,<span class="number">90</span>,<span class="number">100</span>]];</span><br><span class="line"><span class="keyword">var</span> areaRadial = d3.<span class="property">svg</span>.<span class="property">area</span>.<span class="title function_">radial</span>()</span><br><span class="line">.<span class="title function_">innerRadius</span>(<span class="keyword">function</span>(<span class="params">d</span>) &#123; <span class="keyword">return</span> d/<span class="number">2</span>; &#125;)</span><br><span class="line">.<span class="title function_">outerRadius</span>(<span class="keyword">function</span>(<span class="params">d</span>) &#123; <span class="keyword">return</span> d; &#125;)</span><br><span class="line">.<span class="title function_">angle</span>(<span class="keyword">function</span>(<span class="params">d,i</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(i == <span class="number">5</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> (i/<span class="number">5</span>)*angle</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> areaRadialChart = svg.<span class="title function_">selectAll</span>(<span class="string">&#x27;path&#x27;</span>).<span class="title function_">data</span>(data);</span><br><span class="line">areaRadialChart.<span class="title function_">enter</span>()</span><br><span class="line">.<span class="title function_">append</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line">.<span class="title function_">attr</span>(<span class="string">&#x27;transform&#x27;</span>,<span class="string">&#x27;translate(100,100)&#x27;</span>)</span><br><span class="line">.<span class="title function_">attr</span>(<span class="string">&#x27;d&#x27;</span>,<span class="keyword">function</span>(<span class="params">d</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">areaRadial</span>(d)</span><br><span class="line">&#125;).<span class="title function_">style</span>(&#123;<span class="attr">fill</span>:<span class="string">&#x27;#000&#x27;</span>&#125;);</span><br></pre></td></tr></table></figure>
<p><a href="/img/d3/201609242115171474722917.69.jpg"><img src="/img/d3/201609242115171474722917.69.jpg"></a></p>
<h4 id="弦图-d3-svg-chord-："><a href="#弦图-d3-svg-chord-：" class="headerlink" title="弦图(d3.svg.chord)："></a>弦图(d3.svg.chord)：</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> angle = <span class="number">2</span>*<span class="title class_">Math</span>.<span class="property">PI</span>;</span><br><span class="line"><span class="keyword">var</span> chordRadial = d3.<span class="property">svg</span>.<span class="title function_">chord</span>()</span><br><span class="line">.<span class="title function_">radius</span>(<span class="number">100</span>)</span><br><span class="line">.<span class="title function_">source</span>(&#123;<span class="attr">startAngle</span>:<span class="number">0</span>,<span class="attr">endAngle</span>:<span class="number">0.1</span>*angle&#125;).<span class="title function_">target</span>(&#123;<span class="attr">startAngle</span>:<span class="number">0.4</span>*angle,<span class="attr">endAngle</span>:<span class="number">0.8</span>*angle&#125;);</span><br><span class="line"><span class="keyword">var</span> chordRadialChart = svg.<span class="title function_">append</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line">.<span class="title function_">attr</span>(<span class="string">&#x27;transform&#x27;</span>,<span class="string">&#x27;translate(100,100)&#x27;</span>)</span><br><span class="line">.<span class="title function_">attr</span>(<span class="string">&#x27;d&#x27;</span>,<span class="keyword">function</span>(<span class="params">d</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">chordRadial</span>(d)</span><br><span class="line">&#125;).<span class="title function_">style</span>(&#123;<span class="attr">fill</span>:<span class="string">&#x27;#000&#x27;</span>&#125;);</span><br></pre></td></tr></table></figure>
<p><a href="/img/d3/201609242115171474722917.86.jpg"><img src="/img/d3/201609242115171474722917.86.jpg"></a></p>
<h4 id="对角线图-d3-svg-diagonal-："><a href="#对角线图-d3-svg-diagonal-：" class="headerlink" title="对角线图(d3.svg.diagonal)："></a>对角线图(d3.svg.diagonal)：</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> angle = <span class="number">2</span>*<span class="title class_">Math</span>.<span class="property">PI</span>;</span><br><span class="line"><span class="keyword">var</span> diagonal = d3.<span class="property">svg</span>.<span class="title function_">diagonal</span>()</span><br><span class="line">.<span class="title function_">source</span>(&#123;<span class="attr">x</span>:<span class="number">10</span>,<span class="attr">y</span>:<span class="number">30</span>&#125;)</span><br><span class="line">.<span class="title function_">target</span>(&#123;<span class="attr">x</span>:<span class="number">180</span>,<span class="attr">y</span>:<span class="number">200</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> diagonalRadialChart = svg.<span class="title function_">append</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line">.<span class="title function_">attr</span>(<span class="string">&#x27;d&#x27;</span>,<span class="keyword">function</span>(<span class="params">d</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">diagonal</span>(d)</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">style</span>(&#123;<span class="attr">fill</span>:<span class="string">&#x27;none&#x27;</span>,<span class="attr">stroke</span>:<span class="string">&#x27;#000&#x27;</span>&#125;);</span><br></pre></td></tr></table></figure>
<p><a href="/img/d3/201609242115181474722918.02.jpg"><img src="/img/d3/201609242115181474722918.02.jpg"></a></p>
<h4 id="符号-d3-svg-symbol-："><a href="#符号-d3-svg-symbol-：" class="headerlink" title="符号(d3.svg.symbol)："></a>符号(d3.svg.symbol)：</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> symbol = d3.<span class="property">svg</span>.<span class="title function_">symbol</span>()</span><br><span class="line">.<span class="title function_">type</span>(<span class="keyword">function</span>(<span class="params">d,i</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> type[d-<span class="number">1</span>]</span><br><span class="line">&#125;).<span class="title function_">size</span>(<span class="keyword">function</span>(<span class="params">d</span>)&#123;<span class="keyword">return</span> d*<span class="number">50</span>;&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> data = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>];</span><br><span class="line"><span class="keyword">var</span> type = [</span><br><span class="line">    <span class="string">&#x27;circle&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;cross&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;diamond&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;square&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;triangle-down&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;triangle-up&#x27;</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> symbolChart = svg.<span class="title function_">selectAll</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line">.<span class="title function_">data</span>(data).<span class="title function_">enter</span>()</span><br><span class="line">.<span class="title function_">append</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line">symbolChart</span><br><span class="line">.<span class="title function_">attr</span>(<span class="string">&#x27;transform&#x27;</span>,<span class="keyword">function</span>(<span class="params">d,i</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> t = i*<span class="number">20</span>+<span class="number">10</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;translate(&#x27;</span>+ t +<span class="string">&#x27;,&#x27;</span>+ t +<span class="string">&#x27;)&#x27;</span>&#125;)</span><br><span class="line">.<span class="title function_">attr</span>(<span class="string">&#x27;d&#x27;</span>,<span class="keyword">function</span>(<span class="params">d</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">symbol</span>(d)</span><br><span class="line">&#125;).<span class="title function_">style</span>(&#123;<span class="attr">fill</span>:<span class="string">&#x27;none&#x27;</span>,<span class="attr">stroke</span>:<span class="string">&#x27;#000&#x27;</span>&#125;);</span><br></pre></td></tr></table></figure>
<p><a href="/img/d3/201609242115181474722918.15.jpg"><img src="/img/d3/201609242115181474722918.15.jpg"></a></p>
<h4 id="坐标轴-d3-svg-axis-："><a href="#坐标轴-d3-svg-axis-：" class="headerlink" title="坐标轴(d3.svg.axis)："></a>坐标轴(d3.svg.axis)：</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> axisx = d3.<span class="property">svg</span>.<span class="title function_">axis</span>()</span><br><span class="line">.<span class="title function_">scale</span>(</span><br><span class="line">    d3.<span class="property">scale</span>.<span class="title function_">linear</span>()</span><br><span class="line">    .<span class="title function_">domain</span>([<span class="number">0</span>,<span class="number">100</span>])</span><br><span class="line">    .<span class="title function_">range</span>([<span class="number">0</span>,<span class="number">140</span>])</span><br><span class="line">)</span><br><span class="line">.<span class="title function_">ticks</span>(<span class="number">5</span>);</span><br><span class="line"><span class="keyword">var</span> axisxChart = svg.<span class="title function_">append</span>(<span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">.<span class="title function_">attr</span>(<span class="string">&#x27;transform&#x27;</span>,<span class="string">&#x27;translate(30,170)&#x27;</span>)</span><br><span class="line">.<span class="title function_">call</span>(axisx)</span><br><span class="line">.<span class="title function_">style</span>(&#123;</span><br><span class="line">    <span class="attr">fill</span>:<span class="string">&#x27;none&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;stroke-width&#x27;</span>:<span class="number">1</span>,</span><br><span class="line">    <span class="attr">stroke</span>:<span class="string">&#x27;#000&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;font-size&#x27;</span>:<span class="number">12</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> axisy = d3.<span class="property">svg</span>.<span class="title function_">axis</span>()</span><br><span class="line">.<span class="title function_">scale</span>(</span><br><span class="line">    d3.<span class="property">scale</span>.<span class="title function_">linear</span>()</span><br><span class="line">    .<span class="title function_">domain</span>([<span class="number">0</span>,<span class="number">100</span>])</span><br><span class="line">    .<span class="title function_">range</span>([<span class="number">140</span>,<span class="number">0</span>])</span><br><span class="line">)</span><br><span class="line">.<span class="title function_">ticks</span>(<span class="number">5</span>)</span><br><span class="line">.<span class="title function_">orient</span>(<span class="string">&#x27;left&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> axisyChart = svg.<span class="title function_">append</span>(<span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">.<span class="title function_">attr</span>(<span class="string">&#x27;transform&#x27;</span>,<span class="string">&#x27;translate(30,30)&#x27;</span>)</span><br><span class="line">.<span class="title function_">call</span>(axisy)</span><br><span class="line">.<span class="title function_">style</span>(&#123;</span><br><span class="line">    <span class="attr">fill</span>:<span class="string">&#x27;none&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;stroke-width&#x27;</span>:<span class="number">1</span>,</span><br><span class="line">    <span class="attr">stroke</span>:<span class="string">&#x27;#000&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;font-size&#x27;</span>:<span class="number">12</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><a href="/img/d3/201609242115181474722918.36.jpg"><img src="/img/d3/201609242115181474722918.36.jpg"></a></p>
<h4 id="brush-d3-svg-brush-："><a href="#brush-d3-svg-brush-：" class="headerlink" title="brush(d3.svg.brush)："></a>brush(d3.svg.brush)：</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">svg.<span class="title function_">style</span>(<span class="string">&#x27;background&#x27;</span>,<span class="string">&#x27;#eee&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> linear = d3.<span class="property">scale</span>.<span class="title function_">linear</span>()</span><br><span class="line">.<span class="title function_">domain</span>([<span class="number">0</span>,<span class="number">100</span>])</span><br><span class="line">.<span class="title function_">range</span>([<span class="number">0</span>,<span class="number">200</span>]);</span><br><span class="line"><span class="keyword">var</span> brush = d3.<span class="property">svg</span>.<span class="title function_">brush</span>()</span><br><span class="line">.<span class="title function_">x</span>(linear)</span><br><span class="line">.<span class="title function_">on</span>(<span class="string">&#x27;brush&#x27;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(brush.<span class="title function_">extent</span>());</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">var</span> g = svg.<span class="title function_">append</span>(<span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">.<span class="title function_">call</span>(brush).<span class="title function_">selectAll</span>(<span class="string">&#x27;rect&#x27;</span>)</span><br><span class="line">.<span class="title function_">attr</span>(<span class="string">&#x27;height&#x27;</span>,<span class="number">200</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a href="/img/d3/201609242115181474722918.51.jpg"><img src="/img/d3/201609242115181474722918.51.jpg"></a></p>
<p><a href="http://gafish.github.io/demo/d3/svg.html">点击这里查看在线效果</a></p>
<p><em>D3制作图表的过程就是将各种SVG图形拼接在一起的过程；</em></p>
<h2 id="D3-SVG图表示例"><a href="#D3-SVG图表示例" class="headerlink" title="D3 SVG图表示例"></a>D3 SVG图表示例</h2><p>之前有说到“D3制作图表的过程就是将各种SVG图形拼接在一起的过程”，具体来说折线图表就是<code>折线图</code>+<code>坐标轴</code>的组合，面积图是<code>折线图</code>+<code>坐标轴</code>+<code>面积图</code></p>
<p>一个完整的SVG图表，是包含了各种数据、SVG图形、样式、交互组成的组合体，我们以面积图表来做一个示例展示：</p>
<h3 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">svg</span>&#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.line</span>&#123;</span><br><span class="line">  <span class="attribute">fill</span>:none;</span><br><span class="line">  <span class="attribute">stroke-width</span>:<span class="number">1</span>;</span><br><span class="line">  <span class="attribute">stroke</span>:<span class="number">#000</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.axis</span> <span class="selector-tag">line</span>&#123;</span><br><span class="line">  <span class="attribute">stroke</span>: <span class="number">#000</span>;</span><br><span class="line">  <span class="attribute">stroke-width</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.axis</span> <span class="selector-class">.domain</span>&#123;</span><br><span class="line">  <span class="attribute">fill</span>:none;</span><br><span class="line">  <span class="attribute">stroke-width</span>:<span class="number">1</span>;</span><br><span class="line">  <span class="attribute">stroke</span>:<span class="number">#000</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.area</span>&#123;</span><br><span class="line">  <span class="attribute">fill</span>: <span class="number">#eee</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="数据"><a href="#数据" class="headerlink" title="数据"></a>数据</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">var _data = <span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">4</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">4</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">2</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">6</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">3</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">4</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">5</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">6</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">6</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">8</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">9</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">5</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">3</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
<h3 id="创建SVG容器"><a href="#创建SVG容器" class="headerlink" title="创建SVG容器"></a>创建SVG容器</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _width = <span class="number">600</span>;</span><br><span class="line"><span class="keyword">var</span> _height = <span class="number">300</span>;</span><br><span class="line"><span class="keyword">var</span> _margin = &#123;<span class="attr">top</span>:<span class="number">30</span>,<span class="attr">right</span>:<span class="number">30</span>,<span class="attr">bottom</span>:<span class="number">30</span>,<span class="attr">left</span>:<span class="number">30</span>&#125;;</span><br><span class="line"><span class="keyword">var</span> _xStart = _margin.<span class="property">left</span>;</span><br><span class="line"><span class="keyword">var</span> _xEnd = _width - _margin.<span class="property">right</span>;</span><br><span class="line"><span class="keyword">var</span> _yStart = _height - _margin.<span class="property">bottom</span>;</span><br><span class="line"><span class="keyword">var</span> _yEnd = _margin.<span class="property">top</span>;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">var</span> _svg = d3.<span class="title function_">select</span>(<span class="string">&#x27;body&#x27;</span>).<span class="title function_">append</span>(<span class="string">&#x27;svg&#x27;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;width&#x27;</span>,_width)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;height&#x27;</span>,_height);</span><br><span class="line"><span class="keyword">var</span> _bodyG = _svg.<span class="title function_">append</span>(<span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;transform&#x27;</span>,<span class="string">&#x27;translate(&#x27;</span>+ _xStart +<span class="string">&#x27;,&#x27;</span>+ _yEnd +<span class="string">&#x27;)&#x27;</span>);</span><br></pre></td></tr></table></figure>
<h3 id="设置数据比例尺"><a href="#设置数据比例尺" class="headerlink" title="设置数据比例尺"></a>设置数据比例尺</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">var</span> _quadrantWidth = _width - _margin.<span class="property">left</span> - _margin.<span class="property">right</span>;</span><br><span class="line"><span class="keyword">var</span> _quadrantHeight = _height - _margin.<span class="property">top</span> - _margin.<span class="property">bottom</span>;</span><br><span class="line"><span class="keyword">var</span> _x = d3.<span class="property">scale</span>.<span class="title function_">linear</span>().<span class="title function_">domain</span>([<span class="number">0</span>,<span class="number">10</span>]).<span class="title function_">range</span>([<span class="number">0</span>,_quadrantWidth])</span><br><span class="line"><span class="keyword">var</span> _y = d3.<span class="property">scale</span>.<span class="title function_">linear</span>().<span class="title function_">domain</span>([<span class="number">0</span>,<span class="number">10</span>]).<span class="title function_">range</span>([_quadrantHeight,<span class="number">0</span>])</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<h3 id="生成X轴SVG图"><a href="#生成X轴SVG图" class="headerlink" title="生成X轴SVG图"></a>生成X轴SVG图</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">var</span> _xAxis = d3.<span class="property">svg</span>.<span class="title function_">axis</span>()</span><br><span class="line">    .<span class="title function_">scale</span>(_x)</span><br><span class="line">    .<span class="title function_">orient</span>(<span class="string">&#x27;bottom&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">_svg.<span class="title function_">append</span>(<span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">    .<span class="title function_">classed</span>(<span class="string">&#x27;x axis&#x27;</span>,<span class="literal">true</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;transform&#x27;</span>, <span class="string">&#x27;translate(&#x27;</span>+ _xStart +<span class="string">&#x27;, &#x27;</span>+ _yStart +<span class="string">&#x27;)&#x27;</span>)</span><br><span class="line">    .<span class="title function_">call</span>(_xAxis);</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<h3 id="生成Y轴SVG图"><a href="#生成Y轴SVG图" class="headerlink" title="生成Y轴SVG图"></a>生成Y轴SVG图</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">var</span> _yAxis = d3.<span class="property">svg</span>.<span class="title function_">axis</span>()</span><br><span class="line">    .<span class="title function_">scale</span>(_y)</span><br><span class="line">    .<span class="title function_">orient</span>(<span class="string">&#x27;left&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">_svg.<span class="title function_">append</span>(<span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">      .<span class="title function_">classed</span>(<span class="string">&#x27;y axis&#x27;</span>,<span class="literal">true</span>)</span><br><span class="line">      .<span class="title function_">attr</span>(<span class="string">&#x27;transform&#x27;</span>,<span class="string">&#x27;translate(&#x27;</span>+ _xStart +<span class="string">&#x27;,&#x27;</span>+ _yEnd +<span class="string">&#x27;)&#x27;</span>)</span><br><span class="line">      .<span class="title function_">call</span>(_yAxis);</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<h3 id="生成折线SVG图"><a href="#生成折线SVG图" class="headerlink" title="生成折线SVG图"></a>生成折线SVG图</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">var</span> _line = d3.<span class="property">svg</span>.<span class="title function_">line</span>()</span><br><span class="line">    .<span class="title function_">x</span>(<span class="keyword">function</span>(<span class="params">d</span>)&#123;<span class="keyword">return</span> <span class="title function_">_x</span>(d.<span class="property">x</span>)&#125;)</span><br><span class="line">    .<span class="title function_">y</span>(<span class="keyword">function</span>(<span class="params">d</span>)&#123;<span class="keyword">return</span> <span class="title function_">_y</span>(d.<span class="property">y</span>)&#125;);</span><br><span class="line"><span class="keyword">var</span> _linePath = _bodyG.<span class="title function_">selectAll</span>(<span class="string">&#x27;.line&#x27;</span>).<span class="title function_">data</span>(_data);</span><br><span class="line">    </span><br><span class="line">_linePath</span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line">    .<span class="title function_">classed</span>(<span class="string">&#x27;line&#x27;</span>,<span class="literal">true</span>);</span><br><span class="line">    </span><br><span class="line">_linePath</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;d&#x27;</span>, <span class="keyword">function</span>(<span class="params">d</span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">_line</span>(d);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<h3 id="生成面积SVG图"><a href="#生成面积SVG图" class="headerlink" title="生成面积SVG图"></a>生成面积SVG图</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">var</span> _area = d3.<span class="property">svg</span>.<span class="title function_">area</span>()</span><br><span class="line">    .<span class="title function_">x</span>(<span class="keyword">function</span>(<span class="params">d</span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">_x</span>(d.<span class="property">x</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">y0</span>(<span class="keyword">function</span>(<span class="params">d</span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> _quadrantHeight;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">y1</span>(<span class="keyword">function</span>(<span class="params">d</span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">_y</span>(d.<span class="property">y</span>);</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="keyword">var</span> _areaPath = _bodyG.<span class="title function_">selectAll</span>(<span class="string">&#x27;.area&#x27;</span>).<span class="title function_">data</span>(_data);</span><br><span class="line">    </span><br><span class="line">_areaPath</span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line">    .<span class="title function_">classed</span>(<span class="string">&#x27;area&#x27;</span>,<span class="literal">true</span>);</span><br><span class="line">    </span><br><span class="line">_areaPath</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;d&#x27;</span>, <span class="keyword">function</span>(<span class="params">d</span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">_area</span>(d);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<p><em>在这个示例中完整的展现了一个D3图表是怎么将数据与图形做绑定，以及如何将不同的SVG组合成一个完整的图表，还用到了目前为止没讲过的D3比例尺，这个在下节中来学习；</em></p>
<p><a href="http://gafish.github.io/demo/d3/areachart.html">查看在线示例</a></p>
<h2 id="D3比例尺"><a href="#D3比例尺" class="headerlink" title="D3比例尺"></a>D3比例尺</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>比例尺是一组把<code>输入域</code>映射为<code>输出范围</code>的函数，它将<code>真实值</code>跟<code>实际显示值</code>做了一个映射，在之前的例子中，我们已经用到了线性比例尺；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _x = d3.<span class="property">scale</span>.<span class="title function_">linear</span>().<span class="title function_">domain</span>([<span class="number">0</span>,<span class="number">10</span>]).<span class="title function_">range</span>([<span class="number">0</span>,<span class="number">100</span>])</span><br></pre></td></tr></table></figure>
<p>它的意思是将<code>0-10</code>之间的输入域以线性的方式映射到<code>0-100</code>的输出范围上，也就是说传入的值为10，显示的时候显示为100；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_">_x</span>(<span class="number">0</span>); <span class="comment">// 返回0</span></span><br><span class="line"><span class="title function_">_x</span>(<span class="number">5</span>); <span class="comment">// 返回50</span></span><br><span class="line"><span class="title function_">_x</span>(<span class="number">10</span>); <span class="comment">// 返回100</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h3><h4 id="x-nice"><a href="#x-nice" class="headerlink" title="_x.nice()"></a>_x.nice()</h4><p>告诉比例尺取得为range() 设置的任何值域，把两端的值扩展到最接近的数，比如，值域<code>[0.20147987687960267,0.996679553296417]</code>的扩展值域为<code>[0.2,1]</code>，这个方法对正常人都有用，因为人不是计算机，看到0.20147987687960267这样的数你一定会头大。</p>
<h4 id="x-rangeRound"><a href="#x-rangeRound" class="headerlink" title="_x.rangeRound()"></a>_x.rangeRound()</h4><p>用rangeRound() 代替range()<br>后，则比例尺输出的所有值都会舍入到最接近的整数值，对输出值取整有利于图形对应精确的像素值，避免边缘出现模糊不清的锯齿。</p>
<h4 id="x-clamp"><a href="#x-clamp" class="headerlink" title="_x.clamp()"></a>_x.clamp()</h4><p>默认情况下，线性比例尺可以返回指定范围之外的值。例如，假如给定的值位于输入值域之外，那么比例尺也会返回一个位于输出范围之外的值。不过，在比例尺上调用<code>clamp(true)</code>后，就可以强制所有输出值都位于指定的范围内。这意味着超出范围的值，会被取整到范围的最低值或最高值（总之是最接近的那个值）。</p>
<h3 id="其它比例尺："><a href="#其它比例尺：" class="headerlink" title="其它比例尺："></a>其它比例尺：</h3><h4 id="d3-scale-linear-线性比例尺"><a href="#d3-scale-linear-线性比例尺" class="headerlink" title="d3.scale.linear - 线性比例尺"></a>d3.scale.linear - 线性比例尺</h4><p>将输入域值按线性等比的方式分隔作为输出范围</p>
<p>示例：d3.scale.linear().domain([0,100]).range([0,700])<br>应用场景：按比例、成直线的展现或者规则、光滑的运动</p>
<p><a href="/img/d3/201609242115181474722918.66.jpg"><img src="/img/d3/201609242115181474722918.66.jpg"></a></p>
<h4 id="d3-scale-identity-线性恒等比例尺"><a href="#d3-scale-identity-线性恒等比例尺" class="headerlink" title="d3.scale.identity - 线性恒等比例尺"></a>d3.scale.identity - 线性恒等比例尺</h4><p>线性恒等比例尺是线性比例尺的特殊类型，实现输入域与输出范围 1:1 的缩放，其方法都是恒等函数</p>
<p>示例：d3.scale.identity().domain([0,100])<br>应用场景：在处理像素坐标时有用，输入值是多少像素，在输出显示时也是多少像素</p>
<p><a href="/img/d3/201609242115181474722918.83.jpg"><img src="/img/d3/201609242115181474722918.83.jpg"></a></p>
<h4 id="d3-scale-quantize-量化比例尺"><a href="#d3-scale-quantize-量化比例尺" class="headerlink" title="d3.scale.quantize - 量化比例尺"></a>d3.scale.quantize - 量化比例尺</h4><p>量化比例尺是线性比例尺的变体，输入的域是连续的，使用离散的range，输入数据被分割成不同的片段，也即是分类，如10个人按设定的年龄分类。</p>
<p>示例：d3.scale.quantize().domain([0,10]).range([0,10,20,30,40,50,60,70]);<br>应用场景：想把数据分类的情形（<code>！还没想到最适合的业务场景</code>）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> quantize = d3.<span class="property">scale</span>.<span class="title function_">quantize</span>().<span class="title function_">domain</span>([<span class="number">0</span>,<span class="number">10</span>]).<span class="title function_">range</span>([<span class="number">0</span>,<span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>,<span class="number">40</span>,<span class="number">50</span>,<span class="number">60</span>,<span class="number">70</span>]);</span><br><span class="line"><span class="title function_">quantize</span>(<span class="number">0</span>) ==&gt; <span class="number">0</span></span><br><span class="line"><span class="title function_">quantize</span>(<span class="number">1</span>) ==&gt; <span class="number">0</span></span><br><span class="line"><span class="title function_">quantize</span>(<span class="number">2</span>) ==&gt; <span class="number">10</span></span><br><span class="line"><span class="title function_">quantize</span>(<span class="number">3</span>) ==&gt; <span class="number">20</span></span><br><span class="line"><span class="title function_">quantize</span>(<span class="number">4</span>) ==&gt; <span class="number">30</span></span><br><span class="line"><span class="title function_">quantize</span>(<span class="number">5</span>) ==&gt; <span class="number">40</span></span><br><span class="line"><span class="title function_">quantize</span>(<span class="number">6</span>) ==&gt; <span class="number">40</span></span><br><span class="line"><span class="title function_">quantize</span>(<span class="number">7</span>) ==&gt; <span class="number">50</span></span><br><span class="line"><span class="title function_">quantize</span>(<span class="number">8</span>) ==&gt; <span class="number">60</span></span><br><span class="line"><span class="title function_">quantize</span>(<span class="number">9</span>) ==&gt; <span class="number">70</span></span><br><span class="line"><span class="title function_">quantize</span>(<span class="number">10</span>) ==&gt; <span class="number">70</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="d3-scale-quantile-分位数比例尺"><a href="#d3-scale-quantile-分位数比例尺" class="headerlink" title="d3.scale.quantile - 分位数比例尺"></a>d3.scale.quantile - 分位数比例尺</h4><p>分位数比例尺是线性比例尺的变体，无论输入数据怎么分布，都会被映射成离散值</p>
<p>示例：d3.scale.quantile().domain([0,10,20,30,40,50,60,70]).range([0,100,200,300,400,500,700]);<br>应用场景：已经对数据分类的情形（<code>！似懂非懂，需要继续研究</code>）</p>
<p><a href="/img/d3/201609242115181474722918.99.jpg"><img src="/img/d3/201609242115181474722918.99.jpg"></a></p>
<h4 id="d3-scale-log-对数比例尺"><a href="#d3-scale-log-对数比例尺" class="headerlink" title="d3.scale.log - 对数比例尺"></a>d3.scale.log - 对数比例尺</h4><p>对数比例尺与线性比例尺相似，区别是对数比例尺首先对输入数据进行对数变换 。</p>
<p>示例：d3.scale.log().domain([1,100]).range([0,700]).base(2);<br>应用场景：输入值以对数级变化的数据集（<code>！不太熟悉对数，需要继续研究</code>）</p>
<p><a href="/img/d3/201609242115191474722919.19.jpg"><img src="/img/d3/201609242115191474722919.19.jpg"></a></p>
<h4 id="d3-scale-pow-指数比例尺"><a href="#d3-scale-pow-指数比例尺" class="headerlink" title="d3.scale.pow - 指数比例尺"></a>d3.scale.pow - 指数比例尺</h4><p>指数比例尺与线性比例尺相似，区别是pow比例尺首先对输入数据进行指数变换，默认指数为1，所以默认情况下也是数值 1:1 的缩放。</p>
<p>示例：d3.scale.pow().domain([0,100]).range([0,700]).exponent(2);<br>应用场景：输入值以指数级变化的数据集</p>
<p><a href="/img/d3/201609242115191474722919.34.jpg"><img src="/img/d3/201609242115191474722919.34.jpg"></a></p>
<h4 id="d3-scale-sqrt-平方根比例尺"><a href="#d3-scale-sqrt-平方根比例尺" class="headerlink" title="d3.scale.sqrt - 平方根比例尺"></a>d3.scale.sqrt - 平方根比例尺</h4><p>平方根比例尺是pow比例尺的特殊类型，相当于d3.scale.pow().exponent(0.5)</p>
<p>示例：d3.scale.sqrt().domain([0,100]).range([0,700])<br>应用场景：输入值以平方根变化的数据集</p>
<p><a href="/img/d3/201609242115191474722919.49.jpg"><img src="/img/d3/201609242115191474722919.49.jpg"></a></p>
<h4 id="d3-scale-threshold-临界值比例尺"><a href="#d3-scale-threshold-临界值比例尺" class="headerlink" title="d3.scale.threshold - 临界值比例尺"></a>d3.scale.threshold - 临界值比例尺</h4><p>临界值比例尺与量化比例尺类似，不过允许将任意的子集映射到离散的range。</p>
<p>示例：d3.scale.threshold().domain([0,1,2,3,4,5,6,7]).range([0,0,100,200,300,400,500,600,700]);<br>应用场景：暂不清楚（<code>！还没完全明白，需要继续研究</code>）</p>
<p><a href="/img/d3/201609242115191474722919.64.jpg"><img src="/img/d3/201609242115191474722919.64.jpg"></a></p>
<h4 id="d3-scale-ordinal-序数比例尺"><a href="#d3-scale-ordinal-序数比例尺" class="headerlink" title="d3.scale.ordinal - 序数比例尺"></a>d3.scale.ordinal - 序数比例尺</h4><p>使用非定量值（如类名）作为输出的序数比例尺</p>
<p>示例：d3.scale.ordinal().domain([“A”, “B”, “C”, “D”, “E”, “F”, “G”, “H”])<br>.range([0,100,200,300,400,500,600,700]);<br>应用场景：输入值与转出值需要一一对应的场景</p>
<p><a href="/img/d3/201609242115191474722919.78.jpg"><img src="/img/d3/201609242115191474722919.78.jpg"></a></p>
<h4 id="d3-scale-category10"><a href="#d3-scale-category10" class="headerlink" title="d3.scale.category10()"></a>d3.scale.category10()</h4><p>构造一个新的颜色序数比例尺，使用10种类型的颜色：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">#1f77b4 #ff7f0e #2ca02c #d62728 #9467bd #8c564b #e377c2 #7f7f7f #bcbd22 #17becf</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a href="/img/d3/201609242115191474722919.91.jpg"><img src="/img/d3/201609242115191474722919.91.jpg"></a></p>
<h4 id="d3-scale-category20"><a href="#d3-scale-category20" class="headerlink" title="d3.scale.category20()"></a>d3.scale.category20()</h4><p>构造一个新的颜色序数比例尺，使用20种类型的颜色：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">#1f77b4 #aec7e8 #ff7f0e #ffbb78 #2ca02c #98df8a #d62728 #ff9896 #9467bd #c5b0d5 #8c564b #c49c94 #e377c2 #f7b6d2 #7f7f7f #c7c7c7 #bcbd22 #dbdb8d #17becf #9edae5</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a href="/img/d3/201609242115201474722920.26.jpg"><img src="/img/d3/201609242115201474722920.26.jpg"></a></p>
<h4 id="d3-scale-category20b"><a href="#d3-scale-category20b" class="headerlink" title="d3.scale.category20b()"></a>d3.scale.category20b()</h4><p>构造一个新的颜色序数比例尺，使用20种类型的颜色：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">#393b79 #5254a3 #6b6ecf #9c9ede #<span class="number">637939</span> #8ca252 #b5cf6b #cedb9c #8c6d31 #bd9e39 #e7ba52 #e7cb94 #843c39 #ad494a #d6616b #e7969c #7b4173 #a55194 #ce6dbd #de9ed6</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a href="/img/d3/201609242115201474722920.41.jpg"><img src="/img/d3/201609242115201474722920.41.jpg"></a></p>
<h4 id="d3-scale-category20c"><a href="#d3-scale-category20c" class="headerlink" title="d3.scale.category20c()"></a>d3.scale.category20c()</h4><p>构造一个新的颜色序数比例尺，使用20种类型的颜色：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">#3182bd #6baed6 #9ecae1 #c6dbef #e6550d #fd8d3c #fdae6b #fdd0a2 #31a354 #74c476 #a1d99b #c7e9c0 #756bb1 #9e9ac8 #bcbddc #dadaeb #<span class="number">636363</span> #<span class="number">969696</span> #bdbdbd #d9d9d9</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a href="/img/d3/201609242115201474722920.56.jpg"><img src="/img/d3/201609242115201474722920.56.jpg"></a></p>
<h4 id="d3-time-scale-日期和时间值比例尺"><a href="#d3-time-scale-日期和时间值比例尺" class="headerlink" title="d3.time.scale - 日期和时间值比例尺"></a>d3.time.scale - 日期和时间值比例尺</h4><p>将日期和时间映射到具体的数值</p>
<p>示例：d3.time.scale().domain([new Date(‘2015-1-1’), new<br>Date(‘2016-12-1’)]).range([0,700]).nice();<br>应用场景：对日期刻度作特殊处理的场景</p>
<p><a href="/img/d3/201609242115201474722920.73.jpg"><img src="/img/d3/201609242115201474722920.73.jpg"></a></p>
<p><a href="http://gafish.github.io/demo/d3/scale.html">查看在线示例</a></p>
<h2 id="D3过渡动画"><a href="#D3过渡动画" class="headerlink" title="D3过渡动画"></a>D3过渡动画</h2><p>前面我们做的各种图表都是静态的，现在没个动效的图表都不好意思拿出手，好在D3为我们提供了过渡动画；</p>
<p>看一个示例（<a href="http://gafish.github.io/demo/d3/transition.html">查看在线演示</a>）：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">var</span> data = [<span class="number">100</span>,<span class="number">200</span>];</span><br><span class="line"><span class="keyword">var</span> body = d3.<span class="title function_">select</span>(<span class="string">&#x27;body&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> svg = body.<span class="title function_">append</span>(<span class="string">&#x27;svg&#x27;</span>).<span class="title function_">attr</span>(<span class="string">&#x27;width&#x27;</span>,<span class="number">500</span>).<span class="title function_">attr</span>(<span class="string">&#x27;height&#x27;</span>,<span class="number">500</span>);</span><br><span class="line"><span class="keyword">var</span> g = svg.<span class="title function_">selectAll</span>(<span class="string">&#x27;rect&#x27;</span>).<span class="title function_">data</span>(data);</span><br><span class="line">g.<span class="title function_">enter</span>().<span class="title function_">append</span>(<span class="string">&#x27;rect&#x27;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;y&#x27;</span>,<span class="keyword">function</span>(<span class="params">d,i</span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> (i+<span class="number">1</span>)*<span class="number">50</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;x&#x27;</span>,<span class="number">50</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;width&#x27;</span>,<span class="number">10</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;height&#x27;</span>,<span class="number">20</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;fill&#x27;</span>,<span class="string">&#x27;#000&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">g.<span class="title function_">transition</span>()</span><br><span class="line">    .<span class="title function_">delay</span>(<span class="number">1000</span>)</span><br><span class="line">    .<span class="title function_">duration</span>(<span class="number">1000</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;width&#x27;</span>,<span class="keyword">function</span>(<span class="params">d</span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> d;</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<p>启动过渡效果只需要添加 transition() 这个即可，跟过渡相关的方法如下：</p>
<h3 id="duration"><a href="#duration" class="headerlink" title=".duration()"></a>.duration()</h3><p>指定整个过渡持续多少时间，单位为毫秒。如 .duration(2000) ，是持续2000毫秒，即2秒。</p>
<h3 id="ease"><a href="#ease" class="headerlink" title=".ease()"></a>.ease()</h3><p>指定过渡的方式，常用的过渡方式有：</p>
<ul>
<li>linear 普通的线性变化</li>
<li>circle 慢慢地到达过渡的最终状态</li>
<li>elastic 带有弹跳的到达最终状态</li>
<li>bounce 在最终状态处弹跳几次 调用时，形如： .ease(“bounce”)</li>
</ul>
<h3 id="delay"><a href="#delay" class="headerlink" title=".delay()"></a>.delay()</h3><p>指定延迟的时间，表示一定时间后才开始过渡，单位同样为毫秒。这个函数可以对整体指定延迟，也可以对个别指定延迟。<br>对整体指定时，如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">.<span class="title function_">transition</span>()</span><br><span class="line">.<span class="title function_">duration</span>(<span class="number">1000</span>)</span><br><span class="line">.<span class="title function_">delay</span>(<span class="number">500</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>这样指定，将会延迟500毫秒播放一个1000毫秒的动画，故整个动画长度为1500毫秒。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">.<span class="title function_">transition</span>()</span><br><span class="line">.<span class="title function_">duration</span>(<span class="number">1000</span>)</span><br><span class="line">.<span class="title function_">delay</span>(<span class="title function_">funtion</span>(<span class="params">d,i</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">200</span>*i;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>这样指定的话，假设有10个元素，那么第1个元素不延迟（因为 i &#x3D; 0），那么第2个元素延迟200毫秒，第3个延迟400毫秒，依次类推….整个动画的长度为200*(10-1) + 1000 &#x3D; 2800 毫秒。</p>
<h2 id="D3布局介绍"><a href="#D3布局介绍" class="headerlink" title="D3布局介绍"></a>D3布局介绍</h2><p>布局是 D3 中一个十分重要的概念，可以理解成“制作常见图形的函数”，有了它制作各种相对复杂的图表就方便多了。<br>D3 与其它很多可视化工具不同，相对来说较底层，对初学者来说不太方便，但是一旦掌握了，就比其他工具更加得心应手。</p>
<p>下图展示了 D3 与其它可视化工具的区别：<br><a href="/img/d3/201609242115201474722920.95.jpg"><img src="/img/d3/201609242115201474722920.95.jpg"></a></p>
<p>布局的作用是：将不适合用于绘图的数据转换成了适合用于绘图的数据。</p>
<p>D3 总共提供了 12 个布局：</p>
<ul>
<li><p>饼状图（Pie）</p>
</li>
<li><p>力导向图（Force）</p>
</li>
<li><p>弦图（Chord）</p>
</li>
<li><p>捆图（Bundle）</p>
</li>
<li><p>直方图（Histogram）</p>
</li>
<li><p>堆栈图（Stack）</p>
</li>
<li><p>集群图（Cluster）</p>
</li>
<li><p>打包图（Pack）</p>
</li>
<li><p>分区图（Partition）</p>
</li>
<li><p>树状图（Tree）</p>
</li>
<li><p>矩阵树图（Treemap）</p>
</li>
<li><p>层级图（Hierarchy）</p>
</li>
</ul>
<p>12 个布局中，层级图（Hierarchy）不能直接使用。集群图、打包图、分区图、树状图、矩阵树图是由层级图扩展来的。如此一来，能够使用的布局是 11个（有 5 个是由层级图扩展而来）。这些布局的作用都是将某种数据转换成另一种数据，而转换后的数据是利于可视化的。</p>
<h3 id="D3布局-饼状图"><a href="#D3布局-饼状图" class="headerlink" title="D3布局-饼状图"></a>D3布局-饼状图</h3><h4 id="d3-layout-pie"><a href="#d3-layout-pie" class="headerlink" title="d3.layout.pie()"></a>d3.layout.pie()</h4><p>在第4章_D3 创建SVG_里我们讲过 圆弧图的制作方法，我们需要准备这样的数据才能画出圆弧：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">var</span> angle = <span class="number">2</span>*<span class="title class_">Math</span>.<span class="property">PI</span>;</span><br><span class="line"><span class="keyword">var</span> data = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">startAngle</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">endAngle</span>: <span class="number">0.2</span>*angle</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">startAngle</span>: <span class="number">0.5</span>*angle,</span><br><span class="line">        <span class="attr">endAngle</span>: <span class="number">0.8</span>*angle</span><br><span class="line">    &#125;</span><br><span class="line">];</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<p>如果都是自己去计算<code>startAngle</code>或<code>endAngle</code>，那太繁琐了，这时候就可以用到饼状布局来生成需要的数据。</p>
<p><code>*千万记住：布局不是要直接绘图，而是为了得到绘图所需的数据。*</code></p>
<h4 id="饼图-Pie-的API说明"><a href="#饼图-Pie-的API说明" class="headerlink" title="饼图(Pie)的API说明"></a>饼图(Pie)的API说明</h4><ul>
<li>pie.endAngle -取得或设置饼布局整体的结束角度。</li>
<li>pie.padAngle - 取得或设置饼布局填充角度。</li>
<li>pie.sort - 控制饼片段的顺时针方向的顺序。</li>
<li>pie.startAngle - 取得或设置饼布局整体的开始角度。</li>
<li>pie.value - 取得或设置值访问器函数。</li>
<li>pie - 计算饼图或圆环图中弧的开始和结束角度。</li>
</ul>
<h4 id="绘制步骤"><a href="#绘制步骤" class="headerlink" title="绘制步骤"></a>绘制步骤</h4><p>我们通过一个制作一个饼状图来讲解饼状布局。</p>
<p><a href="/img/d3/201609242115231474722923.15.jpg"><img src="/img/d3/201609242115231474722923.15.jpg"></a></p>
<h5 id="数据-1"><a href="#数据-1" class="headerlink" title="数据"></a>数据</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> dataset = [ <span class="number">30</span> , <span class="number">10</span> , <span class="number">43</span> , <span class="number">55</span> , <span class="number">13</span> ];</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="数据转换"><a href="#数据转换" class="headerlink" title="数据转换"></a>数据转换</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> pie = d3.<span class="property">layout</span>.<span class="title function_">pie</span>();</span><br><span class="line"><span class="keyword">var</span> data = <span class="title function_">pie</span>(dataset);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>通过饼状布局转换数据后，data数据被转换成如下形式：</p>
<p><a href="/img/d3/201609242115231474722923.28.jpg"><img src="/img/d3/201609242115231474722923.28.jpg"></a></p>
<h5 id="绘制图形"><a href="#绘制图形" class="headerlink" title="绘制图形"></a>绘制图形</h5><h6 id="创建svg容器"><a href="#创建svg容器" class="headerlink" title="创建svg容器"></a>创建svg容器</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> width = <span class="number">400</span>;</span><br><span class="line"><span class="keyword">var</span> height = <span class="number">400</span>;</span><br><span class="line"><span class="keyword">var</span> outerRadius = <span class="number">150</span>; <span class="comment">//外半径</span></span><br><span class="line"><span class="keyword">var</span> innerRadius = <span class="number">0</span>; <span class="comment">//内半径，为0则中间没有空白</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>, width)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>, height);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="创建弧形svg生成器"><a href="#创建弧形svg生成器" class="headerlink" title="创建弧形svg生成器"></a>创建弧形svg生成器</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arc = d3.<span class="property">svg</span>.<span class="title function_">arc</span>() <span class="comment">//弧生成器</span></span><br><span class="line">    .<span class="title function_">innerRadius</span>(innerRadius) <span class="comment">//设置内半径</span></span><br><span class="line">    .<span class="title function_">outerRadius</span>(outerRadius); <span class="comment">//设置外半径</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="定义颜色比例尺"><a href="#定义颜色比例尺" class="headerlink" title="定义颜色比例尺"></a>定义颜色比例尺</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> color = d3.<span class="property">scale</span>.<span class="title function_">category10</span>();</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="定义弧形路径容器"><a href="#定义弧形路径容器" class="headerlink" title="定义弧形路径容器"></a>定义弧形路径容器</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arcs = svg.<span class="title function_">selectAll</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">    .<span class="title function_">data</span>(data)</span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(&quot;</span> + (width / <span class="number">2</span>) + <span class="string">&quot;,&quot;</span> + (width / <span class="number">2</span>) + <span class="string">&quot;)&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="生成弧形路径并填充颜色"><a href="#生成弧形路径并填充颜色" class="headerlink" title="生成弧形路径并填充颜色"></a>生成弧形路径并填充颜色</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">arcs.<span class="title function_">append</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;fill&quot;</span>, <span class="keyword">function</span>(<span class="params">d, i</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">color</span>(i);</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;d&quot;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">arc</span>(d);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="生成弧形文本并旋转"><a href="#生成弧形文本并旋转" class="headerlink" title="生成弧形文本并旋转"></a>生成弧形文本并旋转</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">arcs.<span class="title function_">append</span>(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;translate(&quot;</span> + arc.<span class="title function_">centroid</span>(d) + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;text-anchor&quot;</span>, <span class="string">&quot;middle&quot;</span>)</span><br><span class="line">    .<span class="title function_">text</span>(<span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">data</span>;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>arc.centroid(d)</code> 能算出弧线的中心，所以用来放置文本最合适了。</p>
<p>要注意，text() 里返回的是 d.data，而不是d。因为被绑定的数据是对象，里面有d.startAngle、d.endAngle、d.data等，其中 d.data 才是转换前的整数的值。</p>
<p><a href="http://gafish.github.com/demo/d3/pie1.html">查看在线演示</a></p>
<h3 id="D3布局-力学图"><a href="#D3布局-力学图" class="headerlink" title="D3布局-力学图"></a>D3布局-力学图</h3><h4 id="d3-layout-force"><a href="#d3-layout-force" class="headerlink" title="d3.layout.force()"></a>d3.layout.force()</h4><p>力学图（也称为导向图，也有叫网络拓补图的，反正就是通过排斥得到关系远近的结构）在社交网络研究、信息传播途径等群体关系研究中应用非常广泛，它可以直观地反映群体与群体之间联系的渠道、交集多少，群体内部成员的联系强度等。</p>
<h4 id="力学-Force-的API说明"><a href="#力学-Force-的API说明" class="headerlink" title="力学(Force)的API说明"></a>力学(Force)的API说明</h4><ul>
<li>force.on - 监听布局位置的变化。(仅支持”start”,”step”,”end”三种事件)</li>
<li>force.nodes - 获得或设置布局中的节点（node）阵列组。</li>
<li>force.links - 获得或设置布局中节点间的连接（Link）阵列组。.</li>
<li>force.size - 获取或设置布局的 宽 和 高 的大小.</li>
<li>force.linkDistance - 获取或设置节点间的连接线距离.</li>
<li>force.linkStrength - 获取或设置节点间的连接强度.</li>
<li>force.friction - 获取或设置摩擦系数.</li>
<li>force.charge - 获取或设置节点的电荷数.(电荷数决定结点是互相排斥还是吸引)</li>
<li>force.gravity - 获取或设置节点的引力强度.</li>
<li>force.theta - 获取或设置电荷间互相作用的强度.</li>
<li>force.start - 开启或恢复结点间的位置影响.</li>
<li>force.resume - 设置冷却系数为0.1,并重新调用start()函数.</li>
<li>force.stop - 立刻终止结点间的位置影响.(等同于将冷却系数设置为0)</li>
<li>force.alpha - 获取或设置布局的冷却系数.(冷却系数为0时,节点间不再互相影响)</li>
<li>force.tick - 让布局运行到下一步.</li>
<li>force.drag - 获取当前布局的拖拽对象实例以便进一步绑定处理函数.</li>
</ul>
<p>一个基本的力学图有三个要素：力学结构,节点标记和节点连线。力学结构规范节点的行为，连线和节点显示节点信息和关系。</p>
<h4 id="绘制步骤-1"><a href="#绘制步骤-1" class="headerlink" title="绘制步骤"></a>绘制步骤</h4><p>我们通过一个制作一个力学图来讲解力学布局。</p>
<p><a href="/img/d3/201609242115231474722923.49.jpg"><img src="/img/d3/201609242115231474722923.49.jpg"></a></p>
<h5 id="数据-2"><a href="#数据-2" class="headerlink" title="数据"></a>数据</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">var</span> dataset = [</span><br><span class="line">  &#123;<span class="attr">name</span>: <span class="string">&quot;桂林&quot;</span>, <span class="attr">source</span>: <span class="number">0</span>, <span class="attr">target</span>: <span class="number">1</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">name</span>: <span class="string">&quot;广州&quot;</span>, <span class="attr">source</span>: <span class="number">1</span>, <span class="attr">target</span>: <span class="number">2</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">name</span>: <span class="string">&quot;厦门&quot;</span>, <span class="attr">source</span>: <span class="number">2</span>, <span class="attr">target</span>: <span class="number">3</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">name</span>: <span class="string">&quot;杭州&quot;</span>, <span class="attr">source</span>: <span class="number">3</span>, <span class="attr">target</span>: <span class="number">4</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">name</span>: <span class="string">&quot;上海&quot;</span>, <span class="attr">source</span>: <span class="number">4</span>, <span class="attr">target</span>: <span class="number">5</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">name</span>: <span class="string">&quot;青岛&quot;</span>, <span class="attr">source</span>: <span class="number">5</span>, <span class="attr">target</span>: <span class="number">6</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">name</span>: <span class="string">&quot;天津&quot;</span>, <span class="attr">source</span>: <span class="number">6</span>, <span class="attr">target</span>: <span class="number">0</span>&#125;</span><br><span class="line">];</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<h5 id="数据转换-1"><a href="#数据转换-1" class="headerlink" title="数据转换"></a>数据转换</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> width = <span class="number">400</span>;</span><br><span class="line"><span class="keyword">var</span> height = <span class="number">400</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> force = d3.<span class="property">layout</span>.<span class="title function_">force</span>()</span><br><span class="line">    .<span class="title function_">nodes</span>(dataset) <span class="comment">//指定节点数组</span></span><br><span class="line">    .<span class="title function_">links</span>(dataset) <span class="comment">//指定连线数组</span></span><br><span class="line">    .<span class="title function_">size</span>([width, height]) <span class="comment">//指定范围</span></span><br><span class="line">    .<span class="title function_">linkDistance</span>(<span class="number">80</span>) <span class="comment">//指定连线长度</span></span><br><span class="line">    .<span class="title function_">charge</span>([-<span class="number">400</span>]); <span class="comment">//相互之间的作用力</span></span><br><span class="line"></span><br><span class="line">force.<span class="title function_">start</span>(); <span class="comment">//开始作用</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>通过转换数据后，数据被转换成如下形式：</p>
<p><a href="/img/d3/201609242115231474722923.72.jpg"><img src="/img/d3/201609242115231474722923.72.jpg"></a></p>
<p>转换后，数据对象里多了一些变量。其意义如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">index：节点的索引号</span><br><span class="line">px, py：节点上一个时刻的坐标</span><br><span class="line">x, y：节点的当前坐标</span><br><span class="line">weight：节点的权重</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="绘制图形-1"><a href="#绘制图形-1" class="headerlink" title="绘制图形"></a>绘制图形</h5><p>有了转换后的数据，就可以作图了。分别绘制三种图形元素：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">line，线段，表示连线。</span><br><span class="line">circle，圆，表示节点。</span><br><span class="line">text，文字，描述节点。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="生成svg容器"><a href="#生成svg容器" class="headerlink" title="生成svg容器"></a>生成svg容器</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>, width)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>, height);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="生成连线"><a href="#生成连线" class="headerlink" title="生成连线"></a>生成连线</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg_edges = svg.<span class="title function_">selectAll</span>(<span class="string">&quot;line&quot;</span>)</span><br><span class="line">    .<span class="title function_">data</span>(dataset)</span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;line&quot;</span>)</span><br><span class="line">    .<span class="title function_">style</span>(<span class="string">&quot;stroke&quot;</span>, <span class="string">&quot;#ccc&quot;</span>)</span><br><span class="line">    .<span class="title function_">style</span>(<span class="string">&quot;stroke-width&quot;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="定义颜色比例尺-1"><a href="#定义颜色比例尺-1" class="headerlink" title="定义颜色比例尺"></a>定义颜色比例尺</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> color = d3.<span class="property">scale</span>.<span class="title function_">category20</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="生成圆形节点"><a href="#生成圆形节点" class="headerlink" title="生成圆形节点"></a>生成圆形节点</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg_nodes = svg.<span class="title function_">selectAll</span>(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">    .<span class="title function_">data</span>(dataset)</span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;r&quot;</span>, <span class="number">20</span>)</span><br><span class="line">    .<span class="title function_">style</span>(<span class="string">&quot;fill&quot;</span>, <span class="keyword">function</span>(<span class="params">d, i</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">color</span>(i);</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">call</span>(force.<span class="property">drag</span>); <span class="comment">//使得节点能够拖动</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="生成节点文字"><a href="#生成节点文字" class="headerlink" title="生成节点文字"></a>生成节点文字</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg_texts = svg.<span class="title function_">selectAll</span>(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">    .<span class="title function_">data</span>(dataset)</span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">    .<span class="title function_">style</span>(<span class="string">&quot;fill&quot;</span>, <span class="string">&quot;black&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;dx&quot;</span>, <span class="number">20</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;dy&quot;</span>, <span class="number">8</span>)</span><br><span class="line">    .<span class="title function_">text</span>(<span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">name</span>;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="事件触发"><a href="#事件触发" class="headerlink" title="事件触发"></a>事件触发</h6><p>由于力导向图是不断运动的，每一时刻都在发生更新，因此，必须不断更新节点和连线的位置。</p>
<p>力导向图布局 force 有一个事件tick，每进行到一个时刻，都要调用它，更新的内容就写在它的监听器里就好。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">force.<span class="title function_">on</span>(<span class="string">&quot;tick&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123; <span class="comment">//对于每一个时间间隔</span></span><br><span class="line">    <span class="comment">//更新连线坐标</span></span><br><span class="line">    svg_edges.<span class="title function_">attr</span>(<span class="string">&quot;x1&quot;</span>,<span class="keyword">function</span>(<span class="params">d</span>)&#123; <span class="keyword">return</span> d.<span class="property">source</span>.<span class="property">x</span>; &#125;)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;y1&quot;</span>,<span class="keyword">function</span>(<span class="params">d</span>)&#123; <span class="keyword">return</span> d.<span class="property">source</span>.<span class="property">y</span>; &#125;)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;x2&quot;</span>,<span class="keyword">function</span>(<span class="params">d</span>)&#123; <span class="keyword">return</span> d.<span class="property">target</span>.<span class="property">x</span>; &#125;)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;y2&quot;</span>,<span class="keyword">function</span>(<span class="params">d</span>)&#123; <span class="keyword">return</span> d.<span class="property">target</span>.<span class="property">y</span>; &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//更新节点坐标</span></span><br><span class="line">    svg_nodes.<span class="title function_">attr</span>(<span class="string">&quot;cx&quot;</span>,<span class="keyword">function</span>(<span class="params">d</span>)&#123; <span class="keyword">return</span> d.<span class="property">x</span>; &#125;)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;cy&quot;</span>,<span class="keyword">function</span>(<span class="params">d</span>)&#123; <span class="keyword">return</span> d.<span class="property">y</span>; &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//更新文字坐标</span></span><br><span class="line">    svg_texts.<span class="title function_">attr</span>(<span class="string">&quot;x&quot;</span>, <span class="keyword">function</span>(<span class="params">d</span>)&#123; <span class="keyword">return</span> d.<span class="property">x</span>; &#125;)</span><br><span class="line">       .<span class="title function_">attr</span>(<span class="string">&quot;y&quot;</span>, <span class="keyword">function</span>(<span class="params">d</span>)&#123; <span class="keyword">return</span> d.<span class="property">y</span>; &#125;);</span><br><span class="line"> &#125;);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a href="http://gafish.github.com/demo/d3/force.html">查看在线演示，用鼠标拖拽看看</a></p>
<h3 id="D3布局-弦图"><a href="#D3布局-弦图" class="headerlink" title="D3布局-弦图"></a>D3布局-弦图</h3><h4 id="d3-layout-chord"><a href="#d3-layout-chord" class="headerlink" title="d3.layout.chord()"></a>d3.layout.chord()</h4><p>弦图是一种用于描述节点之间联系的图表。</p>
<h4 id="弦图-Chord-的API说明"><a href="#弦图-Chord-的API说明" class="headerlink" title="弦图(Chord)的API说明"></a>弦图(Chord)的API说明</h4><ul>
<li>chord.chords - 取回计算的弦角度。</li>
<li>chord.groups - 取回计算的分组角度。</li>
<li>chord.matrix - 取得或设置布局需要的矩阵数据。</li>
<li>chord.padding - 取得或设置弦片段间的角填充。</li>
<li>chord.sortChords - 取得或设置用于弦的比较器（Z轴顺序）。</li>
<li>chord.sortGroups - 取得或设置用于分组的比较器。</li>
<li>chord.sortSubgroups - 取得或设置用于子分组的比较器。</li>
</ul>
<h4 id="绘制步骤-2"><a href="#绘制步骤-2" class="headerlink" title="绘制步骤"></a>绘制步骤</h4><p>我们通过一个制作一个弦图来讲解弦布局。</p>
<p>[![][36]][36]</p>
<h5 id="数据-3"><a href="#数据-3" class="headerlink" title="数据"></a>数据</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">var city_name = <span class="punctuation">[</span><span class="string">&quot;北京&quot;</span><span class="punctuation">,</span> <span class="string">&quot;上海&quot;</span><span class="punctuation">,</span> <span class="string">&quot;广州&quot;</span><span class="punctuation">,</span> <span class="string">&quot;深圳&quot;</span><span class="punctuation">,</span> <span class="string">&quot;香港&quot;</span><span class="punctuation">]</span>;</span><br><span class="line"></span><br><span class="line">var population = <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">[</span><span class="number">1000</span><span class="punctuation">,</span> <span class="number">3045</span><span class="punctuation">,</span> <span class="number">4567</span><span class="punctuation">,</span> <span class="number">1234</span><span class="punctuation">,</span> <span class="number">3714</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">[</span><span class="number">3214</span><span class="punctuation">,</span> <span class="number">2000</span><span class="punctuation">,</span> <span class="number">2060</span><span class="punctuation">,</span> <span class="number">124</span><span class="punctuation">,</span> <span class="number">3234</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">[</span><span class="number">8761</span><span class="punctuation">,</span> <span class="number">6545</span><span class="punctuation">,</span> <span class="number">3000</span><span class="punctuation">,</span> <span class="number">8045</span><span class="punctuation">,</span> <span class="number">647</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">[</span><span class="number">3211</span><span class="punctuation">,</span> <span class="number">1067</span><span class="punctuation">,</span> <span class="number">3214</span><span class="punctuation">,</span> <span class="number">4000</span><span class="punctuation">,</span> <span class="number">1006</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">[</span><span class="number">2146</span><span class="punctuation">,</span> <span class="number">1034</span><span class="punctuation">,</span> <span class="number">6745</span><span class="punctuation">,</span> <span class="number">4764</span><span class="punctuation">,</span> <span class="number">5000</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">]</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>数据是一些城市名和一些数字，这些数字表示城市人口的来源，用表格表示如下：</p>
<table>
<thead>
<tr>
<th></th>
<th>北京</th>
<th>上海</th>
<th>广州</th>
<th>深圳</th>
<th>香港</th>
</tr>
</thead>
<tbody><tr>
<td>北京</td>
<td>1000</td>
<td>3045</td>
<td>4567</td>
<td>1234</td>
<td>3714</td>
</tr>
<tr>
<td>上海</td>
<td>3214</td>
<td>2000</td>
<td>2060</td>
<td>124</td>
<td>3234</td>
</tr>
<tr>
<td>广州</td>
<td>8761</td>
<td>6545</td>
<td>3000</td>
<td>8045</td>
<td>647</td>
</tr>
<tr>
<td>深圳</td>
<td>3211</td>
<td>1067</td>
<td>3214</td>
<td>4000</td>
<td>1006</td>
</tr>
<tr>
<td>香港</td>
<td>2146</td>
<td>1034</td>
<td>6745</td>
<td>4764</td>
<td>5000</td>
</tr>
</tbody></table>
<p>左边第一列是被统计人口的城市，上边第一行是被统计的来源城市</p>
<h5 id="数据转换-2"><a href="#数据转换-2" class="headerlink" title="数据转换"></a>数据转换</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> chord_layout = d3.<span class="property">layout</span>.<span class="title function_">chord</span>()</span><br><span class="line">    .<span class="title function_">padding</span>(<span class="number">0.03</span>) <span class="comment">//节点之间的间隔</span></span><br><span class="line">    .<span class="title function_">matrix</span>(population); <span class="comment">//输入矩阵</span></span><br><span class="line"><span class="keyword">var</span> groups = chord_layout.<span class="title function_">groups</span>();</span><br><span class="line"><span class="keyword">var</span> chords = chord_layout.<span class="title function_">chords</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>population 经过转换后，实际上分成了两部分：groups 和 chords。前者是节点，后者是连线，也就是弦。</p>
<p>通过弦布局转换数据后，数据被转换成如下形式：</p>
<p>节点<br><a href="/img/d3/201609242115241474722924.02.jpg"><img src="/img/d3/201609242115241474722924.02.jpg"></a></p>
<p>连线<br><a href="/img/d3/201609242115241474722924.23.jpg"><img src="/img/d3/201609242115241474722924.23.jpg"></a></p>
<h5 id="绘制图形-2"><a href="#绘制图形-2" class="headerlink" title="绘制图形"></a>绘制图形</h5><h6 id="绘制容器"><a href="#绘制容器" class="headerlink" title="绘制容器"></a>绘制容器</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> width = <span class="number">600</span>;</span><br><span class="line"><span class="keyword">var</span> height = <span class="number">600</span>;</span><br><span class="line"><span class="keyword">var</span> innerRadius = width / <span class="number">2</span> * <span class="number">0.7</span>;</span><br><span class="line"><span class="keyword">var</span> outerRadius = innerRadius * <span class="number">1.1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&quot;body&quot;</span>).<span class="title function_">append</span>(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>, width)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>, height)</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(&quot;</span> + width / <span class="number">2</span> + <span class="string">&quot;,&quot;</span> + height / <span class="number">2</span> + <span class="string">&quot;)&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="定义颜色比例尺-2"><a href="#定义颜色比例尺-2" class="headerlink" title="定义颜色比例尺"></a>定义颜色比例尺</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> color20 = d3.<span class="property">scale</span>.<span class="title function_">category20</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="创建圆弧SVG生成器"><a href="#创建圆弧SVG生成器" class="headerlink" title="创建圆弧SVG生成器"></a>创建圆弧SVG生成器</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> outer_arc = d3.<span class="property">svg</span>.<span class="title function_">arc</span>()</span><br><span class="line">    .<span class="title function_">innerRadius</span>(innerRadius)</span><br><span class="line">    .<span class="title function_">outerRadius</span>(outerRadius);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="绘制圆弧路径"><a href="#绘制圆弧路径" class="headerlink" title="绘制圆弧路径"></a>绘制圆弧路径</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> g_outer = svg.<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>);</span><br><span class="line"></span><br><span class="line">g_outer.<span class="title function_">selectAll</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line">    .<span class="title function_">data</span>(groups)</span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line">    .<span class="title function_">style</span>(<span class="string">&quot;fill&quot;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">color20</span>(d.<span class="property">index</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">style</span>(<span class="string">&quot;stroke&quot;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">color20</span>(d.<span class="property">index</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;d&quot;</span>, outer_arc);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="绘制弦图文字"><a href="#绘制弦图文字" class="headerlink" title="绘制弦图文字"></a>绘制弦图文字</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">g_outer.<span class="title function_">selectAll</span>(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">    .<span class="title function_">data</span>(groups)</span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">    .<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params">d, i</span>) &#123;</span><br><span class="line">        d.<span class="property">angle</span> = (d.<span class="property">startAngle</span> + d.<span class="property">endAngle</span>) / <span class="number">2</span>;</span><br><span class="line">        d.<span class="property">name</span> = city_name[i];</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;dy&quot;</span>, <span class="string">&quot;.35em&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;rotate(&quot;</span> + (d.<span class="property">angle</span> * <span class="number">180</span> / <span class="title class_">Math</span>.<span class="property">PI</span>) + <span class="string">&quot;)&quot;</span> +</span><br><span class="line">            <span class="string">&quot;translate(0,&quot;</span> + -<span class="number">1.0</span> * (outerRadius + <span class="number">10</span>) + <span class="string">&quot;)&quot;</span> +</span><br><span class="line">            ((d.<span class="property">angle</span> &gt; <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">3</span> / <span class="number">4</span> &amp;&amp; d.<span class="property">angle</span> &lt; <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">5</span> / <span class="number">4</span>) ? <span class="string">&quot;rotate(180)&quot;</span> : <span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">text</span>(<span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">name</span>;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="创建弦图SVG生成器"><a href="#创建弦图SVG生成器" class="headerlink" title="创建弦图SVG生成器"></a>创建弦图SVG生成器</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> inner_chord = d3.<span class="property">svg</span>.<span class="title function_">chord</span>()</span><br><span class="line">    .<span class="title function_">radius</span>(innerRadius);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="绘制弦图路径"><a href="#绘制弦图路径" class="headerlink" title="绘制弦图路径"></a>绘制弦图路径</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">svg.<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>, <span class="string">&quot;chord&quot;</span>)</span><br><span class="line">    .<span class="title function_">selectAll</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line">    .<span class="title function_">data</span>(chords)</span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;d&quot;</span>, inner_chord)</span><br><span class="line">    .<span class="title function_">style</span>(<span class="string">&quot;fill&quot;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">color20</span>(d.<span class="property">source</span>.<span class="property">index</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">style</span>(<span class="string">&quot;opacity&quot;</span>, <span class="number">1</span>)</span><br><span class="line">    .<span class="title function_">on</span>(<span class="string">&quot;mouseover&quot;</span>, <span class="keyword">function</span>(<span class="params">d, i</span>) &#123;</span><br><span class="line">        d3.<span class="title function_">select</span>(<span class="variable language_">this</span>)</span><br><span class="line">            .<span class="title function_">style</span>(<span class="string">&quot;fill&quot;</span>, <span class="string">&quot;yellow&quot;</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">on</span>(<span class="string">&quot;mouseout&quot;</span>, <span class="keyword">function</span>(<span class="params">d, i</span>) &#123;</span><br><span class="line">        d3.<span class="title function_">select</span>(<span class="variable language_">this</span>)</span><br><span class="line">            .<span class="title function_">transition</span>()</span><br><span class="line">            .<span class="title function_">duration</span>(<span class="number">1000</span>)</span><br><span class="line">            .<span class="title function_">style</span>(<span class="string">&quot;fill&quot;</span>, <span class="title function_">color20</span>(d.<span class="property">source</span>.<span class="property">index</span>));</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a href="http://gafish.github.com/demo/d3/chord.html">查看在线演示</a></p>
<h3 id="D3布局-集群图"><a href="#D3布局-集群图" class="headerlink" title="D3布局-集群图"></a>D3布局-集群图</h3><h4 id="d3-layout-cluster"><a href="#d3-layout-cluster" class="headerlink" title="d3.layout.cluster()"></a>d3.layout.cluster()</h4><p>集群图是一种用于表示包含与被包含关系的图表。</p>
<h4 id="集群图-Cluster-的API说明"><a href="#集群图-Cluster-的API说明" class="headerlink" title="集群图(Cluster)的API说明"></a>集群图(Cluster)的API说明</h4><ul>
<li>cluster.children - 取得或者设置子节点的访问器函数。</li>
<li>cluster.links - 技术树节点之间的父子连接。</li>
<li>cluster.nodeSize - 为每个节点指定固定的尺寸。</li>
<li>cluster.nodes - 计算集群布局并返回节点数组。</li>
<li>cluster.separation - 取得或设置邻接节点的分隔函数。</li>
<li>cluster.size - 取得或设置布局的尺寸。</li>
<li>cluster.sort - 取得或设置兄弟节点的比较器函数。</li>
<li>cluster - cluster.nodes的别名。</li>
</ul>
<h4 id="绘制步骤-3"><a href="#绘制步骤-3" class="headerlink" title="绘制步骤"></a>绘制步骤</h4><p>我们通过一个制作一个集群图来讲解集群布局。</p>
<p><a href="/img/d3/201609242115241474722924.4.jpg"><img src="/img/d3/201609242115241474722924.4.jpg"></a></p>
<h5 id="数据-4"><a href="#数据-4" class="headerlink" title="数据"></a>数据</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">var dataset = <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;中国&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;children&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;浙江&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;children&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;杭州&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;宁波&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;温州&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;绍兴&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;广西&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;children&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;桂林&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;南宁&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;柳州&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;防城港&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;黑龙江&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;children&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;哈尔滨&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;齐齐哈尔&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;牡丹江&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;大庆&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;新疆&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;children&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;乌鲁木齐&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;克拉玛依&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;吐鲁番&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;哈密&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="数据转换-3"><a href="#数据转换-3" class="headerlink" title="数据转换"></a>数据转换</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> width = <span class="number">1000</span>,</span><br><span class="line">    height = <span class="number">500</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cluster = d3.<span class="property">layout</span>.<span class="title function_">cluster</span>()</span><br><span class="line">    .<span class="title function_">size</span>([width, height - <span class="number">100</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> nodes = cluster.<span class="title function_">nodes</span>(dataset); <span class="comment">// 节点</span></span><br><span class="line"><span class="keyword">var</span> links = cluster.<span class="title function_">links</span>(nodes); <span class="comment">// 连线</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>size() 设定尺寸，即转换后的各节点的坐标在哪一个范围内。</p>
<p>通过集群布局转换数据后，数据被转换成如下形式：</p>
<p>节点<br><a href="/img/d3/201609242115241474722924.56.jpg"><img src="/img/d3/201609242115241474722924.56.jpg"></a></p>
<p>连线<br><a href="/img/d3/201609242115241474722924.71.jpg"><img src="/img/d3/201609242115241474722924.71.jpg"></a></p>
<h5 id="绘制图形-3"><a href="#绘制图形-3" class="headerlink" title="绘制图形"></a>绘制图形</h5><h6 id="生成SVG容器"><a href="#生成SVG容器" class="headerlink" title="生成SVG容器"></a>生成SVG容器</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&quot;body&quot;</span>).<span class="title function_">append</span>(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>, width)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>, height)</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(0,50)&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="创建对角线SVG生成器"><a href="#创建对角线SVG生成器" class="headerlink" title="创建对角线SVG生成器"></a>创建对角线SVG生成器</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> diagonal = d3.<span class="property">svg</span>.<span class="title function_">diagonal</span>()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="生成连线路径"><a href="#生成连线路径" class="headerlink" title="生成连线路径"></a>生成连线路径</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> link = svg.<span class="title function_">selectAll</span>(<span class="string">&quot;.link&quot;</span>)</span><br><span class="line">    .<span class="title function_">data</span>(links)</span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>, <span class="string">&quot;link&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;d&quot;</span>, diagonal);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="生成圆形节点和文本"><a href="#生成圆形节点和文本" class="headerlink" title="生成圆形节点和文本"></a>生成圆形节点和文本</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> node = svg.<span class="title function_">selectAll</span>(<span class="string">&quot;.node&quot;</span>)</span><br><span class="line">    .<span class="title function_">data</span>(nodes)</span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>, <span class="string">&quot;node&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;translate(&quot;</span> + d.<span class="property">x</span> + <span class="string">&quot;,&quot;</span> + d.<span class="property">y</span> + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">node.<span class="title function_">append</span>(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;r&quot;</span>, <span class="number">4.5</span>);</span><br><span class="line"></span><br><span class="line">node.<span class="title function_">append</span>(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;dx&quot;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">children</span> ? -<span class="number">8</span> : <span class="number">8</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;dy&quot;</span>, <span class="number">3</span>)</span><br><span class="line">    .<span class="title function_">style</span>(<span class="string">&quot;text-anchor&quot;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">children</span> ? <span class="string">&quot;end&quot;</span> : <span class="string">&quot;start&quot;</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">text</span>(<span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">name</span>;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a href="http://gafish.github.io/demo/d3/cluster.html">查看在线演示</a></p>
<h3 id="D3布局-树状图"><a href="#D3布局-树状图" class="headerlink" title="D3布局-树状图"></a>D3布局-树状图</h3><h4 id="d3-layout-tree"><a href="#d3-layout-tree" class="headerlink" title="d3.layout.tree()"></a>d3.layout.tree()</h4><p>树状图（ Tree ）用于表示层级、上下级、包含与被包含关系，其布局的用法与集群图几乎完全相同，本章简单通过两个图的对比来讲述两种图表之间的不同之处。</p>
<h4 id="树状图"><a href="#树状图" class="headerlink" title="树状图"></a>树状图</h4><p><a href="/img/d3/201609242115241474722924.88.jpg"><img src="/img/d3/201609242115241474722924.88.jpg"></a></p>
<h4 id="集群图"><a href="#集群图" class="headerlink" title="集群图"></a>集群图</h4><p><a href="/img/d3/201609242115251474722925.21.jpg"><img src="/img/d3/201609242115251474722925.21.jpg"></a></p>
<p><a href="http://gafish.github.com/demo/d3/tree.html">查看在线演示</a></p>
<h3 id="D3布局-打包图"><a href="#D3布局-打包图" class="headerlink" title="D3布局-打包图"></a>D3布局-打包图</h3><h4 id="d3-layout-pack"><a href="#d3-layout-pack" class="headerlink" title="d3.layout.pack()"></a>d3.layout.pack()</h4><p>打包图用于表示包含与被包含的关系，也可表示各对象的权重，通常用一圆套一圆来表示前者，用圆的大小来表示后者。</p>
<h4 id="打包图-Pack-的API说明"><a href="#打包图-Pack-的API说明" class="headerlink" title="打包图(Pack)的API说明"></a>打包图(Pack)的API说明</h4><ul>
<li>pack.children - 取得或设置子节点的访问器。</li>
<li>pack.links - 计算树节点中的父子链接。</li>
<li>pack.nodes - 计算包布局并返回节点数组。</li>
<li>pack.padding - 指定布局间距（以像素为单位）</li>
<li>pack.radius - 指定节点半径（不是由值派生来的）</li>
<li>pack.size - 指定布局尺寸。</li>
<li>pack.sort - 控制兄弟节点的遍历顺序。</li>
<li>pack.value - 取得或设置用于圆尺寸的值访问器。</li>
<li>pack - pack.nodes的别名。</li>
</ul>
<h4 id="绘制步骤-4"><a href="#绘制步骤-4" class="headerlink" title="绘制步骤"></a>绘制步骤</h4><p>我们通过一个制作一个打包图来讲解打包布局。</p>
<p>[![][40]][40]</p>
<h5 id="数据-5"><a href="#数据-5" class="headerlink" title="数据"></a>数据</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">var dataset = <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;中国&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;children&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;浙江&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;children&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;杭州&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;宁波&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;温州&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;绍兴&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;广西&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;children&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;桂林&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;南宁&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;柳州&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;防城港&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;黑龙江&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;children&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;哈尔滨&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;齐齐哈尔&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;牡丹江&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;大庆&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;新疆&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;children&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;乌鲁木齐&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;克拉玛依&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;吐鲁番&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;哈密&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="数据转换-4"><a href="#数据转换-4" class="headerlink" title="数据转换"></a>数据转换</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> width = <span class="number">500</span>;</span><br><span class="line"><span class="keyword">var</span> height = <span class="number">500</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> pack = d3.<span class="property">layout</span>.<span class="title function_">pack</span>()</span><br><span class="line">    .<span class="title function_">size</span>([width, height])</span><br><span class="line">    .<span class="title function_">radius</span>(<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> nodes = pack.<span class="title function_">nodes</span>(data);</span><br><span class="line"><span class="keyword">var</span> links = pack.<span class="title function_">links</span>(nodes);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>分别将数据转换成了结点 nodes 和 连线 links。<br>这里只需要用到结点数据，数据被转换成了如下：</p>
<p><a href="/img/d3/201609242115251474722925.51.jpg"><img src="/img/d3/201609242115251474722925.51.jpg"></a></p>
<h5 id="绘制图形-4"><a href="#绘制图形-4" class="headerlink" title="绘制图形"></a>绘制图形</h5><h6 id="生成SVG容器-1"><a href="#生成SVG容器-1" class="headerlink" title="生成SVG容器"></a>生成SVG容器</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&quot;body&quot;</span>).<span class="title function_">append</span>(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>, width)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>, height)</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(0,0)&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="生成打包圆形SVG"><a href="#生成打包圆形SVG" class="headerlink" title="生成打包圆形SVG"></a>生成打包圆形SVG</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">svg.<span class="title function_">selectAll</span>(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">    .<span class="title function_">data</span>(nodes)</span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;fill&quot;</span>, <span class="string">&quot;rgb(31, 119, 180)&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;fill-opacity&quot;</span>, <span class="string">&quot;0.4&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;cx&quot;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">x</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;cy&quot;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">y</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;r&quot;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">r</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">on</span>(<span class="string">&quot;mouseover&quot;</span>, <span class="keyword">function</span>(<span class="params">d, i</span>) &#123;</span><br><span class="line">        d3.<span class="title function_">select</span>(<span class="variable language_">this</span>)</span><br><span class="line">            .<span class="title function_">attr</span>(<span class="string">&quot;fill&quot;</span>, <span class="string">&quot;yellow&quot;</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">on</span>(<span class="string">&quot;mouseout&quot;</span>, <span class="keyword">function</span>(<span class="params">d, i</span>) &#123;</span><br><span class="line">        d3.<span class="title function_">select</span>(<span class="variable language_">this</span>)</span><br><span class="line">            .<span class="title function_">attr</span>(<span class="string">&quot;fill&quot;</span>, <span class="string">&quot;rgb(31, 119, 180)&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="生成节点文本"><a href="#生成节点文本" class="headerlink" title="生成节点文本"></a>生成节点文本</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">svg.<span class="title function_">selectAll</span>(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">    .<span class="title function_">data</span>(nodes)</span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;font-size&quot;</span>, <span class="string">&quot;10px&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;fill&quot;</span>, <span class="string">&quot;white&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;fill-opacity&quot;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (d.<span class="property">depth</span> == <span class="number">2</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;0.9&quot;</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;0&quot;</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;x&quot;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">x</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;y&quot;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">y</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;dx&quot;</span>, -<span class="number">12</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;dy&quot;</span>, <span class="number">1</span>)</span><br><span class="line">    .<span class="title function_">text</span>(<span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">name</span>;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a href="http://gafish.github.com/demo/d3/pack.html">查看在线演示</a></p>
<h3 id="D3布局-堆栈图"><a href="#D3布局-堆栈图" class="headerlink" title="D3布局-堆栈图"></a>D3布局-堆栈图</h3><h4 id="d3-layout-stack"><a href="#d3-layout-stack" class="headerlink" title="d3.layout.stack()"></a>d3.layout.stack()</h4><p><a href="/img/d3/201609242115251474722925.9.jpg"><img src="/img/d3/201609242115251474722925.9.jpg"></a></p>
<p>什么是堆栈图。</p>
<p>例如，有如下情况：</p>
<p>某公司，销售三种产品：个人电脑、智能手机、软件。</p>
<p>2005年，三种产品的利润分别为3000、2000、1100万。</p>
<p>2006年，三种产品的利润分别为1300、4000、1700万。</p>
<p>计算可得，2005年总利润为6100万，2006年为7000万。</p>
<p>如果要将2005年的总利润用柱形表示，那么应该画三个矩形，三个矩形堆叠在一起。这时候就有一个问题：每一个矩形的起始y坐标是多少？高应该是多少？</p>
<p>堆栈图布局（Stack Layout）能够计算二维数组每一数据层的基线，以方便将各数据层叠加起来，最适合用来处理以上这种场景。</p>
<h4 id="绘制步骤-5"><a href="#绘制步骤-5" class="headerlink" title="绘制步骤"></a>绘制步骤</h4><h5 id="数据-6"><a href="#数据-6" class="headerlink" title="数据"></a>数据</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">var dataset = <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        name<span class="punctuation">:</span> <span class="string">&quot;PC&quot;</span> <span class="punctuation">,</span></span><br><span class="line">        sales<span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span> year<span class="punctuation">:</span><span class="number">2005</span><span class="punctuation">,</span> profit<span class="punctuation">:</span> <span class="number">3000</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span> year<span class="punctuation">:</span><span class="number">2006</span><span class="punctuation">,</span> profit<span class="punctuation">:</span> <span class="number">1300</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span> year<span class="punctuation">:</span><span class="number">2007</span><span class="punctuation">,</span> profit<span class="punctuation">:</span> <span class="number">3700</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span> year<span class="punctuation">:</span><span class="number">2008</span><span class="punctuation">,</span> profit<span class="punctuation">:</span> <span class="number">4900</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span> year<span class="punctuation">:</span><span class="number">2009</span><span class="punctuation">,</span> profit<span class="punctuation">:</span> <span class="number">700</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        name<span class="punctuation">:</span> <span class="string">&quot;SmartPhone&quot;</span> <span class="punctuation">,</span></span><br><span class="line">        sales<span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span> year<span class="punctuation">:</span><span class="number">2005</span><span class="punctuation">,</span> profit<span class="punctuation">:</span> <span class="number">2000</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span> year<span class="punctuation">:</span><span class="number">2006</span><span class="punctuation">,</span> profit<span class="punctuation">:</span> <span class="number">4000</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span> year<span class="punctuation">:</span><span class="number">2007</span><span class="punctuation">,</span> profit<span class="punctuation">:</span> <span class="number">1810</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span> year<span class="punctuation">:</span><span class="number">2008</span><span class="punctuation">,</span> profit<span class="punctuation">:</span> <span class="number">6540</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span> year<span class="punctuation">:</span><span class="number">2009</span><span class="punctuation">,</span> profit<span class="punctuation">:</span> <span class="number">2820</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        name<span class="punctuation">:</span> <span class="string">&quot;Software&quot;</span> <span class="punctuation">,</span></span><br><span class="line">        sales<span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span> year<span class="punctuation">:</span><span class="number">2005</span><span class="punctuation">,</span> profit<span class="punctuation">:</span> <span class="number">1100</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span> year<span class="punctuation">:</span><span class="number">2006</span><span class="punctuation">,</span> profit<span class="punctuation">:</span> <span class="number">1700</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span> year<span class="punctuation">:</span><span class="number">2007</span><span class="punctuation">,</span> profit<span class="punctuation">:</span> <span class="number">1680</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span> year<span class="punctuation">:</span><span class="number">2008</span><span class="punctuation">,</span> profit<span class="punctuation">:</span> <span class="number">4000</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span> year<span class="punctuation">:</span><span class="number">2009</span><span class="punctuation">,</span> profit<span class="punctuation">:</span> <span class="number">4900</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span>;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="数据转换-5"><a href="#数据转换-5" class="headerlink" title="数据转换"></a>数据转换</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> stack = d3.<span class="property">layout</span>.<span class="title function_">stack</span>()</span><br><span class="line">    .<span class="title function_">values</span>(<span class="keyword">function</span>(<span class="params">d</span>)&#123; <span class="keyword">return</span> d.<span class="property">sales</span>; &#125;)</span><br><span class="line">    .<span class="title function_">x</span>(<span class="keyword">function</span>(<span class="params">d</span>)&#123; <span class="keyword">return</span> d.<span class="property">year</span>; &#125;)</span><br><span class="line">    .<span class="title function_">y</span>(<span class="keyword">function</span>(<span class="params">d</span>)&#123; <span class="keyword">return</span> d.<span class="property">profit</span>; &#125;);</span><br><span class="line"><span class="keyword">var</span> data = <span class="title function_">stack</span>(dataset);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>values方法指定需要转换的数据集；</p>
<p>x方法指定数据集中X轴的字段；</p>
<p>y方法指定数据集中Y轴的字段；</p>
<p>转换后的数据如下：</p>
<p><a href="/img/d3/201609242115261474722926.06.jpg"><img src="/img/d3/201609242115261474722926.06.jpg"></a></p>
<p>如图，sales的每一项都多了两个值：y0和y。y0即该层起始坐标，y是高度。x坐标有就是year，这些坐标都是在左上角为起点计算的，这点要注意。</p>
<h5 id="绘制图形-5"><a href="#绘制图形-5" class="headerlink" title="绘制图形"></a>绘制图形</h5><h6 id="生成SVG容器-2"><a href="#生成SVG容器-2" class="headerlink" title="生成SVG容器"></a>生成SVG容器</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> width = <span class="number">700</span>;</span><br><span class="line"><span class="keyword">var</span> height = <span class="number">500</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&#x27;body&#x27;</span>)</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&#x27;svg&#x27;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;width&#x27;</span>, width)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;height&#x27;</span>, height);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="生成图表容器"><a href="#生成图表容器" class="headerlink" title="生成图表容器"></a>生成图表容器</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> padding = &#123;</span><br><span class="line">    <span class="attr">top</span>: <span class="number">50</span>,</span><br><span class="line">    <span class="attr">right</span>: <span class="number">100</span>,</span><br><span class="line">    <span class="attr">bottom</span>: <span class="number">50</span>,</span><br><span class="line">    <span class="attr">left</span>: <span class="number">50</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> charts = svg.<span class="title function_">append</span>(<span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;transform&#x27;</span>, <span class="string">&#x27;translate(&#x27;</span> + padding.<span class="property">left</span> + <span class="string">&#x27;,&#x27;</span> + padding.<span class="property">top</span> + <span class="string">&#x27;)&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="生成颜色比例尺"><a href="#生成颜色比例尺" class="headerlink" title="生成颜色比例尺"></a>生成颜色比例尺</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> colors = d3.<span class="property">scale</span>.<span class="title function_">category10</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="生成X轴和Y轴比例尺"><a href="#生成X轴和Y轴比例尺" class="headerlink" title="生成X轴和Y轴比例尺"></a>生成X轴和Y轴比例尺</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> maxProfit = d3.<span class="title function_">max</span>(data[data.<span class="property">length</span> - <span class="number">1</span>].<span class="property">sales</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> d.<span class="property">y0</span> + d.<span class="property">y</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">var</span> xScale = d3.<span class="property">scale</span>.<span class="title function_">ordinal</span>().<span class="title function_">domain</span>([<span class="number">2005</span>, <span class="number">2006</span>, <span class="number">2007</span>, <span class="number">2008</span>, <span class="number">2009</span>]).<span class="title function_">rangeBands</span>([<span class="number">0</span>, width - padding.<span class="property">left</span> - padding.<span class="property">right</span>], <span class="number">0.3</span>);</span><br><span class="line"><span class="keyword">var</span> yScale = d3.<span class="property">scale</span>.<span class="title function_">linear</span>().<span class="title function_">domain</span>([<span class="number">0</span>, maxProfit]).<span class="title function_">range</span>([<span class="number">0</span>, height - padding.<span class="property">top</span> - padding.<span class="property">bottom</span>]);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="为每种类型数据创建容器"><a href="#为每种类型数据创建容器" class="headerlink" title="为每种类型数据创建容器"></a>为每种类型数据创建容器</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> stack = charts.<span class="title function_">selectAll</span>(<span class="string">&#x27;.stakc&#x27;</span>)</span><br><span class="line">    .<span class="title function_">data</span>(data)</span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">    .<span class="title function_">classed</span>(<span class="string">&#x27;stack&#x27;</span>, <span class="literal">true</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;fill&#x27;</span>, <span class="keyword">function</span>(<span class="params">d, i</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">colors</span>(i);</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="为每种类型数据创建矩形图"><a href="#为每种类型数据创建矩形图" class="headerlink" title="为每种类型数据创建矩形图"></a>为每种类型数据创建矩形图</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> rect = stack.<span class="title function_">selectAll</span>(<span class="string">&#x27;rect&#x27;</span>)</span><br><span class="line">    .<span class="title function_">data</span>(<span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">sales</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&#x27;rect&#x27;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;x&#x27;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">xScale</span>(d.<span class="property">year</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;y&#x27;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> height - padding.<span class="property">top</span> - padding.<span class="property">bottom</span> - <span class="title function_">yScale</span>(d.<span class="property">y0</span> + d.<span class="property">y</span>);</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;width&#x27;</span>, xScale.<span class="title function_">rangeBand</span>())</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;height&#x27;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">yScale</span>(d.<span class="property">y</span>);</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="生成坐标轴"><a href="#生成坐标轴" class="headerlink" title="生成坐标轴"></a>生成坐标轴</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> xAxis = d3.<span class="property">svg</span>.<span class="title function_">axis</span>().<span class="title function_">scale</span>(xScale);</span><br><span class="line"><span class="keyword">var</span> yAxis = d3.<span class="property">svg</span>.<span class="title function_">axis</span>().<span class="title function_">scale</span>(yScale.<span class="title function_">range</span>([height - padding.<span class="property">top</span> - padding.<span class="property">bottom</span>, <span class="number">0</span>])).<span class="title function_">orient</span>(<span class="string">&#x27;left&#x27;</span>);</span><br><span class="line">charts.<span class="title function_">append</span>(<span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">    .<span class="title function_">classed</span>(<span class="string">&#x27;x axis&#x27;</span>, <span class="literal">true</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;transform&#x27;</span>, <span class="string">&#x27;translate(0,&#x27;</span> + (height - padding.<span class="property">top</span> - padding.<span class="property">bottom</span>) + <span class="string">&#x27;)&#x27;</span>)</span><br><span class="line">    .<span class="title function_">call</span>(xAxis)</span><br><span class="line"></span><br><span class="line">charts.<span class="title function_">append</span>(<span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">    .<span class="title function_">classed</span>(<span class="string">&#x27;y axis&#x27;</span>, <span class="literal">true</span>)</span><br><span class="line">    .<span class="title function_">call</span>(yAxis)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="生成数据类型图示"><a href="#生成数据类型图示" class="headerlink" title="生成数据类型图示"></a>生成数据类型图示</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">stack.<span class="title function_">append</span>(<span class="string">&#x27;circle&#x27;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;cx&#x27;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> width - padding.<span class="property">left</span> - padding.<span class="property">right</span> * <span class="number">0.9</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;cy&#x27;</span>, <span class="keyword">function</span>(<span class="params">d, i</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> i * <span class="number">50</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;r&#x27;</span>, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">stack.<span class="title function_">append</span>(<span class="string">&#x27;text&#x27;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;x&#x27;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> width - padding.<span class="property">left</span> - padding.<span class="property">right</span> * <span class="number">0.8</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;y&#x27;</span>, <span class="keyword">function</span>(<span class="params">d, i</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> i * <span class="number">50</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;dy&#x27;</span>, <span class="number">5</span>)</span><br><span class="line">    .<span class="title function_">text</span>(<span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">name</span>;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a href="http://gafish.github.com/demo/d3/stack.html">查看在线演示</a></p>
<h3 id="D3布局-矩阵图"><a href="#D3布局-矩阵图" class="headerlink" title="D3布局-矩阵图"></a>D3布局-矩阵图</h3><h4 id="d3-layout-treemap"><a href="#d3-layout-treemap" class="headerlink" title="d3.layout.treemap()"></a>d3.layout.treemap()</h4><p><a href="/img/d3/201609242115261474722926.28.jpg"><img src="/img/d3/201609242115261474722926.28.jpg"></a></p>
<h4 id="矩阵图-Treemap-的API说明"><a href="#矩阵图-Treemap-的API说明" class="headerlink" title="矩阵图(Treemap)的API说明"></a>矩阵图(Treemap)的API说明</h4><ul>
<li>treemap.children - 取得或设置孩子访问器。</li>
<li>treemap.links - 计算树节点中的父子链接。</li>
<li>treemap.mode - 改变布局的算法。</li>
<li>treemap.nodes - 计算矩形树布局并返回节点数组。</li>
<li>treemap.padding - 指定父子之间的间距。</li>
<li>treemap.round - 启用或者禁用四舍五入像素值。</li>
<li>treemap.size - 指定布局的尺寸。</li>
<li>treemap.sort - 控制兄弟节点的遍历顺序。</li>
<li>treemap.sticky - 让布局对稳定的更新是粘滞的（sticky）。</li>
<li>treemap.value - 取得或设置用来指定矩形树中矩形单元尺寸的值访问器。</li>
<li>treemap - treemap.nodes的别名。</li>
</ul>
<h4 id="绘制步骤-6"><a href="#绘制步骤-6" class="headerlink" title="绘制步骤"></a>绘制步骤</h4><h5 id="数据-7"><a href="#数据-7" class="headerlink" title="数据"></a>数据</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">var dataset = <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;中国&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;children&quot;</span><span class="punctuation">:</span></span><br><span class="line">      <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;浙江&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;children&quot;</span><span class="punctuation">:</span></span><br><span class="line">              <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;杭州&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">8343</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;宁波&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">7128</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;温州&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">4003</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;绍兴&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">3620</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;湖州&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">1803</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;嘉兴&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">3147</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;金华&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">2958</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;衢州&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">1056</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;舟山&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">1021</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;台州&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">3153</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;丽水&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">983</span><span class="punctuation">&#125;</span></span><br><span class="line">              <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;广东&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;children&quot;</span><span class="punctuation">:</span></span><br><span class="line">              <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;杭州&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">8343</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;宁波&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">7128</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;温州&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">4003</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;绍兴&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">3620</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;湖州&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">1803</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;嘉兴&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">3147</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;金华&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">2958</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;衢州&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">1056</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;舟山&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">1021</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;台州&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">3153</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;丽水&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">983</span><span class="punctuation">&#125;</span></span><br><span class="line">              <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;福建&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;children&quot;</span><span class="punctuation">:</span></span><br><span class="line">              <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;杭州&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">8343</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;宁波&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">7128</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;温州&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">4003</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;绍兴&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">3620</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;湖州&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">1803</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;嘉兴&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">3147</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;金华&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">2958</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;衢州&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">1056</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;舟山&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">1021</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;台州&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">3153</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;丽水&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">983</span><span class="punctuation">&#125;</span></span><br><span class="line">              <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>矩阵布局用的还是标准的层级关系数据结构，name、children字段为必须，数据值字段可自定或用默认的value，本例中用的是gdp，所以在接下来的数据转换中需要用value方法指定数据值字段。</p>
<h5 id="数据转换-6"><a href="#数据转换-6" class="headerlink" title="数据转换"></a>数据转换</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> width = <span class="number">800</span>;</span><br><span class="line"><span class="keyword">var</span> height = <span class="number">500</span>;</span><br><span class="line"><span class="keyword">var</span> treemap = d3.<span class="property">layout</span>.<span class="title function_">treemap</span>()</span><br><span class="line">    .<span class="title function_">size</span>([width, height])</span><br><span class="line">    .<span class="title function_">value</span>(<span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">gdp</span>;</span><br><span class="line">    &#125;);</span><br><span class="line"><span class="keyword">var</span> nodes = treemap.<span class="title function_">nodes</span>(dataset);</span><br><span class="line"><span class="keyword">var</span> links = treemap.<span class="title function_">links</span>(nodes);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>转换数据后，节点数组的输出结果如图所示。</p>
<p><a href="/img/d3/201609242115261474722926.46.jpg"><img src="/img/d3/201609242115261474722926.46.jpg"></a></p>
<p>其中，节点对象的属性包括：</p>
<p>parent：父节点<br>children：子节点<br>depth：节点的深度<br>value：节点的value值，由value访问器决定<br>x：节点的x坐标<br>y：节点的y坐标<br>dx：x方向的宽度<br>dy：y方向的宽度</p>
<p>本例中将不会用到liks数据对象；</p>
<h5 id="绘制图形-6"><a href="#绘制图形-6" class="headerlink" title="绘制图形"></a>绘制图形</h5><h6 id="生成SVG容器-3"><a href="#生成SVG容器-3" class="headerlink" title="生成SVG容器"></a>生成SVG容器</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&#x27;body&#x27;</span>).<span class="title function_">append</span>(<span class="string">&#x27;svg&#x27;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;width&#x27;</span>,width)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;height&#x27;</span>,height)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="生成颜色比例尺-1"><a href="#生成颜色比例尺-1" class="headerlink" title="生成颜色比例尺"></a>生成颜色比例尺</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> color = d3.<span class="property">scale</span>.<span class="title function_">category10</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="为每种类型数据创建容器-1"><a href="#为每种类型数据创建容器-1" class="headerlink" title="为每种类型数据创建容器"></a>为每种类型数据创建容器</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> groups = svg.<span class="title function_">selectAll</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">    .<span class="title function_">data</span>(nodes.<span class="title function_">filter</span>(<span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> !d.<span class="property">children</span>;</span><br><span class="line">    &#125;))</span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="为每种类型数据创建矩形图-1"><a href="#为每种类型数据创建矩形图-1" class="headerlink" title="为每种类型数据创建矩形图"></a>为每种类型数据创建矩形图</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> rects = groups.<span class="title function_">append</span>(<span class="string">&quot;rect&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>, <span class="string">&quot;nodeRect&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;x&quot;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">x</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;y&quot;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">y</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">dx</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">dy</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">style</span>(<span class="string">&quot;fill&quot;</span>, <span class="keyword">function</span>(<span class="params">d, i</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">color</span>(d.<span class="property">parent</span>.<span class="property">name</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="生成文本"><a href="#生成文本" class="headerlink" title="生成文本"></a>生成文本</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> texts = groups.<span class="title function_">append</span>(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>, <span class="string">&quot;nodeName&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;x&quot;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">x</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;y&quot;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">y</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;dx&quot;</span>, <span class="string">&quot;0.5em&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;dy&quot;</span>, <span class="string">&quot;1.5em&quot;</span>)</span><br><span class="line">    .<span class="title function_">text</span>(<span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">name</span> + <span class="string">&quot; &quot;</span> + d.<span class="property">gdp</span>;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a href="http://gafish.github.com/demo/d3/treemap.html">查看在线演示</a></p>
<h3 id="D3布局-分区图（矩形）"><a href="#D3布局-分区图（矩形）" class="headerlink" title="D3布局-分区图（矩形）"></a>D3布局-分区图（矩形）</h3><h4 id="d3-layout-partition"><a href="#d3-layout-partition" class="headerlink" title="d3.layout.partition()"></a>d3.layout.partition()</h4><p><a href="/img/d3/201609242115261474722926.6.jpg"><img src="/img/d3/201609242115261474722926.6.jpg"></a></p>
<p>分区图可以展示为方形或者圆形，从原理上来说它是树状结构的一种可视化展现形式，表示包含与被包含的关系；</p>
<h4 id="分区图-Partition-的API说明"><a href="#分区图-Partition-的API说明" class="headerlink" title="分区图(Partition)的API说明"></a>分区图(Partition)的API说明</h4><ul>
<li>partition.children - 取得或设置孩子访问器。</li>
<li>partition.links - 计算树节点中的父子链接。</li>
<li>partition.nodes - 计算分区布局并返回节点数组。</li>
<li>partition.size - 指定布局的尺寸。</li>
<li>partition.sort - 控制兄弟节点的遍历顺序。</li>
<li>partition.value - 取得或设置用来指定圆尺寸的值访问器。</li>
<li>partition - partition.nodes的别名。</li>
</ul>
<h4 id="绘制步骤-7"><a href="#绘制步骤-7" class="headerlink" title="绘制步骤"></a>绘制步骤</h4><h5 id="数据-8"><a href="#数据-8" class="headerlink" title="数据"></a>数据</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    </span><br><span class="line">var dataset = <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;中国&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;children&quot;</span><span class="punctuation">:</span></span><br><span class="line">      <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;浙江&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;children&quot;</span><span class="punctuation">:</span></span><br><span class="line">              <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;嘉兴&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">3147</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;金华&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">2958</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;衢州&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">1056</span><span class="punctuation">&#125;</span></span><br><span class="line">              <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;广东&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;children&quot;</span><span class="punctuation">:</span></span><br><span class="line">              <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;杭州&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">8343</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;绍兴&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">3620</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;湖州&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">1803</span><span class="punctuation">&#125;</span></span><br><span class="line">              <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;福建&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;children&quot;</span><span class="punctuation">:</span></span><br><span class="line">              <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;舟山&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">1021</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;台州&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">3153</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;丽水&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">983</span><span class="punctuation">&#125;</span></span><br><span class="line">              <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<h5 id="数据转换-7"><a href="#数据转换-7" class="headerlink" title="数据转换"></a>数据转换</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">var</span> width = <span class="number">500</span>;</span><br><span class="line"><span class="keyword">var</span> height = <span class="number">500</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> partition = d3.<span class="property">layout</span>.<span class="title function_">partition</span>()</span><br><span class="line">    .<span class="title function_">sort</span>(<span class="literal">null</span>) <span class="comment">//设定内部的顶点的排序函数，null 表示不排序</span></span><br><span class="line">    .<span class="title function_">size</span>([width,height]) <span class="comment">//设定转换后图形的范围</span></span><br><span class="line">    .<span class="title function_">value</span>(<span class="keyword">function</span>(<span class="params">d</span>) &#123; </span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">gdp</span>; </span><br><span class="line">    &#125;); <span class="comment">//设定表示分区大小的值</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> nodes = partition.<span class="title function_">nodes</span>(dataset);</span><br><span class="line"><span class="keyword">var</span> links = partition.<span class="title function_">links</span>(nodes);</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<p>转换数据后，节点数组的输出结果如图所示。</p>
<p><a href="/img/d3/201609242115261474722926.8.jpg"><img src="/img/d3/201609242115261474722926.8.jpg"></a></p>
<p>其中，节点对象的属性包括：</p>
<p>x: 顶点的 x 坐标位置<br>y: 顶点的 y 坐标位置<br>dx: 顶点的宽度 dx<br>dy: 顶点的高度 dy</p>
<p>本例中将不会用到liks数据对象；</p>
<h5 id="绘制图形-7"><a href="#绘制图形-7" class="headerlink" title="绘制图形"></a>绘制图形</h5><h6 id="生成SVG容器-4"><a href="#生成SVG容器-4" class="headerlink" title="生成SVG容器"></a>生成SVG容器</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&#x27;body&#x27;</span>).<span class="title function_">append</span>(<span class="string">&#x27;svg&#x27;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;width&#x27;</span>,width)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;height&#x27;</span>,height)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="生成颜色比例尺-2"><a href="#生成颜色比例尺-2" class="headerlink" title="生成颜色比例尺"></a>生成颜色比例尺</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> color = d3.<span class="property">scale</span>.<span class="title function_">category10</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="为节点数据创建容器"><a href="#为节点数据创建容器" class="headerlink" title="为节点数据创建容器"></a>为节点数据创建容器</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">var</span> rects = svg.<span class="title function_">selectAll</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">              .<span class="title function_">data</span>(nodes)</span><br><span class="line">              .<span class="title function_">enter</span>().<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>);</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<h6 id="为节点数据创建矩形图"><a href="#为节点数据创建矩形图" class="headerlink" title="为节点数据创建矩形图"></a>为节点数据创建矩形图</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">rects.<span class="title function_">append</span>(<span class="string">&quot;rect&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;x&quot;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123; <span class="keyword">return</span> d.<span class="property">x</span>; &#125;)    <span class="comment">// 顶点的 x 坐标</span></span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;y&quot;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123; <span class="keyword">return</span> d.<span class="property">y</span>; &#125;)    <span class="comment">// 顶点的 y 坐标</span></span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123; <span class="keyword">return</span> d.<span class="property">dx</span>; &#125;)  <span class="comment">// 顶点的宽度 dx</span></span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123; <span class="keyword">return</span> d.<span class="property">dy</span>; &#125;)  <span class="comment">//顶点的高度 dy</span></span><br><span class="line">    .<span class="title function_">style</span>(<span class="string">&quot;stroke&quot;</span>, <span class="string">&quot;#fff&quot;</span>)</span><br><span class="line">    .<span class="title function_">style</span>(<span class="string">&quot;fill&quot;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123; <span class="keyword">return</span> <span class="title function_">color</span>(d.<span class="property">name</span>); &#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="生成文本-1"><a href="#生成文本-1" class="headerlink" title="生成文本"></a>生成文本</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">rects.<span class="title function_">append</span>(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>,<span class="keyword">function</span>(<span class="params">d,i</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;translate(&quot;</span> + (d.<span class="property">x</span>+<span class="number">5</span>) + <span class="string">&quot;,&quot;</span> + (d.<span class="property">y</span>+<span class="number">5</span>) + <span class="string">&quot;) rotate(90) &quot;</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">text</span>(<span class="keyword">function</span>(<span class="params">d,i</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">name</span>;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<p><a href="http://gafish.github.com/demo/d3/partition1.html">查看在线演示</a></p>
<h3 id="D3布局-分区图（圆形）"><a href="#D3布局-分区图（圆形）" class="headerlink" title="D3布局-分区图（圆形）"></a>D3布局-分区图（圆形）</h3><h4 id="d3-layout-partition-1"><a href="#d3-layout-partition-1" class="headerlink" title="d3.layout.partition()"></a>d3.layout.partition()</h4><p><a href="/img/d3/201609242115261474722926.96.jpg"><img src="/img/d3/201609242115261474722926.96.jpg"></a></p>
<p>上节中展示的是基本的方形分区图，这节我们要做一个圆形的分区图，圆形图跟方形图基本相同，只有布局函数的 size 函数和绘制图形的部分稍有区别；</p>
<h4 id="绘制步骤-8"><a href="#绘制步骤-8" class="headerlink" title="绘制步骤"></a>绘制步骤</h4><h5 id="数据-9"><a href="#数据-9" class="headerlink" title="数据"></a>数据</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">var dataset = <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;中国&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;children&quot;</span><span class="punctuation">:</span></span><br><span class="line">      <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;浙江&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;children&quot;</span><span class="punctuation">:</span></span><br><span class="line">              <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;嘉兴&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">3147</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;金华&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">2958</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;衢州&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">1056</span><span class="punctuation">&#125;</span></span><br><span class="line">              <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;广东&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;children&quot;</span><span class="punctuation">:</span></span><br><span class="line">              <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;杭州&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">8343</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;绍兴&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">3620</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;湖州&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">1803</span><span class="punctuation">&#125;</span></span><br><span class="line">              <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;福建&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;children&quot;</span><span class="punctuation">:</span></span><br><span class="line">              <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;舟山&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">1021</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;台州&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">3153</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;丽水&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;gdp&quot;</span><span class="punctuation">:</span><span class="number">983</span><span class="punctuation">&#125;</span></span><br><span class="line">              <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h5 id="数据转换-8"><a href="#数据转换-8" class="headerlink" title="数据转换"></a>数据转换</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> width = <span class="number">500</span>;</span><br><span class="line"><span class="keyword">var</span> height = <span class="number">500</span>;</span><br><span class="line"><span class="keyword">var</span> radius =  <span class="title class_">Math</span>.<span class="title function_">min</span>(width, height) / <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> partition = d3.<span class="property">layout</span></span><br><span class="line">.<span class="title function_">partition</span>()</span><br><span class="line">.<span class="title function_">sort</span>(<span class="literal">null</span>) <span class="comment">//设定内部的顶点的排序函数，null 表示不排序</span></span><br><span class="line">.<span class="title function_">size</span>([<span class="number">2</span> * <span class="title class_">Math</span>.<span class="property">PI</span>, radius * radius]) <span class="comment">//第一个值为 2 * PI ，第二个值为圆半径的平方，暂时不去深究为什么这么做，只需记得这么用即可</span></span><br><span class="line">.<span class="title function_">value</span>(<span class="keyword">function</span>(<span class="params">d</span>) &#123; <span class="keyword">return</span> d.<span class="property">gdp</span>; &#125;); <span class="comment">//设定表示分区大小的值</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> nodes = partition.<span class="title function_">nodes</span>(dataset);</span><br><span class="line"><span class="keyword">var</span> links = partition.<span class="title function_">links</span>(nodes);</span><br></pre></td></tr></table></figure>
<p>转换数据后，节点数组的输出结果如图所示。</p>
<p><a href="/img/d3/201609242115271474722927.15.jpg"><img src="/img/d3/201609242115271474722927.15.jpg"></a></p>
<p>其中，节点对象的属性包括：</p>
<p>x: 绕圆心方向的起始位置<br>y: 由圆心向外方向的结束位置<br>dx: 起始位置宽度<br>dy: 结束位置宽度</p>
<p>本例中将不会用到liks数据对象；</p>
<h5 id="绘制图形-8"><a href="#绘制图形-8" class="headerlink" title="绘制图形"></a>绘制图形</h5><h5 id="生成SVG容器-5"><a href="#生成SVG容器-5" class="headerlink" title="生成SVG容器"></a>生成SVG容器</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&#x27;body&#x27;</span>).<span class="title function_">append</span>(<span class="string">&#x27;svg&#x27;</span>)</span><br><span class="line">  .<span class="title function_">attr</span>(<span class="string">&#x27;class&#x27;</span>,<span class="string">&#x27;axis&#x27;</span>)</span><br><span class="line">  .<span class="title function_">attr</span>(<span class="string">&#x27;width&#x27;</span>,width)</span><br><span class="line">  .<span class="title function_">attr</span>(<span class="string">&#x27;height&#x27;</span>,height)</span><br><span class="line">  .<span class="title function_">append</span>(<span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">  .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(&quot;</span> + radius + <span class="string">&quot;,&quot;</span> + radius + <span class="string">&quot;)&quot;</span>);</span><br></pre></td></tr></table></figure>
<h5 id="生成颜色比例尺-3"><a href="#生成颜色比例尺-3" class="headerlink" title="生成颜色比例尺"></a>生成颜色比例尺</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> color = d3.<span class="property">scale</span>.<span class="title function_">category20</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="创建圆弧SVG生成器-1"><a href="#创建圆弧SVG生成器-1" class="headerlink" title="创建圆弧SVG生成器"></a>创建圆弧SVG生成器</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">var</span> arc = d3.<span class="property">svg</span>.<span class="title function_">arc</span>()</span><br><span class="line">        .<span class="title function_">startAngle</span>(<span class="keyword">function</span>(<span class="params">d</span>) &#123; <span class="keyword">return</span> d.<span class="property">x</span>; &#125;)</span><br><span class="line">        .<span class="title function_">endAngle</span>(<span class="keyword">function</span>(<span class="params">d</span>) &#123; <span class="keyword">return</span> d.<span class="property">x</span> + d.<span class="property">dx</span>; &#125;)</span><br><span class="line">        .<span class="title function_">innerRadius</span>(<span class="keyword">function</span>(<span class="params">d</span>) &#123; <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(d.<span class="property">y</span>); &#125;)</span><br><span class="line">        .<span class="title function_">outerRadius</span>(<span class="keyword">function</span>(<span class="params">d</span>) &#123; <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(d.<span class="property">y</span> + d.<span class="property">dy</span>); &#125;);</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<h5 id="为节点数据创建容器-1"><a href="#为节点数据创建容器-1" class="headerlink" title="为节点数据创建容器"></a>为节点数据创建容器</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">var</span> arcs = svg.<span class="title function_">selectAll</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">              .<span class="title function_">data</span>(nodes)</span><br><span class="line">              .<span class="title function_">enter</span>().<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>);</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<h5 id="为节点数据创建圆弧路径"><a href="#为节点数据创建圆弧路径" class="headerlink" title="为节点数据创建圆弧路径"></a>为节点数据创建圆弧路径</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    </span><br><span class="line">arcs.<span class="title function_">append</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;d&quot;</span>, arc)</span><br><span class="line">    .<span class="title function_">style</span>(<span class="string">&quot;stroke&quot;</span>, <span class="string">&quot;#fff&quot;</span>)</span><br><span class="line">    .<span class="title function_">style</span>(<span class="string">&quot;fill&quot;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123; <span class="keyword">return</span> <span class="title function_">color</span>(d.<span class="property">name</span>); &#125;)</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<h5 id="生成文本-2"><a href="#生成文本-2" class="headerlink" title="生成文本"></a>生成文本</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    </span><br><span class="line">arcs.<span class="title function_">append</span>(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;text-anchor&quot;</span>,<span class="string">&quot;middle&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>,<span class="keyword">function</span>(<span class="params">d,i</span>)&#123;</span><br><span class="line">            <span class="comment">//第一个元素不动</span></span><br><span class="line">            <span class="keyword">if</span>( i == <span class="number">0</span> ) <span class="keyword">return</span> ;</span><br><span class="line">    </span><br><span class="line">            <span class="comment">//其它的平移</span></span><br><span class="line">            <span class="keyword">return</span>  <span class="string">&quot;translate(&quot;</span> + arc.<span class="title function_">centroid</span>(d) + <span class="string">&quot;)&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">text</span>(<span class="keyword">function</span>(<span class="params">d</span>) &#123; <span class="keyword">return</span> d.<span class="property">name</span>; &#125;);</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<p><a href="http://gafish.github.com/demo/d3/partition2.html">查看在线演示</a></p>
<h3 id="D3布局-直方图"><a href="#D3布局-直方图" class="headerlink" title="D3布局-直方图"></a>D3布局-直方图</h3><h4 id="d3-layout-histogram"><a href="#d3-layout-histogram" class="headerlink" title="d3.layout.histogram()"></a>d3.layout.histogram()</h4><p><a href="/img/d3/201609242115271474722927.39.jpg"><img src="/img/d3/201609242115271474722927.39.jpg"></a></p>
<p>直方图用于描述概率分布，假设有数组 a &#x3D; [10, 11, 11.5, 12.5, 13, 15, 19, 20]，现在把10<del>20的数值范围分为5段，即：<br>10</del>12, 12<del>14, 14</del>16, 16<del>18, 18</del>20  那么数组 a 的各数值都落在这几段区域的哪一部分呢？经过计算，可以知道，这5段分别具有的元素个数为：  3, 2, 1, 0 , 2 将这个用图形展示出来的，就是直方图。</p>
<h4 id="分区图-Histogram-的API说明"><a href="#分区图-Histogram-的API说明" class="headerlink" title="分区图(Histogram)的API说明"></a>分区图(Histogram)的API说明</h4><ul>
<li>histogram.bins - 分隔数。</li>
<li>histogram.frequency - 若值为 true，则统计的是个数；若值为 false，则统计的是概率</li>
<li>histogram.range - 取得或设置值得范围。</li>
<li>histogram.value - 取得或设置值访问器。</li>
<li>histogram - 使用量化的箱计算数据的分布。</li>
</ul>
<h4 id="绘制步骤-9"><a href="#绘制步骤-9" class="headerlink" title="绘制步骤"></a>绘制步骤</h4><h5 id="数据-10"><a href="#数据-10" class="headerlink" title="数据"></a>数据</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">var dataset = <span class="punctuation">[</span></span><br><span class="line">    <span class="number">0</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">    <span class="number">10</span><span class="punctuation">,</span><span class="number">11</span><span class="punctuation">,</span><span class="number">12</span><span class="punctuation">,</span><span class="number">13</span><span class="punctuation">,</span><span class="number">14</span><span class="punctuation">,</span><span class="number">15</span><span class="punctuation">,</span><span class="number">16</span><span class="punctuation">,</span><span class="number">17</span><span class="punctuation">,</span><span class="number">18</span><span class="punctuation">,</span><span class="number">19</span><span class="punctuation">,</span></span><br><span class="line">    <span class="number">20</span><span class="punctuation">,</span><span class="number">21</span><span class="punctuation">,</span></span><br><span class="line">    <span class="number">30</span><span class="punctuation">,</span><span class="number">32</span><span class="punctuation">,</span><span class="number">37</span><span class="punctuation">,</span></span><br><span class="line">    <span class="number">40</span><span class="punctuation">,</span><span class="number">45</span><span class="punctuation">,</span><span class="number">46</span><span class="punctuation">,</span><span class="number">49</span><span class="punctuation">,</span></span><br><span class="line">    <span class="number">50</span><span class="punctuation">,</span><span class="number">52</span><span class="punctuation">,</span><span class="number">55</span><span class="punctuation">,</span></span><br><span class="line">    <span class="number">60</span><span class="punctuation">,</span><span class="number">69</span><span class="punctuation">,</span></span><br><span class="line">    <span class="number">70</span><span class="punctuation">,</span><span class="number">77</span><span class="punctuation">,</span></span><br><span class="line">    <span class="number">80</span><span class="punctuation">,</span><span class="number">81</span><span class="punctuation">,</span></span><br><span class="line">    <span class="number">90</span><span class="punctuation">,</span><span class="number">91</span><span class="punctuation">,</span><span class="number">99</span><span class="punctuation">,</span></span><br><span class="line">    <span class="number">100</span></span><br><span class="line"><span class="punctuation">]</span>;</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<h5 id="数据转换-9"><a href="#数据转换-9" class="headerlink" title="数据转换"></a>数据转换</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> partition = d3.<span class="property">layout</span>.<span class="title function_">histogram</span>()</span><br><span class="line">    .<span class="title function_">range</span>([<span class="number">0</span>,<span class="number">100</span>])</span><br><span class="line">    .<span class="title function_">bins</span>(<span class="number">10</span>)</span><br><span class="line">    .<span class="title function_">frequency</span>(<span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> data = <span class="title function_">partition</span>(dataset);</span><br></pre></td></tr></table></figure>
<p>转换后的数据如图所示。</p>
<p><a href="/img/d3/201609242115271474722927.54.jpg"><img src="/img/d3/201609242115271474722927.54.jpg"></a></p>
<p>数据参数的含义如下：</p>
<p>0,2,3….：落到此区间的数值<br>length：数值的个数<br>x： 区间的起始位置<br>dx： 区间的宽度<br>y： 落到此区间的数值的数量（如果 frequency 为 true）；落到此区间的概率（如果 frequency 为 false）</p>
<h5 id="绘制图形-9"><a href="#绘制图形-9" class="headerlink" title="绘制图形"></a>绘制图形</h5><h6 id="生成SVG容器-6"><a href="#生成SVG容器-6" class="headerlink" title="生成SVG容器"></a>生成SVG容器</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> width = <span class="number">500</span>;</span><br><span class="line"><span class="keyword">var</span> height = <span class="number">200</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&#x27;body&#x27;</span>).<span class="title function_">append</span>(<span class="string">&#x27;svg&#x27;</span>)</span><br><span class="line">  .<span class="title function_">attr</span>(<span class="string">&#x27;width&#x27;</span>,width)</span><br><span class="line">  .<span class="title function_">attr</span>(<span class="string">&#x27;height&#x27;</span>,height)</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<h6 id="生成x轴和y轴比例尺"><a href="#生成x轴和y轴比例尺" class="headerlink" title="生成x轴和y轴比例尺"></a>生成x轴和y轴比例尺</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = d3.<span class="property">scale</span>.<span class="title function_">linear</span>().<span class="title function_">domain</span>([<span class="number">0</span>,<span class="number">100</span>]).<span class="title function_">range</span>([<span class="number">0</span>,width])</span><br><span class="line"><span class="keyword">var</span> y = d3.<span class="property">scale</span>.<span class="title function_">linear</span>().<span class="title function_">domain</span>([<span class="number">0</span>,<span class="number">10</span>]).<span class="title function_">range</span>([<span class="number">0</span>,height])</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<h6 id="为区间数据创建容器"><a href="#为区间数据创建容器" class="headerlink" title="为区间数据创建容器"></a>为区间数据创建容器</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bar = svg.<span class="title function_">selectAll</span>(<span class="string">&#x27;g&#x27;</span>).<span class="title function_">data</span>(data)</span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;transform&#x27;</span>,<span class="keyword">function</span>(<span class="params">d,i</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;translate(&#x27;</span>+ <span class="title function_">x</span>(d.<span class="property">x</span>) +<span class="string">&#x27;,&#x27;</span>+ (height-<span class="title function_">y</span>(d.<span class="property">y</span>)) +<span class="string">&#x27;)&#x27;</span>;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<h6 id="为区间数据创建矩形"><a href="#为区间数据创建矩形" class="headerlink" title="为区间数据创建矩形"></a>为区间数据创建矩形</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">bar.<span class="title function_">append</span>(<span class="string">&#x27;rect&#x27;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;x&#x27;</span>,<span class="number">0</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;width&#x27;</span>,<span class="keyword">function</span>(<span class="params">d,i</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">x</span>(d.<span class="property">dx</span>)-<span class="number">1</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;height&#x27;</span>,<span class="keyword">function</span>(<span class="params">d,i</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">y</span>(d.<span class="property">y</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;fill&#x27;</span>,<span class="string">&#x27;steelblue&#x27;</span>);</span><br></pre></td></tr></table></figure>
<h6 id="生成区间值文本"><a href="#生成区间值文本" class="headerlink" title="生成区间值文本"></a>生成区间值文本</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">bar.<span class="title function_">append</span>(<span class="string">&#x27;text&#x27;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;x&#x27;</span>,<span class="number">5</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;y&#x27;</span>,<span class="number">20</span>)</span><br><span class="line">    .<span class="title function_">style</span>(&#123;</span><br><span class="line">        <span class="string">&#x27;font-size&#x27;</span>:<span class="number">12</span>,</span><br><span class="line">        <span class="string">&#x27;fill&#x27;</span>: <span class="string">&#x27;#fff&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">text</span>(<span class="keyword">function</span>(<span class="params">d,i</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> d[<span class="number">0</span>]+<span class="string">&#x27; - &#x27;</span>+d[d.<span class="property">length</span>-<span class="number">1</span>]</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>
<p><a href="http://gafish.github.com/demo/d3/histogram.html">查看在线演示</a></p>
<h3 id="D3布局-捆图"><a href="#D3布局-捆图" class="headerlink" title="D3布局-捆图"></a>D3布局-捆图</h3><h4 id="d3-layout-bundle"><a href="#d3-layout-bundle" class="headerlink" title="d3.layout.bundle()"></a>d3.layout.bundle()</h4><p><a href="/img/d3/201609242115271474722927.75.jpg"><img src="/img/d3/201609242115271474722927.75.jpg"></a></p>
<p>下图是航班查询网站全球航班雷达（FlightRadar24）显示的今日长三角地区的飞机飞行图：</p>
<p><a href="/img/d3/201609242115271474722927.97.jpg"><img src="/img/d3/201609242115271474722927.97.jpg"></a></p>
<p>图中我们能看到每时每刻有多少飞行在我们头上飞，有北京-杭州、杭州-日本、上海-北京的航班等等，如果你想知道哪个机场最繁忙，那就可以用到捆图来展现了；</p>
<p>捆图（Bundle）是D3布局中即简单又复杂的一种布局方式，说简单，它只有2个函数来实现数据转换，说复杂，它的实现需要结合其它层级布局来实现，如：集群图、打包图、分区图、树状图、矩阵树图。最常见的是与集群图一起使用，使用集群图布局计算节点的位置，再用捆图布局计算连线路径。也就是说，捆图布局只干一件事：计算连线的路径。</p>
<p>在网上能找到的捆图示例较少，可以参见官方的示例：<a href="http://bl.ocks.org/mbostock/1044242">http://bl.ocks.org/mbostock/1044242</a></p>
<p>本文我们用通俗的方式来讲解捆图的用法；</p>
<h4 id="绘制步骤-10"><a href="#绘制步骤-10" class="headerlink" title="绘制步骤"></a>绘制步骤</h4><h5 id="数据-11"><a href="#数据-11" class="headerlink" title="数据"></a>数据</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 城市列表</span></span><br><span class="line">var cities = <span class="punctuation">&#123;</span></span><br><span class="line">    name<span class="punctuation">:</span> &#x27;&#x27;<span class="punctuation">,</span></span><br><span class="line">    children<span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span>name<span class="punctuation">:</span> <span class="string">&quot;北京&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span>name<span class="punctuation">:</span> <span class="string">&quot;昆明&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span>name<span class="punctuation">:</span> <span class="string">&quot;成都&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span>name<span class="punctuation">:</span> <span class="string">&quot;西安&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span>name<span class="punctuation">:</span> <span class="string">&quot;上海&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span>name<span class="punctuation">:</span> <span class="string">&quot;杭州&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span>name<span class="punctuation">:</span> <span class="string">&quot;广州&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span>name<span class="punctuation">:</span> <span class="string">&quot;桂林&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span>name<span class="punctuation">:</span> <span class="string">&quot;太原&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span>name<span class="punctuation">:</span> <span class="string">&quot;美国&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 航班路线</span></span><br><span class="line">var railway = <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span>source<span class="punctuation">:</span> <span class="string">&quot;美国&quot;</span><span class="punctuation">,</span> target<span class="punctuation">:</span> <span class="string">&quot;上海&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span>source<span class="punctuation">:</span> <span class="string">&quot;北京&quot;</span><span class="punctuation">,</span> target<span class="punctuation">:</span> <span class="string">&quot;上海&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span>source<span class="punctuation">:</span> <span class="string">&quot;北京&quot;</span><span class="punctuation">,</span> target<span class="punctuation">:</span> <span class="string">&quot;广州&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span>source<span class="punctuation">:</span> <span class="string">&quot;北京&quot;</span><span class="punctuation">,</span> target<span class="punctuation">:</span> <span class="string">&quot;杭州&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span>source<span class="punctuation">:</span> <span class="string">&quot;美国&quot;</span><span class="punctuation">,</span> target<span class="punctuation">:</span> <span class="string">&quot;杭州&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span>source<span class="punctuation">:</span> <span class="string">&quot;北京&quot;</span><span class="punctuation">,</span> target<span class="punctuation">:</span> <span class="string">&quot;西安&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span>source<span class="punctuation">:</span> <span class="string">&quot;北京&quot;</span><span class="punctuation">,</span> target<span class="punctuation">:</span> <span class="string">&quot;成都&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span>source<span class="punctuation">:</span> <span class="string">&quot;美国&quot;</span><span class="punctuation">,</span> target<span class="punctuation">:</span> <span class="string">&quot;北京&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span>source<span class="punctuation">:</span> <span class="string">&quot;北京&quot;</span><span class="punctuation">,</span> target<span class="punctuation">:</span> <span class="string">&quot;太原&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span>source<span class="punctuation">:</span> <span class="string">&quot;北京&quot;</span><span class="punctuation">,</span> target<span class="punctuation">:</span> <span class="string">&quot;桂林&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span>source<span class="punctuation">:</span> <span class="string">&quot;北京&quot;</span><span class="punctuation">,</span> target<span class="punctuation">:</span> <span class="string">&quot;昆明&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span>source<span class="punctuation">:</span> <span class="string">&quot;北京&quot;</span><span class="punctuation">,</span> target<span class="punctuation">:</span> <span class="string">&quot;成都&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span>source<span class="punctuation">:</span> <span class="string">&quot;上海&quot;</span><span class="punctuation">,</span> target<span class="punctuation">:</span> <span class="string">&quot;杭州&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span>source<span class="punctuation">:</span> <span class="string">&quot;昆明&quot;</span><span class="punctuation">,</span> target<span class="punctuation">:</span> <span class="string">&quot;成都&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span>source<span class="punctuation">:</span> <span class="string">&quot;西安&quot;</span><span class="punctuation">,</span> target<span class="punctuation">:</span> <span class="string">&quot;太原&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span>;</span><br></pre></td></tr></table></figure>
<h5 id="数据转换-10"><a href="#数据转换-10" class="headerlink" title="数据转换"></a>数据转换</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">var</span> width = <span class="number">500</span>;</span><br><span class="line"><span class="keyword">var</span> height = <span class="number">500</span>;</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 需要一个方法将航班路线数据跟城市列表数据对接起来</span></span><br><span class="line"><span class="keyword">var</span> map = <span class="keyword">function</span> (<span class="params"> nodes, links </span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> hash = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; nodes.<span class="property">length</span>; i++)&#123;</span><br><span class="line">        hash[nodes[i].<span class="property">name</span>] = nodes[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> resultLinks = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; links.<span class="property">length</span>; i++)&#123;</span><br><span class="line">        resultLinks.<span class="title function_">push</span>(&#123;</span><br><span class="line">            <span class="attr">source</span>: hash[ links[i].<span class="property">source</span> ],</span><br><span class="line">            <span class="attr">target</span>: hash[ links[i].<span class="property">target</span> ]</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> resultLinks;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 分别创建一个集群图布局和一个捆图布局，360表示角度，width/2 - 50 表示捆图圆半径</span></span><br><span class="line"><span class="keyword">var</span> cluster = d3.<span class="property">layout</span>.<span class="title function_">cluster</span>().<span class="title function_">size</span>([<span class="number">360</span>, width/<span class="number">2</span> - <span class="number">50</span>])</span><br><span class="line"><span class="keyword">var</span> bundle = d3.<span class="property">layout</span>.<span class="title function_">bundle</span>();</span><br><span class="line">    </span><br><span class="line"><span class="keyword">var</span> nodes = cluster.<span class="title function_">nodes</span>(cities);</span><br><span class="line"><span class="keyword">var</span> oLinks = <span class="title function_">map</span>(nodes, railway);</span><br><span class="line"><span class="keyword">var</span> links = <span class="title function_">bundle</span>(oLinks);</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<p>转换后的数据如图所示。</p>
<p>nodes - 节点<br><a href="/img/d3/201609242115281474722928.12.jpg"><img src="/img/d3/201609242115281474722928.12.jpg"></a></p>
<p>oLinks - 路线与城市对接后的数据<br><a href="/img/d3/201609242115281474722928.29.jpg"><img src="/img/d3/201609242115281474722928.29.jpg"></a></p>
<p>links - 捆图线条数据<br><a href="/img/d3/201609242115281474722928.46.jpg"><img src="/img/d3/201609242115281474722928.46.jpg"></a></p>
<h5 id="绘制图形-10"><a href="#绘制图形-10" class="headerlink" title="绘制图形"></a>绘制图形</h5><h6 id="生成SVG容器-7"><a href="#生成SVG容器-7" class="headerlink" title="生成SVG容器"></a>生成SVG容器</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&#x27;body&#x27;</span>).<span class="title function_">append</span>(<span class="string">&#x27;svg&#x27;</span>)</span><br><span class="line">  .<span class="title function_">attr</span>(<span class="string">&#x27;width&#x27;</span>,width)</span><br><span class="line">  .<span class="title function_">attr</span>(<span class="string">&#x27;height&#x27;</span>,height)</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<h6 id="创建径向折线SVG生成器"><a href="#创建径向折线SVG生成器" class="headerlink" title="创建径向折线SVG生成器"></a>创建径向折线SVG生成器</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">var</span> line = d3.<span class="property">svg</span>.<span class="property">line</span>.<span class="title function_">radial</span>()</span><br><span class="line">    .<span class="title function_">interpolate</span>(<span class="string">&quot;bundle&quot;</span>) <span class="comment">//在line.interpolate()所预定义的插值模式中，有一种就叫做bundle，正是为捆图准备的。</span></span><br><span class="line">    .<span class="title function_">radius</span>(<span class="keyword">function</span>(<span class="params">d</span>) &#123; <span class="keyword">return</span> d.<span class="property">y</span>; &#125;)</span><br><span class="line">    .<span class="title function_">angle</span>(<span class="keyword">function</span>(<span class="params">d</span>) &#123; <span class="keyword">return</span> d.<span class="property">x</span> / <span class="number">360</span> * <span class="number">2</span> * <span class="title class_">Math</span>.<span class="property">PI</span>; &#125;);</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<h6 id="生成捆图容器"><a href="#生成捆图容器" class="headerlink" title="生成捆图容器"></a>生成捆图容器</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gBundle = svg.<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(&quot;</span> + (width/<span class="number">2</span>) + <span class="string">&quot;,&quot;</span> + (height/<span class="number">2</span>) + <span class="string">&quot;)&quot;</span>);</span><br></pre></td></tr></table></figure>
<h6 id="颜色比例尺"><a href="#颜色比例尺" class="headerlink" title="颜色比例尺"></a>颜色比例尺</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> color = d3.<span class="property">scale</span>.<span class="title function_">category20c</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="生成连线路径-1"><a href="#生成连线路径-1" class="headerlink" title="生成连线路径"></a>生成连线路径</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">var</span> link = gBundle.<span class="title function_">selectAll</span>(<span class="string">&quot;.link&quot;</span>)</span><br><span class="line">    .<span class="title function_">data</span>(links)</span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line">    .<span class="title function_">classed</span>(<span class="string">&#x27;link&#x27;</span>,<span class="literal">true</span>)</span><br><span class="line">    .<span class="title function_">style</span>(&#123;</span><br><span class="line">        <span class="string">&#x27;fill&#x27;</span>: <span class="string">&#x27;none&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;stroke&#x27;</span>: <span class="string">&#x27;rgba(0,0,0,0.5)&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;stroke-width&#x27;</span>: <span class="number">5</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;d&quot;</span>, line);</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<h6 id="生成城市节点容器"><a href="#生成城市节点容器" class="headerlink" title="生成城市节点容器"></a>生成城市节点容器</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">var</span> node = gBundle.<span class="title function_">selectAll</span>(<span class="string">&#x27;.node&#x27;</span>)</span><br><span class="line">    .<span class="title function_">data</span>( nodes.<span class="title function_">filter</span>(<span class="keyword">function</span>(<span class="params">d</span>) &#123; <span class="keyword">return</span> !d.<span class="property">children</span>; &#125;) ) <span class="comment">//排除数据中最顶层的空数据</span></span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">    .<span class="title function_">classed</span>(<span class="string">&#x27;node&#x27;</span>,<span class="literal">true</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;rotate(&quot;</span> + (d.<span class="property">x</span>- <span class="number">90</span>) + <span class="string">&quot;) translate(&quot;</span>+ d.<span class="property">y</span> + <span class="string">&quot;)&quot;</span>; <span class="comment">//这里为什么是d.x- 90，我也还不明白，暂先用着，后续再深入了解</span></span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<h6 id="在节点容器中创建圆形和文本"><a href="#在节点容器中创建圆形和文本" class="headerlink" title="在节点容器中创建圆形和文本"></a>在节点容器中创建圆形和文本</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    </span><br><span class="line">node.<span class="title function_">append</span>(<span class="string">&#x27;circle&#x27;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;r&#x27;</span>,<span class="number">20</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;fill&#x27;</span>, <span class="keyword">function</span>(<span class="params">d,i</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">color</span>(i);</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">node.<span class="title function_">append</span>(<span class="string">&#x27;text&#x27;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;dy&#x27;</span>,<span class="string">&#x27;0.2em&#x27;</span>)</span><br><span class="line">    .<span class="title function_">style</span>(<span class="string">&quot;text-anchor&quot;</span>, <span class="string">&quot;middle&quot;</span>)</span><br><span class="line">    .<span class="title function_">text</span>(<span class="keyword">function</span>(<span class="params">d,i</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">name</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<p><a href="http://gafish.github.com/demo/d3/bundle.html">查看在线演示</a></p>
<h3 id="D3交互事件"><a href="#D3交互事件" class="headerlink" title="D3交互事件"></a>D3交互事件</h3><p><a href="/img/d3/201609242115281474722928.6.jpg"><img src="/img/d3/201609242115281474722928.6.jpg"></a></p>
<p>前20节中，我们讲了各种静态D3图表的制作，好的图表应该是要与用户进行互动的，这节来讲讲D3的交互事件；</p>
<h4 id="d3-event"><a href="#d3-event" class="headerlink" title="d3.event"></a>d3.event</h4><p>selection选择器事件监听的写法跟平时我们用的jQuery类似，如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">selection.<span class="title function_">on</span>(‘click’,<span class="keyword">function</span>(<span class="params">d,i</span>)&#123;  </span><br><span class="line">    <span class="title function_">alert</span>(‘ok’);  </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>但请注意，点击事件触发的匿名函数参数不是我们常用的e或event，而是绑定在选择器上的数据d和数据的序列号i，这点非常重要。</p>
<h5 id="注册事件"><a href="#注册事件" class="headerlink" title="注册事件"></a>注册事件</h5><p>我们只要调用全局对象<code>d3.event</code>，它是DOM事件，并实现了标准事件字段，像时间戳timeStamp和键代码keyCode，以及preventDefault()方法和的stopPropagation()方法。当然你可以使用原生事件的pageX and pageY；</p>
<p>在后面的在线示例中我们是这样使用d3.event的</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="attr">mouseenter</span>: <span class="keyword">function</span>(<span class="params">d,i</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> e = d3.<span class="property">event</span>;</span><br><span class="line">  <span class="keyword">var</span> t = d3.<span class="title function_">select</span>(<span class="variable language_">this</span>)</span><br><span class="line">  t.<span class="title function_">attr</span>(<span class="string">&#x27;fill&#x27;</span>,<span class="string">&#x27;#000&#x27;</span>);</span><br><span class="line">  text1.<span class="title function_">text</span>(<span class="string">&#x27;当前圆半径：&#x27;</span>+ d.<span class="property">r</span> +<span class="string">&#x27;px&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<p>注意：通过直接调用d.r可以取到当前选择器上绑定的半径数据；</p>
<p>给选择的元素重复注册事件监听，新的事件被替换之前注册的事件。为注册多个监听器，可以跟一个可选的命名空间，如“click.foo”和“click.bar”。</p>
<h5 id="注销事件"><a href="#注销事件" class="headerlink" title="注销事件"></a>注销事件</h5><p>要删除事件监听器，只需要传递null给listener，如示例中的如下代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="attr">click</span>: <span class="keyword">function</span>(<span class="params">d,i</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> t = d3.<span class="title function_">select</span>(<span class="variable language_">this</span>);</span><br><span class="line">  t.<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>,<span class="literal">null</span>).<span class="title function_">remove</span>();</span><br><span class="line">&#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<h4 id="d3-mouse-container"><a href="#d3-mouse-container" class="headerlink" title="d3.mouse(container)"></a>d3.mouse(container)</h4><p>通过使用全局方法d3.mouse可以方便的获取到当前事件对象的x&#x2F;y坐标值，container为原生DOM对象；</p>
<h4 id="d3-behavior-drag"><a href="#d3-behavior-drag" class="headerlink" title="d3.behavior.drag"></a>d3.behavior.drag</h4><p>拖动行为，通过监听拖拽事件控制SVG的交互行为，以下代码出自最后面的示例；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment">// 创建拖动行为</span></span><br><span class="line"><span class="keyword">var</span> drag = d3.<span class="property">behavior</span>.<span class="title function_">drag</span>()</span><br><span class="line">  .<span class="title function_">on</span>(<span class="string">&quot;drag&quot;</span>, <span class="keyword">function</span>(<span class="params">d,i</span>) &#123;</span><br><span class="line">    <span class="comment">// 监听拖拽事件</span></span><br><span class="line">    <span class="keyword">var</span> e = d3.<span class="property">event</span>;</span><br><span class="line">    <span class="keyword">var</span> t = d3.<span class="title function_">select</span>(<span class="variable language_">this</span>)</span><br><span class="line">    t.<span class="title function_">attr</span>(&#123;</span><br><span class="line">      <span class="attr">cx</span>: e.<span class="property">x</span>,</span><br><span class="line">      <span class="attr">cy</span>: e.<span class="property">y</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">circle1.<span class="title function_">call</span>(drag);</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<h4 id="d3-behavior-zoom"><a href="#d3-behavior-zoom" class="headerlink" title="d3.behavior.zoom"></a>d3.behavior.zoom</h4><p>缩放行为，通过监听缩放事件控制SVG的交互行为，以下代码出自最后面的示例；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment">// 创建缩放行为</span></span><br><span class="line"><span class="keyword">var</span> zoom = d3.<span class="property">behavior</span>.<span class="title function_">zoom</span>()</span><br><span class="line">  .<span class="title function_">on</span>(<span class="string">&quot;zoom&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">// 监听缩放事件</span></span><br><span class="line">    circle2.<span class="title function_">attr</span>(<span class="string">&#x27;transform&#x27;</span>,<span class="string">&quot;translate(&quot;</span> + d3.<span class="property">event</span>.<span class="property">translate</span> + <span class="string">&quot;)scale(&quot;</span> + d3.<span class="property">event</span>.<span class="property">scale</span> + <span class="string">&quot;)&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"> circle2.<span class="title function_">call</span>(zoom)</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<p>[查看在线演示][85]</p>
<h3 id="D3几何-泰森多边形"><a href="#D3几何-泰森多边形" class="headerlink" title="D3几何 - 泰森多边形"></a>D3几何 - 泰森多边形</h3><h4 id="d3-geom-voronoi"><a href="#d3-geom-voronoi" class="headerlink" title="d3.geom.voronoi()"></a>d3.geom.voronoi()</h4><p><a href="/img/d3/201609242115281474722928.77.jpg"><img src="/img/d3/201609242115281474722928.77.jpg"></a></p>
<p>在日常生活中有这样的场景，在一个城市中有很多的便利店，当你走在城市的任意地方，怎么才能找到离你了近的便利店呢？这种场景就适合用泰森多边形来解决。</p>
<p>通过一个示例来展示。</p>
<h4 id="绘制步骤-11"><a href="#绘制步骤-11" class="headerlink" title="绘制步骤"></a>绘制步骤</h4><h5 id="数据-12"><a href="#数据-12" class="headerlink" title="数据"></a>数据</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> dataset = [[<span class="number">18</span>,<span class="number">162</span>], [<span class="number">114</span>,<span class="number">403</span>], [<span class="number">261</span>,<span class="number">98</span>] ]; <span class="comment">//假设这是三家便利店</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="数据转换-11"><a href="#数据转换-11" class="headerlink" title="数据转换"></a>数据转换</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">var</span> width = <span class="number">500</span>;</span><br><span class="line"><span class="keyword">var</span> height = <span class="number">500</span>;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">var</span> voronoi = d3.<span class="property">geom</span>.<span class="title function_">voronoi</span>()</span><br><span class="line">  .<span class="title function_">clipExtent</span>([[<span class="number">0</span>, <span class="number">0</span>], [width, height]]);<span class="comment">//从画面左上角到右下角为显示区间</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">var</span> data = <span class="title function_">voronoi</span>(dataset);</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<p>转换后的数据如图所示。</p>
<p><a href="/img/d3/201609242115281474722928.93.jpg"><img src="/img/d3/201609242115281474722928.93.jpg"></a></p>
<p>通过转换，将数据变成折线图的每个顶点坐标，这样我们就可以通过将顶点连接起来组成一个个不规则区域；</p>
<h5 id="绘制图形-11"><a href="#绘制图形-11" class="headerlink" title="绘制图形"></a>绘制图形</h5><h6 id="生成SVG容器-8"><a href="#生成SVG容器-8" class="headerlink" title="生成SVG容器"></a>生成SVG容器</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&#x27;body&#x27;</span>).<span class="title function_">append</span>(<span class="string">&#x27;svg&#x27;</span>)</span><br><span class="line">  .<span class="title function_">attr</span>(<span class="string">&#x27;width&#x27;</span>,width)</span><br><span class="line">  .<span class="title function_">attr</span>(<span class="string">&#x27;height&#x27;</span>,height)</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<h6 id="颜色比例尺-1"><a href="#颜色比例尺-1" class="headerlink" title="颜色比例尺"></a>颜色比例尺</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> color = d3.<span class="property">scale</span>.<span class="title function_">category10</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="生成折线路径"><a href="#生成折线路径" class="headerlink" title="生成折线路径"></a>生成折线路径</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    </span><br><span class="line">svg.<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>).<span class="title function_">selectAll</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line">  .<span class="title function_">data</span>(data)</span><br><span class="line">  .<span class="title function_">enter</span>()</span><br><span class="line">  .<span class="title function_">append</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line">  .<span class="title function_">attr</span>(<span class="string">&#x27;fill&#x27;</span>,<span class="keyword">function</span>(<span class="params">d,i</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">color</span>(i);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">attr</span>(<span class="string">&quot;d&quot;</span>, <span class="keyword">function</span>(<span class="params">d,i</span>)&#123;</span><br><span class="line">    <span class="comment">// 通过d.join(&quot;L&quot;)方法将每个顶点连接起来</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;M&quot;</span> + d.<span class="title function_">join</span>(<span class="string">&quot;L&quot;</span>) + <span class="string">&quot;Z&quot;</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<h6 id="生成便利店位置"><a href="#生成便利店位置" class="headerlink" title="生成便利店位置"></a>生成便利店位置</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    </span><br><span class="line">svg.<span class="title function_">append</span>(<span class="string">&#x27;g&#x27;</span>).<span class="title function_">selectAll</span>(<span class="string">&#x27;circle&#x27;</span>)</span><br><span class="line">  .<span class="title function_">data</span>(dataset)</span><br><span class="line">  .<span class="title function_">enter</span>()</span><br><span class="line">  .<span class="title function_">append</span>(<span class="string">&#x27;circle&#x27;</span>)</span><br><span class="line">  .<span class="title function_">attr</span>(<span class="string">&#x27;cx&#x27;</span>, <span class="keyword">function</span>(<span class="params">d,i</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> d[<span class="number">0</span>];</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">attr</span>(<span class="string">&#x27;cy&#x27;</span>, <span class="keyword">function</span>(<span class="params">d,i</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> d[<span class="number">1</span>];</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">attr</span>(<span class="string">&#x27;r&#x27;</span>, <span class="number">5</span>)</span><br><span class="line">  .<span class="title function_">attr</span>(<span class="string">&#x27;fill&#x27;</span>,<span class="string">&#x27;#fff&#x27;</span>)</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<p>注意在生成便利店位置时，我们用的数据是原始的数据；</p>
<p><a href="http://gafish.github.com/demo/d3/voronoi.html">查看在线演示</a></p>
<h3 id="D3几何-四叉树"><a href="#D3几何-四叉树" class="headerlink" title="D3几何 - 四叉树"></a>D3几何 - 四叉树</h3><h4 id="d3-geom-quadtree"><a href="#d3-geom-quadtree" class="headerlink" title="d3.geom.quadtree"></a>d3.geom.quadtree</h4><p><a href="/img/d3/201609242115291474722929.1.jpg"><img src="/img/d3/201609242115291474722929.1.jpg"></a></p>
<p>四叉树也被称为Q树（Q-Tree）。四叉树广泛应用于图像处理、空间数据索引、2D中的快速碰撞检测、存储稀疏数据等，对游戏编程，这会很有用。</p>
<p>四叉树（Q-Tree）是一种树形数据结构。四叉树的定义是：它的每个节点下至多可以有四个子节点，通常把一部分二维空间细分为四个象限或区域并把该区域里的相关信息存入到四叉树节点中。</p>
<p><a href="/img/d3/201609242115291474722929.27.jpg"><img src="/img/d3/201609242115291474722929.27.jpg"></a></p>
<p>四叉树的每一个节点代表一个矩形区域（如上图黑色的根节点代表最外围黑色边框的矩形区域），每一个矩形区域又可划分为四个小矩形区域，这四个小矩形区域作为四个子节点所代表的矩形区域。</p>
<h4 id="绘制步骤-12"><a href="#绘制步骤-12" class="headerlink" title="绘制步骤"></a>绘制步骤</h4><p>通过一个示例来展示。</p>
<h5 id="数据-13"><a href="#数据-13" class="headerlink" title="数据"></a>数据</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> width = <span class="number">500</span>,</span><br><span class="line">    height = <span class="number">500</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成一份模拟数据，表示图上的10个点坐标</span></span><br><span class="line"><span class="keyword">var</span> dataset = d3.<span class="title function_">range</span>(<span class="number">10</span>).<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> [<span class="title class_">Math</span>.<span class="title function_">random</span>() * width, <span class="title class_">Math</span>.<span class="title function_">random</span>() * height];</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="数据转换-12"><a href="#数据转换-12" class="headerlink" title="数据转换"></a>数据转换</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> quadtree = d3.<span class="property">geom</span>.<span class="title function_">quadtree</span>()</span><br><span class="line">    .<span class="title function_">extent</span>([[<span class="number">0</span>, <span class="number">0</span>], [width, height]])</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> root = <span class="title function_">quadtree</span>(dataset);</span><br><span class="line"><span class="keyword">var</span> data = [];</span><br><span class="line"><span class="comment">// 遍历四叉树中的每个节点，获得rect的坐标数据</span></span><br><span class="line">root.<span class="title function_">visit</span>(<span class="keyword">function</span>(<span class="params">node, x1, y1, x2, y2</span>) &#123;</span><br><span class="line">  node.<span class="property">x1</span> = x1;</span><br><span class="line">  node.<span class="property">y1</span> = y1;</span><br><span class="line">  node.<span class="property">x2</span> = x2;</span><br><span class="line">  node.<span class="property">y2</span> = y2;</span><br><span class="line">  data.<span class="title function_">push</span>(node);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>通过quadtree转换后的数据如图所示：</p>
<p><a href="/img/d3/201609242115291474722929.44.jpg"><img src="/img/d3/201609242115291474722929.44.jpg"></a></p>
<p>转换后的数据都在nodes中，为了生成矩形图，我们需要用root.visit方法再次将数据做一层转换，最终用来生成SVG的数据如下：</p>
<p><a href="/img/d3/201609242115291474722929.63.jpg"><img src="/img/d3/201609242115291474722929.63.jpg"></a></p>
<h5 id="绘制图形-12"><a href="#绘制图形-12" class="headerlink" title="绘制图形"></a>绘制图形</h5><h6 id="生成SVG容器-9"><a href="#生成SVG容器-9" class="headerlink" title="生成SVG容器"></a>生成SVG容器</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&#x27;body&#x27;</span>).<span class="title function_">append</span>(<span class="string">&#x27;svg&#x27;</span>)</span><br><span class="line">  .<span class="title function_">attr</span>(<span class="string">&#x27;width&#x27;</span>,width)</span><br><span class="line">  .<span class="title function_">attr</span>(<span class="string">&#x27;height&#x27;</span>,height)</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<h6 id="颜色比例尺-2"><a href="#颜色比例尺-2" class="headerlink" title="颜色比例尺"></a>颜色比例尺</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> color = d3.<span class="property">scale</span>.<span class="title function_">category10</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="生成矩形"><a href="#生成矩形" class="headerlink" title="生成矩形"></a>生成矩形</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> rect = svg.<span class="title function_">selectAll</span>(<span class="string">&quot;rect&quot;</span>)</span><br><span class="line">    .<span class="title function_">data</span>(data)</span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;rect&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;fill&quot;</span>, <span class="string">&quot;none&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;stroke&#x27;</span>,<span class="keyword">function</span>(<span class="params">d,i</span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">color</span>(i)</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;stroke-width&#x27;</span>,<span class="number">1</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;x&quot;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123; <span class="keyword">return</span> d.<span class="property">x1</span>; &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;y&quot;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123; <span class="keyword">return</span> d.<span class="property">y1</span>; &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123; <span class="keyword">return</span> d.<span class="property">x2</span> - d.<span class="property">x1</span>; &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123; <span class="keyword">return</span> d.<span class="property">y2</span> - d.<span class="property">y1</span>; &#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="生成随机数据中的坐标点"><a href="#生成随机数据中的坐标点" class="headerlink" title="生成随机数据中的坐标点"></a>生成随机数据中的坐标点</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> point = svg.<span class="title function_">selectAll</span>(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">    .<span class="title function_">data</span>(dataset)</span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;cx&quot;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123; <span class="keyword">return</span> d[<span class="number">0</span>]; &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;cy&quot;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123; <span class="keyword">return</span> d[<span class="number">1</span>]; &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;r&quot;</span>, <span class="number">3</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a href="http://gafish.github.com/demo/d3/quadtree.html">查看在线演示</a></p>
<h3 id="D3几何-多边形"><a href="#D3几何-多边形" class="headerlink" title="D3几何 - 多边形"></a>D3几何 - 多边形</h3><h4 id="d3-geom-polygon"><a href="#d3-geom-polygon" class="headerlink" title="d3.geom.polygon"></a>d3.geom.polygon</h4><p><a href="/img/d3/201609242115291474722929.86.jpg"><img src="/img/d3/201609242115291474722929.86.jpg"></a></p>
<p>polygon函数有3个用途：</p>
<ul>
<li>polygon.area() 用来计算多边形面积；</li>
<li>polygon.centroid() 用来计算多边形中心坐标；</li>
<li>polygon.clip(subject) 用来处理2个多边形重叠时，返回重叠区域多边形，用来剪切的多边形需要是逆时针方向且是凸多边形；</li>
</ul>
<h4 id="绘制步骤-13"><a href="#绘制步骤-13" class="headerlink" title="绘制步骤"></a>绘制步骤</h4><p>通过一个示例来展示。</p>
<h5 id="数据-14"><a href="#数据-14" class="headerlink" title="数据"></a>数据</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment">// dataset0 用来做裁切主体，它的坐标需要是逆时针方向</span></span><br><span class="line"><span class="keyword">var</span> dataset0 = [[<span class="number">100</span>,<span class="number">100</span>],[<span class="number">100</span>,<span class="number">300</span>],[<span class="number">300</span>,<span class="number">300</span>],[<span class="number">300</span>,<span class="number">100</span>]];</span><br><span class="line"><span class="keyword">var</span> dataset1 = [[<span class="number">200</span>,<span class="number">50</span>],[<span class="number">400</span>,<span class="number">50</span>],[<span class="number">400</span>,<span class="number">400</span>],[<span class="number">200</span>,<span class="number">400</span>]];</span><br><span class="line">    </span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<h5 id="数据转换-13"><a href="#数据转换-13" class="headerlink" title="数据转换"></a>数据转换</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">var</span> data0 = d3.<span class="property">geom</span>.<span class="title function_">polygon</span>(dataset0);</span><br><span class="line"><span class="keyword">var</span> data1 = d3.<span class="property">geom</span>.<span class="title function_">polygon</span>(dataset1);</span><br><span class="line"><span class="keyword">var</span> data2 = data1.<span class="title function_">slice</span>();<span class="comment">//复制一个data1，用来展示重叠的区域</span></span><br><span class="line">    </span><br><span class="line">data0.<span class="title function_">clip</span>(data2);</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<p>通过d3.geom.polygon(dataset1)转换后的数据data1，主要是给数据加了3个方法，如图所示：</p>
<p><a href="/img/d3/201609242115301474722930.02.jpg"><img src="/img/d3/201609242115301474722930.02.jpg"></a></p>
<p>裁切后的数据data2就是2个多边形的重叠区域：</p>
<p><a href="/img/d3/201609242115301474722930.24.jpg"><img src="/img/d3/201609242115301474722930.24.jpg"></a></p>
<h5 id="绘制图形-13"><a href="#绘制图形-13" class="headerlink" title="绘制图形"></a>绘制图形</h5><h6 id="生成SVG容器-10"><a href="#生成SVG容器-10" class="headerlink" title="生成SVG容器"></a>生成SVG容器</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">var</span> width = <span class="number">500</span>;</span><br><span class="line"><span class="keyword">var</span> height = <span class="number">500</span>;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&#x27;body&#x27;</span>).<span class="title function_">append</span>(<span class="string">&#x27;svg&#x27;</span>).<span class="title function_">attr</span>(&#123;</span><br><span class="line">  <span class="attr">width</span>: width,</span><br><span class="line">  <span class="attr">height</span>: height</span><br><span class="line">&#125;);</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<h6 id="把3个多边形都输出看效果"><a href="#把3个多边形都输出看效果" class="headerlink" title="把3个多边形都输出看效果"></a>把3个多边形都输出看效果</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    </span><br><span class="line">svg.<span class="title function_">append</span>(<span class="string">&#x27;polygon&#x27;</span>).<span class="title function_">attr</span>(&#123;</span><br><span class="line">  <span class="attr">points</span>: data0,</span><br><span class="line">  <span class="attr">stroke</span>: <span class="string">&#x27;black&#x27;</span>,</span><br><span class="line">  <span class="attr">fill</span>: <span class="string">&#x27;#ccc&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line">    </span><br><span class="line">svg.<span class="title function_">append</span>(<span class="string">&#x27;polygon&#x27;</span>).<span class="title function_">attr</span>(&#123;</span><br><span class="line">  <span class="attr">points</span>: data1,</span><br><span class="line">  <span class="attr">stroke</span>: <span class="string">&#x27;black&#x27;</span>,</span><br><span class="line">  <span class="attr">fill</span>: <span class="string">&#x27;#eee&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line">    </span><br><span class="line">svg.<span class="title function_">append</span>(<span class="string">&#x27;polygon&#x27;</span>).<span class="title function_">attr</span>(&#123;</span><br><span class="line">  <span class="attr">points</span>: data2,</span><br><span class="line">  <span class="attr">stroke</span>: <span class="string">&#x27;red&#x27;</span>,</span><br><span class="line">  <span class="attr">fill</span>: <span class="string">&#x27;yellow&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<p><a href="http://gafish.github.com/demo/d3/polygon.html">查看在线演示</a></p>
<h3 id="D3几何-凸包"><a href="#D3几何-凸包" class="headerlink" title="D3几何 - 凸包"></a>D3几何 - 凸包</h3><h4 id="d3-geom-hull"><a href="#d3-geom-hull" class="headerlink" title="d3.geom.hull"></a>d3.geom.hull</h4><p><a href="/img/d3/201609242115301474722930.43.jpg"><img src="/img/d3/201609242115301474722930.43.jpg"></a></p>
<p>hull函数用于计算指定坐标点的外围边界，用一个场景来描述，某片草原上有100只羊在不同的位置，我们需要将羊群所在的草场圈起来，那只要将羊群最外围的羊通过一根线连起来就可以实现，同理，hull就是用来计算这个外围边界的方法；</p>
<h4 id="绘制步骤-14"><a href="#绘制步骤-14" class="headerlink" title="绘制步骤"></a>绘制步骤</h4><p>通过一个示例来展示。</p>
<h5 id="数据，随机生成100只羊的坐标"><a href="#数据，随机生成100只羊的坐标" class="headerlink" title="数据，随机生成100只羊的坐标"></a>数据，随机生成100只羊的坐标</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> width = <span class="number">500</span>;</span><br><span class="line"><span class="keyword">var</span> height = <span class="number">500</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> randomX = d3.<span class="property">random</span>.<span class="title function_">normal</span>(width / <span class="number">2</span>, <span class="number">60</span>);</span><br><span class="line"><span class="keyword">var</span> randomY = d3.<span class="property">random</span>.<span class="title function_">normal</span>(height / <span class="number">2</span>, <span class="number">60</span>);</span><br><span class="line"><span class="keyword">var</span> dataset = d3.<span class="title function_">range</span>(<span class="number">100</span>).<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> [<span class="title function_">randomX</span>(), <span class="title function_">randomY</span>()];</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="数据转换-14"><a href="#数据转换-14" class="headerlink" title="数据转换"></a>数据转换</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> data = d3.<span class="property">geom</span>.<span class="title function_">hull</span>(dataset);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>转换前的数据，如图所示：</p>
<p><a href="/img/d3/201609242115301474722930.59.jpg"><img src="/img/d3/201609242115301474722930.59.jpg"></a></p>
<p>转换后的数据，只保留了边界上的点，如图所示：</p>
<p><a href="/img/d3/201609242115301474722930.78.jpg"><img src="/img/d3/201609242115301474722930.78.jpg"></a></p>
<h5 id="绘制图形-14"><a href="#绘制图形-14" class="headerlink" title="绘制图形"></a>绘制图形</h5><h6 id="生成SVG容器-11"><a href="#生成SVG容器-11" class="headerlink" title="生成SVG容器"></a>生成SVG容器</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&quot;body&quot;</span>).<span class="title function_">append</span>(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>, width)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>, height);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="生成羊群边界路径，注意这里用的是datum方法，因为这里不需要遍历数据"><a href="#生成羊群边界路径，注意这里用的是datum方法，因为这里不需要遍历数据" class="headerlink" title="生成羊群边界路径，注意这里用的是datum方法，因为这里不需要遍历数据"></a>生成羊群边界路径，注意这里用的是datum方法，因为这里不需要遍历数据</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> hull = svg.<span class="title function_">append</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line">    .<span class="title function_">datum</span>(data)</span><br><span class="line">    .<span class="title function_">attr</span>(&#123;</span><br><span class="line">      <span class="attr">d</span>: <span class="keyword">function</span>(<span class="params">d</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;M&#x27;</span>+ d.<span class="title function_">join</span>(<span class="string">&#x27;L&#x27;</span>) +<span class="string">&#x27;Z&#x27;</span>;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">fill</span>: <span class="string">&#x27;steelblue&#x27;</span>,</span><br><span class="line">      <span class="attr">stroke</span>: <span class="string">&#x27;#000&#x27;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="生成羊群坐标点，注意这里的数据是原始坐标数据dataset"><a href="#生成羊群坐标点，注意这里的数据是原始坐标数据dataset" class="headerlink" title="生成羊群坐标点，注意这里的数据是原始坐标数据dataset"></a>生成羊群坐标点，注意这里的数据是原始坐标数据dataset</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> circle = svg.<span class="title function_">selectAll</span>(<span class="string">&#x27;circle&#x27;</span>)</span><br><span class="line">  .<span class="title function_">data</span>(dataset)</span><br><span class="line">  .<span class="title function_">enter</span>()</span><br><span class="line">  .<span class="title function_">append</span>(<span class="string">&#x27;circle&#x27;</span>)</span><br><span class="line">  .<span class="title function_">attr</span>(&#123;</span><br><span class="line">    <span class="attr">r</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="attr">fill</span>: <span class="string">&#x27;#fff&#x27;</span>,</span><br><span class="line">    <span class="attr">stroke</span>: <span class="string">&#x27;#000&#x27;</span>,</span><br><span class="line">    <span class="attr">cx</span>: <span class="keyword">function</span>(<span class="params">d</span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> d[<span class="number">0</span>];</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">cy</span>: <span class="keyword">function</span>(<span class="params">d</span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> d[<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a href="http://gafish.github.com/demo/d3/hull.html">查看在线演示</a></p>
<h3 id="D3地理地图"><a href="#D3地理地图" class="headerlink" title="D3地理地图"></a>D3地理地图</h3><h4 id="d3-geo"><a href="#d3-geo" class="headerlink" title="d3.geo"></a>d3.geo</h4><p><a href="/img/d3/201609242115301474722930.96.jpg"><img src="/img/d3/201609242115301474722930.96.jpg"></a></p>
<p>在学习D3如何制作地图前，我们需要了解下地图的数据格式geoJSON，GeoJSON是一种对各种地理数据结构进行编码的格式，基于Javascript对象表示法的地理空间信息数据交换格式。</p>
<p>本节我们将制作一幅中国地图，使用到的地图数据文件是从 <a href="http://www.naturalearthdata.com/downloads/">Natural Earth</a><br>上的获取，经过提取后制作而成的，在本节入门篇中不细述地图数据的获取过程，将直接使用已经做好的数据，可通过以下链接下载查看中国地图数据。</p>
<p><a href="http://gafish.github.io/demo/d3/geoChina.json">China GeoJSON</a></p>
<h4 id="绘制步骤-15"><a href="#绘制步骤-15" class="headerlink" title="绘制步骤"></a>绘制步骤</h4><h5 id="加载数据"><a href="#加载数据" class="headerlink" title="加载数据"></a>加载数据</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">d3.<span class="title function_">json</span>(<span class="string">&#x27;geoChina.json&#x27;</span>,<span class="keyword">function</span>(<span class="params">error,data</span>) &#123;</span><br><span class="line">…...</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="设置投影方式"><a href="#设置投影方式" class="headerlink" title="设置投影方式"></a>设置投影方式</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">var</span> width = <span class="number">1000</span>;</span><br><span class="line"><span class="keyword">var</span> height = <span class="number">800</span>;</span><br><span class="line"><span class="keyword">var</span> projection = d3.<span class="property">geo</span>.<span class="title function_">mercator</span>()</span><br><span class="line">    .<span class="title function_">center</span>([<span class="number">107</span>, <span class="number">31</span>]) <span class="comment">//center() 设定地图的中心位置，[107,31] 指的是经度和纬度</span></span><br><span class="line">    .<span class="title function_">scale</span>(<span class="number">850</span>) <span class="comment">//scale() 设定放大的比例</span></span><br><span class="line">    .<span class="title function_">translate</span>([width/<span class="number">2</span>, height/<span class="number">2</span>]);</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<h5 id="创建一个地理路径生成器"><a href="#创建一个地理路径生成器" class="headerlink" title="创建一个地理路径生成器"></a>创建一个地理路径生成器</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">var</span> path = d3.<span class="property">geo</span>.<span class="title function_">path</span>()</span><br><span class="line">    .<span class="title function_">projection</span>(projection);</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<h5 id="绘制图形-15"><a href="#绘制图形-15" class="headerlink" title="绘制图形"></a>绘制图形</h5><h6 id="生成SVG容器-12"><a href="#生成SVG容器-12" class="headerlink" title="生成SVG容器"></a>生成SVG容器</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&quot;body&quot;</span>).<span class="title function_">append</span>(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>, width)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>, height);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="生成地图路径并添加交互事件"><a href="#生成地图路径并添加交互事件" class="headerlink" title="生成地图路径并添加交互事件"></a>生成地图路径并添加交互事件</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">var</span> color = d3.<span class="property">scale</span>.<span class="title function_">category20</span>();</span><br><span class="line">svg.<span class="title function_">selectAll</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line">    .<span class="title function_">data</span>( data.<span class="property">features</span> )</span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;stroke&quot;</span>,<span class="string">&quot;#000&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;stroke-width&quot;</span>,<span class="number">1</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;fill&quot;</span>, <span class="keyword">function</span>(<span class="params">d,i</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">color</span>(i);</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;d&quot;</span>, path )   <span class="comment">//使用地理路径生成器</span></span><br><span class="line">    .<span class="title function_">on</span>(<span class="string">&quot;mouseover&quot;</span>,<span class="keyword">function</span>(<span class="params">d,i</span>)&#123;</span><br><span class="line">                d3.<span class="title function_">select</span>(<span class="variable language_">this</span>)</span><br><span class="line">                   .<span class="title function_">attr</span>(<span class="string">&quot;fill&quot;</span>,<span class="string">&quot;yellow&quot;</span>);</span><br><span class="line">            &#125;)</span><br><span class="line">            .<span class="title function_">on</span>(<span class="string">&quot;mouseout&quot;</span>,<span class="keyword">function</span>(<span class="params">d,i</span>)&#123;</span><br><span class="line">                d3.<span class="title function_">select</span>(<span class="variable language_">this</span>)</span><br><span class="line">                   .<span class="title function_">attr</span>(<span class="string">&quot;fill&quot;</span>,<span class="title function_">color</span>(i));</span><br><span class="line">            &#125;);</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<p><a href="http://gafish.github.com/demo/d3/geoChina.html">查看在线演示</a></p>

        </div>
    
<!-- tags -->

    <div class="post-meta">
        标签：
        
            <a href="/tags/d3/"> / d3</a>
        
    </div>

</div>
                <div class="footer">
    <span>Copyright © <script>document.write(new Date().getFullYear())</script> 白云雅阁</span>
    <span>Powered by <a href="https://hexo.io">Hexo</a> with <a href="https:///imzl.com/zenmind">ZenMind</a></span>
    <span>备案号<a href="https://beian.miit.gov.cn/" target="_blank">京ICP备2024093046号-1</a></span>
</div>

<link rel="stylesheet" href="/css/a11y-dark.min.css">


<script src="/js/highlight.min.js"></script>


<script src="/js/highlightjs-line-numbers.js"></script>

<script>
    hljs.initHighlightingOnLoad();
    hljs.initLineNumbersOnLoad();
</script>

            </div>
        </div>
    </body>
</html>