<!DOCTYPE html>
<html>
    <head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
  <meta name="robots" content="index, follow">
  <!-- title -->
  
    
  <title>gulp使用小例一 - 白云雅阁</title>
    
  
  
  <!-- open graph -->
  <meta name="description" content="gulp的一个案例，主要是对gulpfile.js中的任务进行分割，完成清理、文件复制同时进行筛选压缩、以及html中js和css引用的替换等">
<meta property="og:type" content="article">
<meta property="og:title" content="gulp使用小例一">
<meta property="og:url" content="http://ronghuaxueleng.github.io/archives/363a1c71.html">
<meta property="og:site_name" content="白云雅阁">
<meta property="og:description" content="gulp的一个案例，主要是对gulpfile.js中的任务进行分割，完成清理、文件复制同时进行筛选压缩、以及html中js和css引用的替换等">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2016-08-10T00:00:00.000Z">
<meta property="article:modified_time" content="2025-03-09T08:43:48.251Z">
<meta property="article:author" content="ronghuaxueleng">
<meta property="article:tag" content="javascript">
<meta name="twitter:card" content="summary">
  <!-- canonical -->
  
  <link rel="canonical" href="http://ronghuaxueleng.github.io/archives/363a1c71.html">
  
  <!-- Favicon -->
  <link rel="shortcut icon" href="/img/favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
  <!-- CSS -->
  
<link rel="stylesheet" href="/css/reset.css">

  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/markdown.css">

  
<link rel="stylesheet" href="/css/fonts.css">

<meta name="generator" content="Hexo 7.3.0"></head>

    <body>
        <div class="paper">
            <div class="paper-main">
                
                    <div class="post-header">
    <a class="logo" href="/">白云雅阁</a>
    <!-- <div class="logo"><a href="/" title="Len"><img src="/img/logo.svg" alt="Len" aria-label="logo" height="20"></a></div> -->
        <ul class="nav">
            
            <li><a href="/">Home</a></li>
            
            <li><a href="/archives">Archives</a></li>
            
        </ul>


    </a>
</div>

                
                <div class="post-main">
    
        <div class="post-main-title">
            gulp使用小例一
        </div>
        <div class="post-meta">
            2016-08-10 ｜ 
            
                <a href="/categories/%E8%87%AA%E5%8A%A8%E7%AE%A1%E7%90%86-gulp/"># 自动管理,gulp</a>
            
        </div>
        <!-- 圆角分类 -->
        <!-- <div class="tags"> -->
            <!--  -->
                <!-- <a href="/categories/%E8%87%AA%E5%8A%A8%E7%AE%A1%E7%90%86-gulp/">自动管理,gulp</a> -->
            <!--  -->
        <!-- </div> -->
        <div class="post-md">
            <hr>
<p>gulp的一个案例，主要是对gulpfile.js中的任务进行分割，完成清理、文件复制同时进行筛选压缩、以及html中js和css引用的替换等</p>
<span id="more"></span>

<h4 id="gulpfile-js"><a href="#gulpfile-js" class="headerlink" title="gulpfile.js"></a>gulpfile.js</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">&#x27;gulp&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> config = &#123;</span><br><span class="line">    <span class="attr">pkg</span>: <span class="built_in">require</span>(<span class="string">&#x27;./package.json&#x27;</span>),</span><br><span class="line">    <span class="attr">publicDir</span>: [<span class="string">&#x27;./&#123;public,public/**&#125;&#x27;</span>],</span><br><span class="line">    <span class="attr">resourcesDir</span>: [<span class="string">&#x27;./&#123;resources/,resources/**&#125;&#x27;</span>],</span><br><span class="line">    <span class="attr">apps</span>: [<span class="string">&#x27;ads&#x27;</span>, <span class="string">&#x27;analysis&#x27;</span>, <span class="string">&#x27;homepage&#x27;</span>, <span class="string">&#x27;index&#x27;</span>, <span class="string">&#x27;manage&#x27;</span>, <span class="string">&#x27;portrait&#x27;</span>, <span class="string">&#x27;recommend&#x27;</span>],</span><br><span class="line">    <span class="attr">destDir</span>: <span class="string">&#x27;dest&#x27;</span>,</span><br><span class="line">    <span class="attr">version</span>: <span class="string">&quot;0.01&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// load plugins</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;gulp-task-loader&#x27;</span>)(config);</span><br><span class="line">gulp.<span class="title function_">task</span>(<span class="string">&#x27;build&#x27;</span>, [<span class="string">&#x27;clean&#x27;</span>, <span class="string">&#x27;copy&#x27;</span>, <span class="string">&#x27;app-concat&#x27;</span>, <span class="string">&#x27;vendor-concat&#x27;</span>, <span class="string">&#x27;html-replace&#x27;</span>]);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>gulp-task-loader</strong>插件默认会寻找<strong>gulp-tasks</strong>目录下的任务</p>
<h4 id="clean-js"><a href="#clean-js" class="headerlink" title="clean.js"></a>clean.js</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> del = <span class="built_in">require</span>(<span class="string">&#x27;del&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> del.<span class="title function_">sync</span>(<span class="variable language_">this</span>.<span class="property">opts</span>.<span class="property">destDir</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="copy-js"><a href="#copy-js" class="headerlink" title="copy.js"></a>copy.js</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> filter = <span class="built_in">require</span>(<span class="string">&#x27;gulp-filter&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> gulpIgnore = <span class="built_in">require</span>(<span class="string">&#x27;gulp-ignore&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> bytediff = <span class="built_in">require</span>(<span class="string">&#x27;gulp-bytediff&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> plumber = <span class="built_in">require</span>(<span class="string">&#x27;gulp-plumber&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> uglify = <span class="built_in">require</span>(<span class="string">&#x27;gulp-uglify&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> minifyCss = <span class="built_in">require</span>(<span class="string">&#x27;gulp-minify-css&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> imagemin = <span class="built_in">require</span>(<span class="string">&#x27;gulp-imagemin&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> pngquant = <span class="built_in">require</span>(<span class="string">&#x27;imagemin-pngquant&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> htmlminify = <span class="built_in">require</span>(<span class="string">&quot;gulp-html-minify&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> excludeJs = [];</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">opts</span>.<span class="property">apps</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">item</span>)&#123;</span><br><span class="line">        excludeJs.<span class="title function_">push</span>(<span class="string">&#x27;**/&#x27;</span>+item+<span class="string">&#x27;/js/&#123;**,*.*&#125;&#x27;</span>);</span><br><span class="line">        excludeJs.<span class="title function_">push</span>(<span class="string">&#x27;!**/&#x27;</span>+item+<span class="string">&#x27;/js/partials/&#123;**,*.*&#125;&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    excludeJs.<span class="title function_">push</span>(<span class="string">&#x27;**/js/&#123;**,*.*&#125;&#x27;</span>);</span><br><span class="line">    excludeJs.<span class="title function_">push</span>(<span class="string">&#x27;!**/js/i18n/&#123;**,*.*&#125;&#x27;</span>);</span><br><span class="line">    excludeJs.<span class="title function_">push</span>(<span class="string">&#x27;!**/js/server/&#123;**,*.*&#125;&#x27;</span>);</span><br><span class="line">    excludeJs.<span class="title function_">push</span>(<span class="string">&#x27;!**/js/zeroclipboard/&#123;**,*.*&#125;&#x27;</span>);</span><br><span class="line">    excludeJs.<span class="title function_">push</span>(<span class="string">&#x27;!**/js/layer/&#123;**,*.*&#125;&#x27;</span>);</span><br><span class="line">    excludeJs.<span class="title function_">push</span>(<span class="string">&#x27;!**/js/My97DatePicker/&#123;**,*.*&#125;&#x27;</span>);</span><br><span class="line">    excludeJs.<span class="title function_">push</span>(<span class="string">&#x27;!**/js/echarts/province.min.js&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> filterJs = <span class="title function_">filter</span>([<span class="string">&#x27;**/*.js&#x27;</span>], &#123;<span class="attr">restore</span>: <span class="literal">true</span>&#125;);</span><br><span class="line">    <span class="keyword">var</span> filterCss = <span class="title function_">filter</span>([<span class="string">&#x27;**/*.css&#x27;</span>], &#123;<span class="attr">restore</span>: <span class="literal">true</span>&#125;);</span><br><span class="line">    <span class="keyword">var</span> filterImg = <span class="title function_">filter</span>([<span class="string">&#x27;**/*.&#123;png,jpg,gif&#125;&#x27;</span>], &#123;<span class="attr">restore</span>: <span class="literal">true</span>&#125;);</span><br><span class="line">    <span class="keyword">var</span> filterHtml = <span class="title function_">filter</span>([<span class="string">&#x27;**/*.html&#x27;</span>], &#123;<span class="attr">restore</span>: <span class="literal">true</span>&#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">gulp</span>.<span class="title function_">src</span>(<span class="variable language_">this</span>.<span class="property">opts</span>.<span class="property">publicDir</span>)</span><br><span class="line">     .<span class="title function_">pipe</span>(<span class="title function_">plumber</span>())<span class="comment">//防止steam报错退出</span></span><br><span class="line">     .<span class="title function_">pipe</span>(gulpIgnore.<span class="title function_">exclude</span>(excludeJs))</span><br><span class="line"></span><br><span class="line">     .<span class="title function_">pipe</span>(filterJs)<span class="comment">//过滤出js</span></span><br><span class="line">     .<span class="title function_">pipe</span>(bytediff.<span class="title function_">start</span>())<span class="comment">//统计文件大小变化开始</span></span><br><span class="line">     .<span class="title function_">pipe</span>(<span class="title function_">uglify</span>())<span class="comment">//压缩js</span></span><br><span class="line">     .<span class="title function_">pipe</span>(bytediff.<span class="title function_">stop</span>())<span class="comment">//统计文件大小变化开始</span></span><br><span class="line">     .<span class="title function_">pipe</span>(filterJs.<span class="property">restore</span>)</span><br><span class="line">     .<span class="title function_">pipe</span>(filterImg)<span class="comment">//过滤出图片</span></span><br><span class="line">     .<span class="title function_">pipe</span>(bytediff.<span class="title function_">start</span>())</span><br><span class="line">     .<span class="title function_">pipe</span>(<span class="title function_">imagemin</span>(&#123; </span><br><span class="line">         <span class="attr">progressive</span>: <span class="literal">true</span>,<span class="comment">//类型：Boolean 默认：false 无损压缩jpg图片</span></span><br><span class="line">         <span class="attr">svgoPlugins</span>: [&#123;<span class="attr">removeViewBox</span>: <span class="literal">false</span>&#125;],<span class="comment">//不要移除svg的viewbox属性</span></span><br><span class="line">         <span class="attr">use</span>: [<span class="title function_">pngquant</span>()] <span class="comment">//使用pngquant深度压缩png图片的imagemin插件</span></span><br><span class="line">     &#125;))</span><br><span class="line">     .<span class="title function_">pipe</span>(bytediff.<span class="title function_">stop</span>())</span><br><span class="line">     .<span class="title function_">pipe</span>(filterImg.<span class="property">restore</span>)</span><br><span class="line">     .<span class="title function_">pipe</span>(filterCss)<span class="comment">//过滤出css</span></span><br><span class="line">     .<span class="title function_">pipe</span>(bytediff.<span class="title function_">start</span>())</span><br><span class="line">     .<span class="title function_">pipe</span>(<span class="title function_">minifyCss</span>())<span class="comment">//压缩</span></span><br><span class="line">     .<span class="title function_">pipe</span>(bytediff.<span class="title function_">stop</span>())</span><br><span class="line">     .<span class="title function_">pipe</span>(filterCss.<span class="property">restore</span>)</span><br><span class="line">     .<span class="title function_">pipe</span>(filterHtml)<span class="comment">//过滤出html</span></span><br><span class="line">     .<span class="title function_">pipe</span>(bytediff.<span class="title function_">start</span>())</span><br><span class="line">     .<span class="title function_">pipe</span>(<span class="title function_">htmlminify</span>())<span class="comment">//压缩</span></span><br><span class="line">     .<span class="title function_">pipe</span>(bytediff.<span class="title function_">stop</span>())</span><br><span class="line">     .<span class="title function_">pipe</span>(filterHtml.<span class="property">restore</span>)</span><br><span class="line">     .<span class="title function_">pipe</span>(<span class="variable language_">this</span>.<span class="property">gulp</span>.<span class="title function_">dest</span>(<span class="variable language_">this</span>.<span class="property">opts</span>.<span class="property">destDir</span>));</span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>.<span class="property">dependencies</span> = [<span class="string">&#x27;clean&#x27;</span>];</span><br></pre></td></tr></table></figure>
<h4 id="app-concat-js"><a href="#app-concat-js" class="headerlink" title="app-concat.js"></a>app-concat.js</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> merge = <span class="built_in">require</span>(<span class="string">&#x27;merge-stream&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> fileconcat = <span class="built_in">require</span>(<span class="string">&#x27;gulp-file-concat&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> uglify = <span class="built_in">require</span>(<span class="string">&#x27;gulp-uglify&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> ngAnnotate = <span class="built_in">require</span>(<span class="string">&#x27;gulp-ng-annotate&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> rename = <span class="built_in">require</span>(<span class="string">&#x27;gulp-rename&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> gulp = <span class="variable language_">this</span>.<span class="property">gulp</span>;</span><br><span class="line">    <span class="keyword">var</span> opts = <span class="variable language_">this</span>.<span class="property">opts</span>;</span><br><span class="line">    <span class="keyword">var</span> apps = <span class="variable language_">this</span>.<span class="property">opts</span>.<span class="property">apps</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> tasks = apps.<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">app</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> gulp.<span class="title function_">src</span>(path.<span class="title function_">join</span>(<span class="string">&#x27;public&#x27;</span>, app, <span class="string">&#x27;js&#x27;</span>, <span class="string">&#x27;app_maps.js&#x27;</span>))</span><br><span class="line">        .<span class="title function_">pipe</span>(<span class="title function_">fileconcat</span>(&#123;</span><br><span class="line">            <span class="attr">relativeUrls</span>: <span class="string">&#x27;./public&#x27;</span></span><br><span class="line">        &#125;))</span><br><span class="line">        .<span class="title function_">pipe</span>(<span class="title function_">ngAnnotate</span>())</span><br><span class="line">        .<span class="title function_">pipe</span>(<span class="title function_">uglify</span>())</span><br><span class="line">        .<span class="title function_">pipe</span>(<span class="title function_">rename</span>(<span class="keyword">function</span>(<span class="params">path</span>)&#123;</span><br><span class="line">            path.<span class="property">basename</span> = <span class="string">&#x27;app&#x27;</span>;</span><br><span class="line">            path.<span class="property">extname</span> = <span class="string">&#x27;.js&#x27;</span></span><br><span class="line">        &#125;))</span><br><span class="line">        .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(path.<span class="title function_">join</span>(opts.<span class="property">destDir</span>, <span class="string">&#x27;public&#x27;</span>, app , <span class="string">&#x27;js&#x27;</span>)));</span><br><span class="line">   &#125;);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="title function_">merge</span>(tasks);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>.<span class="property">dependencies</span> = [<span class="string">&#x27;copy&#x27;</span>];</span><br></pre></td></tr></table></figure>
<p><strong>这里会循环gulpfile.js中的apps这个配置，然后去寻找相应目录下的app_maps.js文件，然后进行合并压缩，app_maps.js文件如下：</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">&#x27;&lt;script src=&quot;/analysis/js/app.js&quot;&gt;&lt;/script&gt;&#x27;</span>);</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">&#x27;&lt;script src=&quot;/analysis/js/commom.js&quot;&gt;&lt;/script&gt;&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">close</span>();</span><br></pre></td></tr></table></figure>

<p><strong>都是些自己写的js文件</strong></p>
<h4 id="vendor-concat-js"><a href="#vendor-concat-js" class="headerlink" title="vendor-concat.js"></a>vendor-concat.js</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> fileconcat = <span class="built_in">require</span>(<span class="string">&#x27;gulp-file-concat&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> uglify = <span class="built_in">require</span>(<span class="string">&#x27;gulp-uglify&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> rename = <span class="built_in">require</span>(<span class="string">&#x27;gulp-rename&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> gulp = <span class="variable language_">this</span>.<span class="property">gulp</span>;</span><br><span class="line">    <span class="keyword">var</span> opts = <span class="variable language_">this</span>.<span class="property">opts</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> gulp.<span class="title function_">src</span>(path.<span class="title function_">join</span>(<span class="string">&#x27;public&#x27;</span>, <span class="string">&#x27;js&#x27;</span>, <span class="string">&#x27;vendor.map.js&#x27;</span>))</span><br><span class="line">        .<span class="title function_">pipe</span>(<span class="title function_">fileconcat</span>(&#123;</span><br><span class="line">            <span class="attr">relativeUrls</span>: <span class="string">&#x27;./public&#x27;</span></span><br><span class="line">        &#125;))</span><br><span class="line">        .<span class="title function_">pipe</span>(<span class="title function_">uglify</span>())</span><br><span class="line">        .<span class="title function_">pipe</span>(<span class="title function_">rename</span>(<span class="keyword">function</span>(<span class="params">path</span>)&#123;</span><br><span class="line">            path.<span class="property">basename</span> = <span class="string">&#x27;vendor&#x27;</span>;</span><br><span class="line">            path.<span class="property">extname</span> = <span class="string">&#x27;.js&#x27;</span></span><br><span class="line">        &#125;))</span><br><span class="line">        .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(path.<span class="title function_">join</span>(opts.<span class="property">destDir</span>, <span class="string">&#x27;public&#x27;</span>, <span class="string">&#x27;js&#x27;</span>)));</span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>.<span class="property">dependencies</span> = [<span class="string">&#x27;app-concat&#x27;</span>];</span><br></pre></td></tr></table></figure>

<p>vendor.map.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">&#x27;&lt;script src=&quot;/js/jquery/jquery.min.js&quot;&gt;&lt;/script&gt;&#x27;</span>);</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">&#x27;&lt;script src=&quot;/js/bootstrap/bootstrap.min.js&quot;&gt;&lt;/script&gt;&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">close</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>没什么好解释的，都是一些依赖的库</strong></p>
<h4 id="html-replace-js"><a href="#html-replace-js" class="headerlink" title="html-replace.js"></a>html-replace.js</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> htmlreplace = <span class="built_in">require</span>(<span class="string">&#x27;gulp-html-replace&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> gulp = <span class="variable language_">this</span>.<span class="property">gulp</span>;</span><br><span class="line">    <span class="keyword">var</span> opts = <span class="variable language_">this</span>.<span class="property">opts</span>;</span><br><span class="line">    <span class="keyword">var</span> apps = opts.<span class="property">apps</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> replace_res = &#123;</span><br><span class="line">        <span class="comment">//&#x27;css&#x27;: &#x27;styles.min.css?ver=&#x27;+opts.version,</span></span><br><span class="line">        <span class="string">&#x27;vendorJs&#x27;</span>: <span class="string">&#x27;/js/vendor.js?ver=&#x27;</span>+opts.<span class="property">version</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    apps.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">app</span>)&#123;</span><br><span class="line">        replace_res[app] = <span class="string">&#x27;/&#x27;</span> + app + <span class="string">&#x27;/js/app.js?ver=&#x27;</span>+opts.<span class="property">version</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> gulp.<span class="title function_">src</span>(opts.<span class="property">resourcesDir</span>)</span><br><span class="line">      .<span class="title function_">pipe</span>(<span class="title function_">htmlreplace</span>(replace_res))</span><br><span class="line">      .<span class="title function_">pipe</span>(gulp.<span class="title function_">dest</span>(path.<span class="title function_">join</span>(opts.<span class="property">destDir</span>, <span class="string">&#x27;resources&#x27;</span>)));</span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>.<span class="property">dependencies</span> = [<span class="string">&#x27;vendor-concat&#x27;</span>];</span><br></pre></td></tr></table></figure>

<p><strong>html页面</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- build:vendorJs --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/js/vendor.map.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- endbuild --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/js/zeroclipboard/ZeroClipboard.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/js/layer/layer.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- build:manage --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/manage/js/app_maps.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- endbuild --&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>这里就是html中的js和css文件替换</strong></p>
<p>执行<code>gulp build</code>就可以见证奇迹了</p>

        </div>
    
<!-- tags -->

    <div class="post-meta">
        标签：
        
            <a href="/tags/javascript/"> / javascript</a>
        
    </div>

</div>
                <div class="footer">
    <span>Copyright © <script>document.write(new Date().getFullYear())</script> 白云雅阁</span>
    <span>Powered by <a href="https://hexo.io">Hexo</a> with <a href="https:///imzl.com/zenmind">ZenMind</a></span>
    <span>备案号<a href="https://beian.miit.gov.cn/" target="_blank">京ICP备2024093046号-1</a></span>
</div>

<link rel="stylesheet" href="/css/a11y-dark.min.css">


<script src="/js/highlight.min.js"></script>


<script src="/js/highlightjs-line-numbers.js"></script>

<script>
    hljs.initHighlightingOnLoad();
    hljs.initLineNumbersOnLoad();
</script>

            </div>
        </div>
    </body>
</html>